<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>check-subst</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">check-subst&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-reference">#!/bin/sh
</span><span class="enscript-comment"># Check of --unicode-subst, --byte-subst, --widechar-subst options.
</span><span class="enscript-keyword">set</span> -e
iconv=../src/iconv_no_i18n

options_ascii='--unicode-subst=&lt;U+%04X&gt; --byte-subst=&lt;0x%02x&gt; --widechar-subst=&lt;%08x&gt;'
options_utf8='--unicode-subst=«U+%04X» --byte-subst=«0x%02x» --widechar-subst=«%08x»'

<span class="enscript-comment"># Test of --byte-subst with an ASCII substitution.
</span>
cat &gt; tmp-<span class="enscript-keyword">in</span> &lt;&lt;\EOF
Böse Bübchen
EOF
$iconv $options_ascii -f ASCII -t ASCII &lt; tmp-<span class="enscript-keyword">in</span> &gt; tmp-out
cat &gt; tmp-ok &lt;&lt;\EOF
B&lt;0xc3&gt;&lt;0xb6&gt;se B&lt;0xc3&gt;&lt;0xbc&gt;bchen
EOF
cmp tmp-out tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 1 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 1

<span class="enscript-comment"># Test of --byte-subst with a non-ASCII substitution.
</span>
<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;`(locale charmap) 2&gt;/dev/null`&quot;</span> = UTF-8; <span class="enscript-keyword">then</span>
  cat &gt; tmp-<span class="enscript-keyword">in</span> &lt;&lt;\EOF
Böse Bübchen
EOF
  $iconv $options_utf8 -f ASCII -t UTF-8 2&gt;/dev/null &lt; tmp-<span class="enscript-keyword">in</span> &gt; tmp-out
  cat &gt; tmp-ok &lt;&lt;\EOF
B«0xc3»«0xb6»se B«0xc3»«0xbc»bchen
EOF
  cmp tmp-out tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 2 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 2
<span class="enscript-keyword">fi</span>

<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;`(locale charmap) 2&gt;/dev/null`&quot;</span> = UTF-8; <span class="enscript-keyword">then</span>
  cat &gt; tmp-<span class="enscript-keyword">in</span> &lt;&lt;\EOF
Böse Bübchen
EOF
  $iconv $options_utf8 -f ASCII -t ISO-8859-1 2&gt;/dev/null &lt; tmp-<span class="enscript-keyword">in</span> &gt; tmp-out
  $iconv -f ISO-8859-1 -t UTF-8 &lt; tmp-out &gt; tmp-out2
  cat &gt; tmp-ok &lt;&lt;\EOF
B«0xc3»«0xb6»se B«0xc3»«0xbc»bchen
EOF
  cmp tmp-out2 tmp-ok  &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 3 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 3
<span class="enscript-keyword">fi</span>

<span class="enscript-comment"># Test of --byte-subst with a very long substitution.
</span>
cat &gt; tmp-<span class="enscript-keyword">in</span> &lt;&lt;\EOF
Böse Bübchen
EOF
$iconv --byte-subst='&lt;0x%010000x&gt;' -f ASCII -t ASCII &lt; tmp-<span class="enscript-keyword">in</span> &gt; tmp-out
printf 'B&lt;0x%010000x&gt;&lt;0x%010000x&gt;se B&lt;0x%010000x&gt;&lt;0x%010000x&gt;bchen\n' 0xC3 0xB6 0xC3 0xBC &gt; tmp-ok
cmp tmp-out tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 4 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 4

<span class="enscript-comment"># Test of --unicode-subst with an ASCII substitution.
</span>
cat &gt; tmp-<span class="enscript-keyword">in</span> &lt;&lt;\EOF
Böse Bübchen
EOF
$iconv $options_ascii -f UTF-8 -t ASCII &lt; tmp-<span class="enscript-keyword">in</span> &gt; tmp-out
cat &gt; tmp-ok &lt;&lt;\EOF
B&lt;U+00F6&gt;se B&lt;U+00FC&gt;bchen
EOF
cmp tmp-out tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 5 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 5

cat &gt; tmp-<span class="enscript-keyword">in</span> &lt;&lt;\EOF
Russian (Русский)
EOF
$iconv $options_ascii -f UTF-8 -t ISO-8859-1 2&gt;/dev/null &lt; tmp-<span class="enscript-keyword">in</span> | $iconv -f ISO-8859-1 -t UTF-8 &gt; tmp-out
cat &gt; tmp-ok &lt;&lt;\EOF
Russian (&lt;U+0420&gt;&lt;U+0443&gt;&lt;U+0441&gt;&lt;U+0441&gt;&lt;U+043A&gt;&lt;U+0438&gt;&lt;U+0439&gt;)
EOF
cmp tmp-out tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 6 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 6

<span class="enscript-comment"># Test of --unicode-subst with a non-ASCII substitution.
</span>
<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;`(locale charmap) 2&gt;/dev/null`&quot;</span> = UTF-8; <span class="enscript-keyword">then</span>
  cat &gt; tmp-<span class="enscript-keyword">in</span> &lt;&lt;\EOF
Russian (Русский)
EOF
  $iconv $options_utf8 -f UTF-8 -t ISO-8859-1 2&gt;/dev/null &lt; tmp-<span class="enscript-keyword">in</span> &gt; tmp-out
  $iconv -f ISO-8859-1 -t UTF-8 &lt; tmp-out &gt; tmp-out2
  cat &gt; tmp-ok &lt;&lt;\EOF
Russian («U+0420»«U+0443»«U+0441»«U+0441»«U+043A»«U+0438»«U+0439»)
EOF
  cmp tmp-out2 tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 7 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 7
<span class="enscript-keyword">fi</span>

<span class="enscript-comment"># Test of --unicode-subst with a very long substitution.
</span>
cat &gt; tmp-<span class="enscript-keyword">in</span> &lt;&lt;\EOF
Böse Bübchen
EOF
$iconv --unicode-subst='&lt;U+%010000X&gt;' -f UTF-8 -t ASCII &lt; tmp-<span class="enscript-keyword">in</span> &gt; tmp-out
printf 'B&lt;U+%010000X&gt;se B&lt;U+%010000X&gt;bchen\n' 0x00F6 0x00FC &gt; tmp-ok
cmp tmp-out tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 8 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 8

cat &gt; tmp-<span class="enscript-keyword">in</span> &lt;&lt;\EOF
Böse Bübchen
EOF
$iconv --byte-subst='&lt;0x%010000x&gt;' -f ASCII -t ASCII &lt; tmp-<span class="enscript-keyword">in</span> &gt; tmp-out
printf 'B&lt;0x%010000x&gt;&lt;0x%010000x&gt;se B&lt;0x%010000x&gt;&lt;0x%010000x&gt;bchen\n' 0xC3 0xB6 0xC3 0xBC &gt; tmp-ok
cmp tmp-out tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 9 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 9

<span class="enscript-comment"># Test of --widechar-subst:
</span><span class="enscript-comment"># wcrtomb() doesn't exist on FreeBSD 4.0 and is broken on MacOS X 10.3.
</span><span class="enscript-comment"># So far this has been tested only on a glibc system with !__STDC_ISO_10646__.
</span>
<span class="enscript-keyword">if</span> false &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;`(locale charmap) 2&gt;/dev/null`&quot;</span> = UTF-8; <span class="enscript-keyword">then</span>
  cat &gt; tmp-<span class="enscript-keyword">in</span> &lt;&lt;\EOF
Russian (Русский)
EOF
  $iconv -f char -t wchar_t &lt; tmp-<span class="enscript-keyword">in</span> &gt; tmp-inw
  LC_ALL=C                $iconv $options_ascii -f wchar_t -t ASCII &lt; tmp-inw &gt; tmp-out1
  LC_ALL=de_DE.ISO-8859-1 $iconv $options_ascii -f wchar_t -t ASCII &lt; tmp-inw &gt; tmp-out2
  cat &gt; tmp-ok &lt;&lt;\EOF
Russian (&lt;00000420&gt;&lt;00000443&gt;&lt;00000441&gt;&lt;00000441&gt;&lt;0000043a&gt;&lt;00000438&gt;&lt;00000439&gt;)
EOF
  cmp tmp-out1 tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 10 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 10
  cmp tmp-out2 tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 11 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 11
  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;`(LC_ALL=de_DE.ISO-8859-1 locale charmap) 2&gt;/dev/null`&quot;</span> = ISO-8859-1; <span class="enscript-keyword">then</span>
    options_latin1=`<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot; $options_utf8&quot;</span> | $iconv -f UTF-8 -t ISO-8859-1`
    LC_ALL=de_DE.ISO-8859-1 $iconv $options_latin1 -f wchar_t -t UTF-8 &lt; tmp-inw &gt; tmp-out1
    cat &gt; tmp-ok &lt;&lt;\EOF
Russian («00000420»«00000443»«00000441»«00000441»«0000043a»«00000438»«00000439»)
EOF
    cmp tmp-out1 tmp-ok &amp;&amp; <span class="enscript-keyword">echo</span> '[PASS]' $(basename $0) 12 || <span class="enscript-keyword">echo</span> '[FAIL]' $(basename $0) 12
  <span class="enscript-keyword">fi</span>
<span class="enscript-keyword">fi</span>

rm -f tmp-<span class="enscript-keyword">in</span>* tmp-out* tmp-ok
<span class="enscript-keyword">exit</span> 0
</pre>
<hr />
</body></html>