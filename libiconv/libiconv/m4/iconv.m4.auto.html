<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>iconv.m4</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">iconv.m4&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment"># iconv.m4 serial AM4 (gettext-0.11.3)
</span><span class="enscript-comment">dnl Copyright (C) 2000-2002 Free Software Foundation, Inc.
</span><span class="enscript-comment">dnl This file is free software; the Free Software Foundation
</span><span class="enscript-comment">dnl gives unlimited permission to copy and/or distribute it,
</span><span class="enscript-comment">dnl with or without modifications, as long as this notice is preserved.
</span>
<span class="enscript-comment">dnl From Bruno Haible.
</span>
AC_DEFUN([AM_ICONV_LINKFLAGS_BODY],
[
  <span class="enscript-comment">dnl Prerequisites of AC_LIB_LINKFLAGS_BODY.
</span>  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])
  AC_REQUIRE([AC_LIB_RPATH])

  <span class="enscript-comment">dnl Search for libiconv and define LIBICONV, LTLIBICONV and INCICONV
</span>  <span class="enscript-comment">dnl accordingly.
</span>  AC_LIB_LINKFLAGS_BODY([iconv])
])

AC_DEFUN([AM_ICONV_LINK],
[
  <span class="enscript-comment">dnl Some systems have iconv in libc, some have it in libiconv (OSF/1 and
</span>  <span class="enscript-comment">dnl those with the standalone portable GNU libiconv installed).
</span>
  <span class="enscript-comment">dnl Search for libiconv and define LIBICONV, LTLIBICONV and INCICONV
</span>  <span class="enscript-comment">dnl accordingly.
</span>  AC_REQUIRE([AM_ICONV_LINKFLAGS_BODY])

  <span class="enscript-comment">dnl Add $INCICONV to CPPFLAGS before performing the following checks,
</span>  <span class="enscript-comment">dnl because if the user has installed libiconv and not disabled its use
</span>  <span class="enscript-comment">dnl via --without-libiconv-prefix, he wants to use it. The first
</span>  <span class="enscript-comment">dnl AC_TRY_LINK will then fail, the second AC_TRY_LINK will succeed.
</span>  am_save_CPPFLAGS=&quot;$CPPFLAGS&quot;
  AC_LIB_APPENDTOVAR([CPPFLAGS], [$INCICONV])

  AC_CACHE_CHECK(for iconv, am_cv_func_iconv, [
    am_cv_func_iconv=&quot;no, consider installing GNU libiconv&quot;
    am_cv_lib_iconv=no
    AC_TRY_LINK([<span class="enscript-comment">#include &lt;stdlib.h&gt;
</span><span class="enscript-comment">#include &lt;iconv.h&gt;],
</span>      [iconv_t cd = iconv_open(&quot;&quot;,&quot;&quot;);
       iconv(cd,NULL,NULL,NULL,NULL);
       iconv_close(cd);],
      am_cv_func_iconv=yes)
    if test &quot;$am_cv_func_iconv&quot; != yes; then
      am_save_LIBS=&quot;$LIBS&quot;
      LIBS=&quot;$LIBS $LIBICONV&quot;
      AC_TRY_LINK([<span class="enscript-comment">#include &lt;stdlib.h&gt;
</span><span class="enscript-comment">#include &lt;iconv.h&gt;],
</span>        [iconv_t cd = iconv_open(&quot;&quot;,&quot;&quot;);
         iconv(cd,NULL,NULL,NULL,NULL);
         iconv_close(cd);],
        am_cv_lib_iconv=yes
        am_cv_func_iconv=yes)
      LIBS=&quot;$am_save_LIBS&quot;
    fi
  ])
  if test &quot;$am_cv_func_iconv&quot; = yes; then
    AC_DEFINE(HAVE_ICONV, 1, [Define if you have the iconv() function.])
  fi
  if test &quot;$am_cv_lib_iconv&quot; = yes; then
    AC_MSG_CHECKING([how to link with libiconv])
    AC_MSG_RESULT([$LIBICONV])
  else
    <span class="enscript-comment">dnl If $LIBICONV didn't lead to a usable library, we don't need $INCICONV
</span>    <span class="enscript-comment">dnl either.
</span>    CPPFLAGS=&quot;$am_save_CPPFLAGS&quot;
    LIBICONV=
    LTLIBICONV=
  fi
  AC_SUBST(LIBICONV)
  AC_SUBST(LTLIBICONV)
])

AC_DEFUN([AM_ICONV],
[
  AM_ICONV_LINK
  if test &quot;$am_cv_func_iconv&quot; = yes; then
    AC_MSG_CHECKING([for iconv declaration])
    AC_CACHE_VAL(am_cv_proto_iconv, [
      AC_TRY_COMPILE([
<span class="enscript-comment">#include &lt;stdlib.h&gt;
</span><span class="enscript-comment">#include &lt;iconv.h&gt;
</span>extern
<span class="enscript-comment">#ifdef __cplusplus
</span>&quot;C&quot;
<span class="enscript-comment">#endif
</span><span class="enscript-comment">#if defined(__STDC__) || defined(__cplusplus)
</span>size_t iconv (iconv_t cd, char * *inbuf, size_t *inbytesleft, char * *outbuf, size_t *outbytesleft);
<span class="enscript-comment">#else
</span>size_t iconv();
<span class="enscript-comment">#endif
</span>], [], am_cv_proto_iconv_arg1=&quot;&quot;, am_cv_proto_iconv_arg1=&quot;const&quot;)
      am_cv_proto_iconv=&quot;extern size_t iconv (iconv_t cd, $am_cv_proto_iconv_arg1 char * *inbuf, size_t *inbytesleft, char * *outbuf, size_t *outbytesleft);&quot;])
    am_cv_proto_iconv=`echo &quot;[$]am_cv_proto_iconv&quot; | tr -s ' ' | sed -e 's/( /(/'`
    AC_MSG_RESULT([$]{ac_t:-
         }[$]am_cv_proto_iconv)
    AC_DEFINE_UNQUOTED(ICONV_CONST, $am_cv_proto_iconv_arg1,
      [Define as const if the declaration of iconv() needs const.])
  fi
])
</pre>
<hr />
</body></html>