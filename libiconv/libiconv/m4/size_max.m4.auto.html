<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>size_max.m4</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">size_max.m4&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment"># size_max.m4 serial 4
</span><span class="enscript-comment">dnl Copyright (C) 2003, 2005-2006 Free Software Foundation, Inc.
</span><span class="enscript-comment">dnl This file is free software; the Free Software Foundation
</span><span class="enscript-comment">dnl gives unlimited permission to copy and/or distribute it,
</span><span class="enscript-comment">dnl with or without modifications, as long as this notice is preserved.
</span>
<span class="enscript-comment">dnl From Bruno Haible.
</span>
AC_DEFUN([gl_SIZE_MAX],
[
  AC_CHECK_HEADERS(stdint.h)
  <span class="enscript-comment">dnl First test whether the system already has SIZE_MAX.
</span>  AC_MSG_CHECKING([for SIZE_MAX])
  result=
  AC_EGREP_CPP([Found it], [
<span class="enscript-comment">#include &lt;limits.h&gt;
</span><span class="enscript-comment">#if HAVE_STDINT_H
</span><span class="enscript-comment">#include &lt;stdint.h&gt;
</span><span class="enscript-comment">#endif
</span><span class="enscript-comment">#ifdef SIZE_MAX
</span>Found it
<span class="enscript-comment">#endif
</span>], result=yes)
  if test -z &quot;$result&quot;; then
    <span class="enscript-comment">dnl Define it ourselves. Here we assume that the type 'size_t' is not wider
</span>    <span class="enscript-comment">dnl than the type 'unsigned long'. Try hard to find a definition that can
</span>    <span class="enscript-comment">dnl be used in a preprocessor #if, i.e. doesn't contain a cast.
</span>    _AC_COMPUTE_INT([sizeof (size_t) * CHAR_BIT - 1], size_t_bits_minus_1,
      [<span class="enscript-comment">#include &lt;stddef.h&gt;
</span><span class="enscript-comment">#include &lt;limits.h&gt;], size_t_bits_minus_1=)
</span>    _AC_COMPUTE_INT([sizeof (size_t) &lt;= sizeof (unsigned int)], fits_in_uint,
      [<span class="enscript-comment">#include &lt;stddef.h&gt;], fits_in_uint=)
</span>    if test -n &quot;$size_t_bits_minus_1&quot; &amp;&amp; test -n &quot;$fits_in_uint&quot;; then
      if test $fits_in_uint = 1; then
        <span class="enscript-comment">dnl Even though SIZE_MAX fits in an unsigned int, it must be of type
</span>        <span class="enscript-comment">dnl 'unsigned long' if the type 'size_t' is the same as 'unsigned long'.
</span>        AC_TRY_COMPILE([<span class="enscript-comment">#include &lt;stddef.h&gt;
</span>          extern size_t foo;
          extern unsigned long foo;
          ], [], fits_in_uint=0)
      fi
      <span class="enscript-comment">dnl We cannot use 'expr' to simplify this expression, because 'expr'
</span>      <span class="enscript-comment">dnl works only with 'long' integers in the host environment, while we
</span>      <span class="enscript-comment">dnl might be cross-compiling from a 32-bit platform to a 64-bit platform.
</span>      if test $fits_in_uint = 1; then
        result=&quot;(((1U &lt;&lt; $size_t_bits_minus_1) - 1) * 2 + 1)&quot;
      else
        result=&quot;(((1UL &lt;&lt; $size_t_bits_minus_1) - 1) * 2 + 1)&quot;
      fi
    else
      <span class="enscript-comment">dnl Shouldn't happen, but who knows...
</span>      result='((size_t)~(size_t)0)'
    fi
  fi
  AC_MSG_RESULT([$result])
  if test &quot;$result&quot; != yes; then
    AC_DEFINE_UNQUOTED([SIZE_MAX], [$result],
      [Define as the maximum value of type 'size_t', if the system doesn't <span class="enscript-keyword">define</span> it.])
  fi
])
</pre>
<hr />
</body></html>