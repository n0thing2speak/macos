<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>ltmain.sh</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">ltmain.sh&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment"># ltmain.sh - Provide generalized library-building support services.
</span><span class="enscript-comment"># NOTE: Changing this file will not affect anything until you rerun configure.
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005
</span><span class="enscript-comment"># Free Software Foundation, Inc.
</span><span class="enscript-comment"># Originally by Gordon Matzigkeit &lt;<a href="mailto:gord@gnu.ai.mit.edu">gord@gnu.ai.mit.edu</a>&gt;, 1996
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># This program is free software; you can redistribute it and/or modify
</span><span class="enscript-comment"># it under the terms of the GNU General Public License as published by
</span><span class="enscript-comment"># the Free Software Foundation; either version 2 of the License, or
</span><span class="enscript-comment"># (at your option) any later version.
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># This program is distributed in the hope that it will be useful, but
</span><span class="enscript-comment"># WITHOUT ANY WARRANTY; without even the implied warranty of
</span><span class="enscript-comment"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
</span><span class="enscript-comment"># General Public License for more details.
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># You should have received a copy of the GNU General Public License
</span><span class="enscript-comment"># along with this program; if not, write to the Free Software
</span><span class="enscript-comment"># Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># As a special exception to the GNU General Public License, if you
</span><span class="enscript-comment"># distribute this file as part of a program that contains a
</span><span class="enscript-comment"># configuration script generated by Autoconf, you may include it under
</span><span class="enscript-comment"># the same distribution terms that you use for the rest of that program.
</span>
basename=<span class="enscript-string">&quot;s,^.*/,,g&quot;</span>

<span class="enscript-comment"># Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
</span><span class="enscript-comment"># is ksh but when the shell is invoked as &quot;sh&quot; and the current value of
</span><span class="enscript-comment"># the _XPG environment variable is not equal to 1 (one), the special
</span><span class="enscript-comment"># positional parameter $0, within a function call, is the name of the
</span><span class="enscript-comment"># function.
</span>progpath=<span class="enscript-string">&quot;$0&quot;</span>

<span class="enscript-comment"># The name of this program:
</span>progname=`<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$progpath&quot;</span> | $SED $basename`
modename=<span class="enscript-string">&quot;$progname&quot;</span>

<span class="enscript-comment"># Global variables:
</span>EXIT_SUCCESS=0
EXIT_FAILURE=1

PROGRAM=ltmain.sh
PACKAGE=libtool
VERSION=1.5.22
TIMESTAMP=<span class="enscript-string">&quot; (1.1220.2.365 2005/12/18 22:14:06)&quot;</span>

<span class="enscript-comment"># See if we are running on zsh, and set the options which allow our
</span><span class="enscript-comment"># commands through without removal of \ escapes.
</span><span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;${ZSH_VERSION+set}&quot;</span> ; <span class="enscript-keyword">then</span>
  setopt NO_GLOB_SUBST
<span class="enscript-keyword">fi</span>

<span class="enscript-comment"># Check that we have a working $echo.
</span><span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$1&quot;</span> = X--no-reexec; <span class="enscript-keyword">then</span>
  <span class="enscript-comment"># Discard the --no-reexec flag, and continue.
</span>  <span class="enscript-keyword">shift</span>
elif <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$1&quot;</span> = X--fallback-<span class="enscript-keyword">echo</span>; <span class="enscript-keyword">then</span>
  <span class="enscript-comment"># Avoid inline document here, it may be left over
</span>  :
elif <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X`($echo '\t') 2&gt;/dev/null`&quot;</span> = 'X\t'; <span class="enscript-keyword">then</span>
  <span class="enscript-comment"># Yippee, $echo works!
</span>  :
<span class="enscript-keyword">else</span>
  <span class="enscript-comment"># Restart under the correct shell, and then maybe $echo will work.
</span>  <span class="enscript-keyword">exec</span> $<span class="enscript-keyword">SHELL</span> <span class="enscript-string">&quot;$progpath&quot;</span> --no-reexec ${1+<span class="enscript-string">&quot;$@&quot;</span>}
<span class="enscript-keyword">fi</span>

<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$1&quot;</span> = X--fallback-<span class="enscript-keyword">echo</span>; <span class="enscript-keyword">then</span>
  <span class="enscript-comment"># used as fallback echo
</span>  <span class="enscript-keyword">shift</span>
  cat &lt;&lt;EOF
$*
EOF
  <span class="enscript-keyword">exit</span> $EXIT_SUCCESS
<span class="enscript-keyword">fi</span>

default_mode=
help=<span class="enscript-string">&quot;Try \`$progname --help' for more information.&quot;</span>
magic=<span class="enscript-string">&quot;%%%MAGIC variable%%%&quot;</span>
mkdir=<span class="enscript-string">&quot;mkdir&quot;</span>
mv=<span class="enscript-string">&quot;mv -f&quot;</span>
rm=<span class="enscript-string">&quot;rm -f&quot;</span>

<span class="enscript-comment"># Sed substitution that helps us do robust quoting.  It backslashifies
</span><span class="enscript-comment"># metacharacters that are still active within double-quoted strings.
</span>Xsed=<span class="enscript-string">&quot;${SED}&quot;</span>' -e 1s/^X//'
sed_quote_subst='s/\([\\`\\<span class="enscript-string">&quot;$\\\\]\)/\\\1/g'
# test EBCDIC or ASCII
case `echo X|tr X '\101'` in
 A) # ASCII based system
    # \n is not interpreted correctly by Solaris 8 /usr/ucb/tr
  SP2NL='tr \040 \012'
  NL2SP='tr \015\012 \040\040'
  ;;
 *) # EBCDIC based system
  SP2NL='tr \100 \n'
  NL2SP='tr \r\n \100\100'
  ;;
esac

# NLS nuisances.
# Only set LANG and LC_ALL to C if already set.
# These must not be set unconditionally because not all systems understand
# e.g. LANG=C (notably SCO).
# We save the old values to restore during execute mode.
if test &quot;</span>${LC_ALL+<span class="enscript-keyword">set</span>}<span class="enscript-string">&quot; = set; then
  save_LC_ALL=&quot;</span>$LC_ALL<span class="enscript-string">&quot;; LC_ALL=C; export LC_ALL
fi
if test &quot;</span>${LANG+<span class="enscript-keyword">set</span>}<span class="enscript-string">&quot; = set; then
  save_LANG=&quot;</span>$LANG<span class="enscript-string">&quot;; LANG=C; export LANG
fi

# Make sure IFS has a sensible default
lt_nl='
'
IFS=&quot;</span> 	$lt_nl<span class="enscript-string">&quot;

if test &quot;</span>$build_libtool_libs<span class="enscript-string">&quot; != yes &amp;&amp; test &quot;</span>$build_old_libs<span class="enscript-string">&quot; != yes; then
  $echo &quot;</span>$modename: not configured to build any kind of library<span class="enscript-string">&quot; 1&gt;&amp;2
  $echo &quot;</span>Fatal configuration error.  See the $PACKAGE docs <span class="enscript-keyword">for</span> more information.<span class="enscript-string">&quot; 1&gt;&amp;2
  exit $EXIT_FAILURE
fi

# Global variables.
mode=$default_mode
nonopt=
prev=
prevopt=
run=
show=&quot;</span>$<span class="enscript-keyword">echo</span><span class="enscript-string">&quot;
show_help=
execute_dlfiles=
duplicate_deps=no
preserve_args=
lo2o=&quot;</span>s/\\.lo\$/.${objext}/<span class="enscript-string">&quot;
o2lo=&quot;</span>s/\\.${objext}\$/.lo/<span class="enscript-string">&quot;

#####################################
# Shell function definitions:
# This seems to be the best place for them

# func_mktempdir [string]
# Make a temporary directory that won't clash with other running
# libtool processes, and avoids race conditions if possible.  If
# given, STRING is the basename for that directory.
func_mktempdir ()
{
    my_template=&quot;</span>${TMPDIR-/tmp}/${1-$progname}<span class="enscript-string">&quot;

    if test &quot;</span>$run<span class="enscript-string">&quot; = &quot;</span>:<span class="enscript-string">&quot;; then
      # Return a directory name, but don't create it in dry-run mode
      my_tmpdir=&quot;</span>${my_template}-$$<span class="enscript-string">&quot;
    else

      # If mktemp works, use that first and foremost
      my_tmpdir=`mktemp -d &quot;</span>${my_template}-XXXXXXXX<span class="enscript-string">&quot; 2&gt;/dev/null`

      if test ! -d &quot;</span>$my_tmpdir<span class="enscript-string">&quot;; then
	# Failing that, at least try and use $RANDOM to avoid a race
	my_tmpdir=&quot;</span>${my_template}-${RANDOM-0}$$<span class="enscript-string">&quot;

	save_mktempdir_umask=`umask`
	umask 0077
	$mkdir &quot;</span>$my_tmpdir<span class="enscript-string">&quot;
	umask $save_mktempdir_umask
      fi

      # If we're not in dry-run mode, bomb out on failure
      test -d &quot;</span>$my_tmpdir<span class="enscript-string">&quot; || {
        $echo &quot;</span>cannot create temporary directory \`$my_tmpdir'<span class="enscript-string">&quot; 1&gt;&amp;2
	exit $EXIT_FAILURE
      }
    fi

    $echo &quot;</span>X$my_tmpdir<span class="enscript-string">&quot; | $Xsed
}


# func_win32_libid arg
# return the library type of file 'arg'
#
# Need a lot of goo to handle *both* DLLs and import libs
# Has to be a shell function in order to 'eat' the argument
# that is supplied when $file_magic_command is called.
func_win32_libid ()
{
  win32_libid_type=&quot;</span>unknown<span class="enscript-string">&quot;
  win32_fileres=`file -L $1 2&gt;/dev/null`
  case $win32_fileres in
  *ar\ archive\ import\ library*) # definitely import
    win32_libid_type=&quot;</span>x86 archive import<span class="enscript-string">&quot;
    ;;
  *ar\ archive*) # could be an import, or static
    if eval $OBJDUMP -f $1 | $SED -e '10q' 2&gt;/dev/null | \
      $EGREP -e 'file format pe-i386(.*architecture: i386)?' &gt;/dev/null ; then
      win32_nmres=`eval $NM -f posix -A $1 | \
	$SED -n -e '1,100{/ I /{s,.*,import,;p;q;};}'`
      case $win32_nmres in
      import*)  win32_libid_type=&quot;</span>x86 archive import<span class="enscript-string">&quot;;;
      *)        win32_libid_type=&quot;</span>x86 archive static<span class="enscript-string">&quot;;;
      esac
    fi
    ;;
  *DLL*)
    win32_libid_type=&quot;</span>x86 DLL<span class="enscript-string">&quot;
    ;;
  *executable*) # but shell scripts are &quot;</span>executable<span class="enscript-string">&quot; too...
    case $win32_fileres in
    *MS\ Windows\ PE\ Intel*)
      win32_libid_type=&quot;</span>x86 DLL<span class="enscript-string">&quot;
      ;;
    esac
    ;;
  esac
  $echo $win32_libid_type
}


# func_infer_tag arg
# Infer tagged configuration to use if any are available and
# if one wasn't chosen via the &quot;</span>--tag<span class="enscript-string">&quot; command line option.
# Only attempt this if the compiler in the base compile
# command doesn't match the default compiler.
# arg is usually of the form 'gcc ...'
func_infer_tag ()
{
    if test -n &quot;</span>$available_tags<span class="enscript-string">&quot; &amp;&amp; test -z &quot;</span>$tagname<span class="enscript-string">&quot;; then
      CC_quoted=
      for arg in $CC; do
	case $arg in
	  *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;</span><span class="enscript-string">&quot;)
	  arg=&quot;</span>\<span class="enscript-string">&quot;$arg\&quot;&quot;</span>
	  ;;
	<span class="enscript-keyword">esac</span>
	CC_quoted=<span class="enscript-string">&quot;$CC_quoted $arg&quot;</span>
      <span class="enscript-keyword">done</span>
      <span class="enscript-keyword">case</span> $@ <span class="enscript-keyword">in</span>
      <span class="enscript-comment"># Blanks in the command may have been stripped by the calling shell,
</span>      <span class="enscript-comment"># but not from the CC environment variable when configure was run.
</span>      <span class="enscript-string">&quot; $CC &quot;</span>* | <span class="enscript-string">&quot;$CC &quot;</span>* | <span class="enscript-string">&quot; `$echo $CC` &quot;</span>* | <span class="enscript-string">&quot;`$echo $CC` &quot;</span>* | <span class="enscript-string">&quot; $CC_quoted&quot;</span>* | <span class="enscript-string">&quot;$CC_quoted &quot;</span>* | <span class="enscript-string">&quot; `$echo $CC_quoted` &quot;</span>* | <span class="enscript-string">&quot;`$echo $CC_quoted` &quot;</span>*) ;;
      <span class="enscript-comment"># Blanks at the start of $base_compile will cause this to fail
</span>      <span class="enscript-comment"># if we don't check for them as well.
</span>      *)
	<span class="enscript-keyword">for</span> z <span class="enscript-keyword">in</span> $available_tags; <span class="enscript-keyword">do</span>
	  <span class="enscript-keyword">if</span> grep <span class="enscript-string">&quot;^# ### BEGIN LIBTOOL TAG CONFIG: $z$&quot;</span> &lt; <span class="enscript-string">&quot;$progpath&quot;</span> &gt; /dev/null; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># Evaluate the configuration.
</span>	    <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' &lt; $progpath`&quot;</span>
	    CC_quoted=
	    <span class="enscript-keyword">for</span> arg <span class="enscript-keyword">in</span> $CC; <span class="enscript-keyword">do</span>
	    <span class="enscript-comment"># Double-quote args containing other shell metacharacters.
</span>	    <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
	      *[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	      arg=<span class="enscript-string">&quot;\&quot;$arg\&quot;&quot;</span>
	      ;;
	    <span class="enscript-keyword">esac</span>
	    CC_quoted=<span class="enscript-string">&quot;$CC_quoted $arg&quot;</span>
	  <span class="enscript-keyword">done</span>
	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$@ &quot;</span> <span class="enscript-keyword">in</span>
	      <span class="enscript-string">&quot; $CC &quot;</span>* | <span class="enscript-string">&quot;$CC &quot;</span>* | <span class="enscript-string">&quot; `$echo $CC` &quot;</span>* | <span class="enscript-string">&quot;`$echo $CC` &quot;</span>* | <span class="enscript-string">&quot; $CC_quoted&quot;</span>* | <span class="enscript-string">&quot;$CC_quoted &quot;</span>* | <span class="enscript-string">&quot; `$echo $CC_quoted` &quot;</span>* | <span class="enscript-string">&quot;`$echo $CC_quoted` &quot;</span>*)
	      <span class="enscript-comment"># The compiler in the base compile command matches
</span>	      <span class="enscript-comment"># the one in the tagged configuration.
</span>	      <span class="enscript-comment"># Assume this is the tagged configuration we want.
</span>	      tagname=$z
	      <span class="enscript-keyword">break</span>
	      ;;
	    <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">done</span>
	<span class="enscript-comment"># If $tagname still isn't set, then no tagged configuration
</span>	<span class="enscript-comment"># was found and let the user know that the &quot;--tag&quot; command
</span>	<span class="enscript-comment"># line option must be used.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$tagname&quot;</span>; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: unable to infer tagged configuration&quot;</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: specify a tag with \`--tag'&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
<span class="enscript-comment">#        else
</span><span class="enscript-comment">#          $echo &quot;$modename: using $tagname tagged configuration&quot;
</span>	<span class="enscript-keyword">fi</span>
	;;
      <span class="enscript-keyword">esac</span>
    <span class="enscript-keyword">fi</span>
}


<span class="enscript-comment"># func_extract_an_archive dir oldlib
</span>func_extract_an_archive ()
{
    f_ex_an_ar_dir=<span class="enscript-string">&quot;$1&quot;</span>; <span class="enscript-keyword">shift</span>
    f_ex_an_ar_oldlib=<span class="enscript-string">&quot;$1&quot;</span>

    $show <span class="enscript-string">&quot;(cd $f_ex_an_ar_dir &amp;&amp; $AR x $f_ex_an_ar_oldlib)&quot;</span>
    $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;(cd \$f_ex_an_ar_dir &amp;&amp; $AR x \$f_ex_an_ar_oldlib)&quot;</span> || <span class="enscript-keyword">exit</span> $?
    <span class="enscript-keyword">if</span> ($AR t <span class="enscript-string">&quot;$f_ex_an_ar_oldlib&quot;</span> | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); <span class="enscript-keyword">then</span>
     :
    <span class="enscript-keyword">else</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: ERROR: object name conflicts: $f_ex_an_ar_dir/$f_ex_an_ar_oldlib&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
    <span class="enscript-keyword">fi</span>
}

<span class="enscript-comment"># func_extract_archives gentop oldlib ...
</span>func_extract_archives ()
{
    my_gentop=<span class="enscript-string">&quot;$1&quot;</span>; <span class="enscript-keyword">shift</span>
    my_oldlibs=${1+<span class="enscript-string">&quot;$@&quot;</span>}
    my_oldobjs=<span class="enscript-string">&quot;&quot;</span>
    my_xlib=<span class="enscript-string">&quot;&quot;</span>
    my_xabs=<span class="enscript-string">&quot;&quot;</span>
    my_xdir=<span class="enscript-string">&quot;&quot;</span>
    my_status=<span class="enscript-string">&quot;&quot;</span>

    $show <span class="enscript-string">&quot;${rm}r $my_gentop&quot;</span>
    $run ${rm}r <span class="enscript-string">&quot;$my_gentop&quot;</span>
    $show <span class="enscript-string">&quot;$mkdir $my_gentop&quot;</span>
    $run $mkdir <span class="enscript-string">&quot;$my_gentop&quot;</span>
    my_status=$?
    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$my_status&quot;</span> -ne 0 &amp;&amp; <span class="enscript-keyword">test</span> ! -d <span class="enscript-string">&quot;$my_gentop&quot;</span>; <span class="enscript-keyword">then</span>
      <span class="enscript-keyword">exit</span> $my_status
    <span class="enscript-keyword">fi</span>

    <span class="enscript-keyword">for</span> my_xlib <span class="enscript-keyword">in</span> $my_oldlibs; <span class="enscript-keyword">do</span>
      <span class="enscript-comment"># Extract the objects.
</span>      <span class="enscript-keyword">case</span> $my_xlib <span class="enscript-keyword">in</span>
	[\\/]* | [A-Za-z]:[\\/]*) my_xabs=<span class="enscript-string">&quot;$my_xlib&quot;</span> ;;
	*) my_xabs=`<span class="enscript-keyword">pwd</span>`<span class="enscript-string">&quot;/$my_xlib&quot;</span> ;;
      <span class="enscript-keyword">esac</span>
      my_xlib=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$my_xlib&quot;</span> | $Xsed -e 's%^.*/%%'`
      my_xdir=<span class="enscript-string">&quot;$my_gentop/$my_xlib&quot;</span>

      $show <span class="enscript-string">&quot;${rm}r $my_xdir&quot;</span>
      $run ${rm}r <span class="enscript-string">&quot;$my_xdir&quot;</span>
      $show <span class="enscript-string">&quot;$mkdir $my_xdir&quot;</span>
      $run $mkdir <span class="enscript-string">&quot;$my_xdir&quot;</span>
      exit_status=$?
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$exit_status&quot;</span> -ne 0 &amp;&amp; <span class="enscript-keyword">test</span> ! -d <span class="enscript-string">&quot;$my_xdir&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">exit</span> $exit_status
      <span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
      *-darwin*)
	$show <span class="enscript-string">&quot;Extracting $my_xabs&quot;</span>
	<span class="enscript-comment"># Do not bother doing anything if just a dry run
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span>; <span class="enscript-keyword">then</span>
	  darwin_orig_dir=`<span class="enscript-keyword">pwd</span>`
	  <span class="enscript-keyword">cd</span> $my_xdir || <span class="enscript-keyword">exit</span> $?
	  darwin_archive=$my_xabs
	  darwin_curdir=`<span class="enscript-keyword">pwd</span>`
	  darwin_base_archive=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$darwin_archive&quot;</span> | $Xsed -e 's%^.*/%%'`
	  darwin_arches=`lipo -info <span class="enscript-string">&quot;$darwin_archive&quot;</span> 2&gt;/dev/null | $EGREP Architectures 2&gt;/dev/null`
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$darwin_arches&quot;</span>; <span class="enscript-keyword">then</span> 
	    darwin_arches=`<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$darwin_arches&quot;</span> | $SED -e 's/.*are://'`
	    darwin_arch=
	    $show <span class="enscript-string">&quot;$darwin_base_archive has multiple architectures $darwin_arches&quot;</span>
	    <span class="enscript-keyword">for</span> darwin_arch <span class="enscript-keyword">in</span>  $darwin_arches ; <span class="enscript-keyword">do</span>
	      mkdir -p <span class="enscript-string">&quot;unfat-$$/${darwin_base_archive}-${darwin_arch}&quot;</span>
	      lipo -thin $darwin_arch -output <span class="enscript-string">&quot;unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}&quot;</span> <span class="enscript-string">&quot;${darwin_archive}&quot;</span>
	      <span class="enscript-keyword">cd</span> <span class="enscript-string">&quot;unfat-$$/${darwin_base_archive}-${darwin_arch}&quot;</span>
	      func_extract_an_archive <span class="enscript-string">&quot;`pwd`&quot;</span> <span class="enscript-string">&quot;${darwin_base_archive}&quot;</span>
	      <span class="enscript-keyword">cd</span> <span class="enscript-string">&quot;$darwin_curdir&quot;</span>
	      $rm <span class="enscript-string">&quot;unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}&quot;</span>
	    <span class="enscript-keyword">done</span> <span class="enscript-comment"># $darwin_arches
</span>      <span class="enscript-comment">## Okay now we have a bunch of thin objects, gotta fatten them up :)
</span>	    darwin_filelist=`find unfat-$$ -<span class="enscript-keyword">type</span> f -name \*.o -print -o -name \*.lo -print| xargs basename | sort -u | $NL2SP`
	    darwin_file=
	    darwin_files=
	    <span class="enscript-keyword">for</span> darwin_file <span class="enscript-keyword">in</span> $darwin_filelist; <span class="enscript-keyword">do</span>
	      darwin_files=`find unfat-$$ -name $darwin_file -print | $NL2SP`
	      lipo -create -output <span class="enscript-string">&quot;$darwin_file&quot;</span> $darwin_files
	    <span class="enscript-keyword">done</span> <span class="enscript-comment"># $darwin_filelist
</span>	    ${rm}r unfat-$$
	    <span class="enscript-keyword">cd</span> <span class="enscript-string">&quot;$darwin_orig_dir&quot;</span>
	  <span class="enscript-keyword">else</span>
	    <span class="enscript-keyword">cd</span> <span class="enscript-string">&quot;$darwin_orig_dir&quot;</span>
 	    func_extract_an_archive <span class="enscript-string">&quot;$my_xdir&quot;</span> <span class="enscript-string">&quot;$my_xabs&quot;</span>
	  <span class="enscript-keyword">fi</span> <span class="enscript-comment"># $darwin_arches
</span>	<span class="enscript-keyword">fi</span> <span class="enscript-comment"># $run
</span>	;;
      *)
        func_extract_an_archive <span class="enscript-string">&quot;$my_xdir&quot;</span> <span class="enscript-string">&quot;$my_xabs&quot;</span>
        ;;
      <span class="enscript-keyword">esac</span>
      my_oldobjs=<span class="enscript-string">&quot;$my_oldobjs &quot;</span>`find $my_xdir -name \*.$objext -print -o -name \*.lo -print | $NL2SP`
    <span class="enscript-keyword">done</span>
    func_extract_archives_result=<span class="enscript-string">&quot;$my_oldobjs&quot;</span>
}
<span class="enscript-comment"># End of Shell function definitions
</span><span class="enscript-comment">#####################################
</span>
<span class="enscript-comment"># Darwin sucks
</span><span class="enscript-keyword">eval</span> std_shrext=\<span class="enscript-string">&quot;$shrext_cmds\&quot;

disable_libs=no

# Parse our command line options once, thoroughly.
while test &quot;</span>$<span class="enscript-comment">#&quot; -gt 0
</span><span class="enscript-keyword">do</span>
  arg=<span class="enscript-string">&quot;$1&quot;</span>
  <span class="enscript-keyword">shift</span>

  <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
  -*=*) optarg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e 's/[-_a-zA-Z0-9]*=//'` ;;
  *) optarg= ;;
  <span class="enscript-keyword">esac</span>

  <span class="enscript-comment"># If the previous option needs an argument, assign it.
</span>  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$prev&quot;</span>; <span class="enscript-keyword">then</span>
    <span class="enscript-keyword">case</span> $prev <span class="enscript-keyword">in</span>
    execute_dlfiles)
      execute_dlfiles=<span class="enscript-string">&quot;$execute_dlfiles $arg&quot;</span>
      ;;
    tag)
      tagname=<span class="enscript-string">&quot;$arg&quot;</span>
      preserve_args=<span class="enscript-string">&quot;${preserve_args}=$arg&quot;</span>

      <span class="enscript-comment"># Check whether tagname contains only valid characters
</span>      <span class="enscript-keyword">case</span> $tagname <span class="enscript-keyword">in</span>
      *[!-_A-Za-z0-9,/]*)
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$progname: invalid tag name: $tagname&quot;</span> 1&gt;&amp;2
	<span class="enscript-keyword">exit</span> $EXIT_FAILURE
	;;
      <span class="enscript-keyword">esac</span>

      <span class="enscript-keyword">case</span> $tagname <span class="enscript-keyword">in</span>
      CC)
	<span class="enscript-comment"># Don't test for the &quot;default&quot; C tag, as we know, it's there, but
</span>	<span class="enscript-comment"># not specially marked.
</span>	;;
      *)
	<span class="enscript-keyword">if</span> grep <span class="enscript-string">&quot;^# ### BEGIN LIBTOOL TAG CONFIG: $tagname$&quot;</span> &lt; <span class="enscript-string">&quot;$progpath&quot;</span> &gt; /dev/null; <span class="enscript-keyword">then</span>
	  taglist=<span class="enscript-string">&quot;$taglist $tagname&quot;</span>
	  <span class="enscript-comment"># Evaluate the configuration.
</span>	  <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$tagname'$/,/^# ### END LIBTOOL TAG CONFIG: '$tagname'$/p' &lt; $progpath`&quot;</span>
	<span class="enscript-keyword">else</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$progname: ignoring unknown tag $tagname&quot;</span> 1&gt;&amp;2
	<span class="enscript-keyword">fi</span>
	;;
      <span class="enscript-keyword">esac</span>
      ;;
    *)
      <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$prev=\$arg&quot;</span>
      ;;
    <span class="enscript-keyword">esac</span>

    prev=
    prevopt=
    <span class="enscript-keyword">continue</span>
  <span class="enscript-keyword">fi</span>

  <span class="enscript-comment"># Have we seen a non-optional argument yet?
</span>  <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
  --help)
    show_help=yes
    ;;

  --version)
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$PROGRAM (GNU $PACKAGE) $VERSION$TIMESTAMP&quot;</span>
    $<span class="enscript-keyword">echo</span>
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;Copyright (C) 2005  Free Software Foundation, Inc.&quot;</span>
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;This is free software; see the source for copying conditions.  There is NO&quot;</span>
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;</span>
    <span class="enscript-keyword">exit</span> $?
    ;;

  --config)
    ${SED} -e '1,/^<span class="enscript-comment"># ### BEGIN LIBTOOL CONFIG/d' -e '/^# ### END LIBTOOL CONFIG/,$d' $progpath
</span>    <span class="enscript-comment"># Now print the configurations for the tags.
</span>    <span class="enscript-keyword">for</span> tagname <span class="enscript-keyword">in</span> $taglist; <span class="enscript-keyword">do</span>
      ${SED} -n -e <span class="enscript-string">&quot;/^# ### BEGIN LIBTOOL TAG CONFIG: $tagname$/,/^# ### END LIBTOOL TAG CONFIG: $tagname$/p&quot;</span> &lt; <span class="enscript-string">&quot;$progpath&quot;</span>
    <span class="enscript-keyword">done</span>
    <span class="enscript-keyword">exit</span> $?
    ;;

  --debug)
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$progname: enabling shell trace mode&quot;</span>
    <span class="enscript-keyword">set</span> -x
    preserve_args=<span class="enscript-string">&quot;$preserve_args $arg&quot;</span>
    ;;

  --dry-run | -n)
    run=:
    ;;

  --features)
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;host: $host&quot;</span>
    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = yes; <span class="enscript-keyword">then</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;enable shared libraries&quot;</span>
    <span class="enscript-keyword">else</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;disable shared libraries&quot;</span>
    <span class="enscript-keyword">fi</span>
    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_old_libs&quot;</span> = yes; <span class="enscript-keyword">then</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;enable static libraries&quot;</span>
    <span class="enscript-keyword">else</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;disable static libraries&quot;</span>
    <span class="enscript-keyword">fi</span>
    <span class="enscript-keyword">exit</span> $?
    ;;

  --finish) mode=<span class="enscript-string">&quot;finish&quot;</span> ;;

  --mode) prevopt=<span class="enscript-string">&quot;--mode&quot;</span> prev=mode ;;
  --mode=*) mode=<span class="enscript-string">&quot;$optarg&quot;</span> ;;

  --preserve-dup-deps) duplicate_deps=<span class="enscript-string">&quot;yes&quot;</span> ;;

  --quiet | --silent)
    show=:
    preserve_args=<span class="enscript-string">&quot;$preserve_args $arg&quot;</span>
    ;;

  --tag)
    prevopt=<span class="enscript-string">&quot;--tag&quot;</span>
    prev=tag
    preserve_args=<span class="enscript-string">&quot;$preserve_args --tag&quot;</span>
    ;;
  --tag=*)
    <span class="enscript-keyword">set</span> tag <span class="enscript-string">&quot;$optarg&quot;</span> ${1+<span class="enscript-string">&quot;$@&quot;</span>}
    <span class="enscript-keyword">shift</span>
    prev=tag
    preserve_args=<span class="enscript-string">&quot;$preserve_args --tag&quot;</span>
    ;;

  -dlopen)
    prevopt=<span class="enscript-string">&quot;-dlopen&quot;</span>
    prev=execute_dlfiles
    ;;

  -*)
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: unrecognized option \`$arg'&quot;</span> 1&gt;&amp;2
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
    ;;

  *)
    nonopt=<span class="enscript-string">&quot;$arg&quot;</span>
    <span class="enscript-keyword">break</span>
    ;;
  <span class="enscript-keyword">esac</span>
<span class="enscript-keyword">done</span>

<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$prevopt&quot;</span>; <span class="enscript-keyword">then</span>
  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: option \`$prevopt' requires an argument&quot;</span> 1&gt;&amp;2
  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
<span class="enscript-keyword">fi</span>

<span class="enscript-keyword">case</span> $disable_libs <span class="enscript-keyword">in</span>
no) 
  ;;
shared)
  build_libtool_libs=no
  build_old_libs=yes
  ;;
static)
  build_old_libs=`<span class="enscript-keyword">case</span> $build_libtool_libs <span class="enscript-keyword">in</span> yes) <span class="enscript-keyword">echo</span> no;; *) <span class="enscript-keyword">echo</span> yes;; <span class="enscript-keyword">esac</span>`
  ;;
<span class="enscript-keyword">esac</span>

<span class="enscript-comment"># If this variable is set in any of the actions, the command in it
</span><span class="enscript-comment"># will be execed at the end.  This prevents here-documents from being
</span><span class="enscript-comment"># left over by shells.
</span>exec_cmd=

<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$show_help&quot;</span>; <span class="enscript-keyword">then</span>

  <span class="enscript-comment"># Infer the operation mode.
</span>  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$mode&quot;</span>; <span class="enscript-keyword">then</span>
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;*** Warning: inferring the mode of operation is deprecated.&quot;</span> 1&gt;&amp;2
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;*** Future versions of Libtool will require --mode=MODE be specified.&quot;</span> 1&gt;&amp;2
    <span class="enscript-keyword">case</span> $nonopt <span class="enscript-keyword">in</span>
    *cc | cc* | *++ | gcc* | *-gcc* | g++* | xlc*)
      mode=link
      <span class="enscript-keyword">for</span> arg
      <span class="enscript-keyword">do</span>
	<span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
	-c)
	   mode=compile
	   <span class="enscript-keyword">break</span>
	   ;;
	<span class="enscript-keyword">esac</span>
      <span class="enscript-keyword">done</span>
      ;;
    *db | *dbx | *strace | *truss)
      mode=execute
      ;;
    *install*|cp|mv)
      mode=install
      ;;
    *rm)
      mode=uninstall
      ;;
    *)
      <span class="enscript-comment"># If we have no mode, but dlfiles were specified, then do execute mode.
</span>      <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$execute_dlfiles&quot;</span> &amp;&amp; mode=execute

      <span class="enscript-comment"># Just use the default operation mode.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$mode&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$nonopt&quot;</span>; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: cannot infer operation mode from \`$nonopt'&quot;</span> 1&gt;&amp;2
	<span class="enscript-keyword">else</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: cannot infer operation mode without MODE-ARGS&quot;</span> 1&gt;&amp;2
	<span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">fi</span>
      ;;
    <span class="enscript-keyword">esac</span>
  <span class="enscript-keyword">fi</span>

  <span class="enscript-comment"># Only execute mode is allowed to have -dlopen flags.
</span>  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$execute_dlfiles&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$mode&quot;</span> != execute; <span class="enscript-keyword">then</span>
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: unrecognized option \`-dlopen'&quot;</span> 1&gt;&amp;2
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
  <span class="enscript-keyword">fi</span>

  <span class="enscript-comment"># Change the help message to a mode-specific one.
</span>  generic_help=<span class="enscript-string">&quot;$help&quot;</span>
  help=<span class="enscript-string">&quot;Try \`$modename --help --mode=$mode' for more information.&quot;</span>

  <span class="enscript-comment"># These modes are in order of execution frequency so that they run quickly.
</span>  <span class="enscript-keyword">case</span> $mode <span class="enscript-keyword">in</span>
  <span class="enscript-comment"># libtool compile mode
</span>  compile)
    modename=<span class="enscript-string">&quot;$modename: compile&quot;</span>
    <span class="enscript-comment"># Get the compilation command and the source file.
</span>    base_compile=
    srcfile=<span class="enscript-string">&quot;$nonopt&quot;</span>  <span class="enscript-comment">#  always keep a non-empty value in &quot;srcfile&quot;
</span>    suppress_opt=yes
    suppress_output=
    arg_mode=normal
    libobj=
    later=

    <span class="enscript-keyword">for</span> arg
    <span class="enscript-keyword">do</span>
      <span class="enscript-keyword">case</span> $arg_mode <span class="enscript-keyword">in</span>
      arg  )
	<span class="enscript-comment"># do not &quot;continue&quot;.  Instead, add this to base_compile
</span>	lastarg=<span class="enscript-string">&quot;$arg&quot;</span>
	arg_mode=normal
	;;

      target )
	libobj=<span class="enscript-string">&quot;$arg&quot;</span>
	arg_mode=normal
	<span class="enscript-keyword">continue</span>
	;;

      normal )
	<span class="enscript-comment"># Accept any command-line options.
</span>	<span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
	-o)
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$libobj&quot;</span> ; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: you cannot specify \`-o' more than once&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  <span class="enscript-keyword">fi</span>
	  arg_mode=target
	  <span class="enscript-keyword">continue</span>
	  ;;

	-static | -prefer-pic | -prefer-non-pic)
	  later=<span class="enscript-string">&quot;$later $arg&quot;</span>
	  <span class="enscript-keyword">continue</span>
	  ;;

	-no-suppress)
	  suppress_opt=no
	  <span class="enscript-keyword">continue</span>
	  ;;

	-Xcompiler)
	  arg_mode=arg  <span class="enscript-comment">#  the next one goes into the &quot;base_compile&quot; arg list
</span>	  <span class="enscript-keyword">continue</span>      <span class="enscript-comment">#  The current &quot;srcfile&quot; will either be retained or
</span>	  ;;            <span class="enscript-comment">#  replaced later.  I would guess that would be a bug.
</span>
	-Wc,*)
	  args=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s/^-Wc,//&quot;</span>`
	  lastarg=
	  save_ifs=<span class="enscript-string">&quot;$IFS&quot;</span>; <span class="enscript-keyword">IFS</span>=','
 	  <span class="enscript-keyword">for</span> arg <span class="enscript-keyword">in</span> $args; <span class="enscript-keyword">do</span>
	    <span class="enscript-keyword">IFS</span>=<span class="enscript-string">&quot;$save_ifs&quot;</span>

	    <span class="enscript-comment"># Double-quote args containing other shell metacharacters.
</span>	    <span class="enscript-comment"># Many Bourne shells cannot handle close brackets correctly
</span>	    <span class="enscript-comment"># in scan sets, so we specify it separately.
</span>	    <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
	      *[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	      arg=<span class="enscript-string">&quot;\&quot;$arg\&quot;&quot;</span>
	      ;;
	    <span class="enscript-keyword">esac</span>
	    lastarg=<span class="enscript-string">&quot;$lastarg $arg&quot;</span>
	  <span class="enscript-keyword">done</span>
	  <span class="enscript-keyword">IFS</span>=<span class="enscript-string">&quot;$save_ifs&quot;</span>
	  lastarg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$lastarg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s/^ //&quot;</span>`

	  <span class="enscript-comment"># Add the arguments to base_compile.
</span>	  base_compile=<span class="enscript-string">&quot;$base_compile $lastarg&quot;</span>
	  <span class="enscript-keyword">continue</span>
	  ;;

	* )
	  <span class="enscript-comment"># Accept the current argument as the source file.
</span>	  <span class="enscript-comment"># The previous &quot;srcfile&quot; becomes the current argument.
</span>	  <span class="enscript-comment">#
</span>	  lastarg=<span class="enscript-string">&quot;$srcfile&quot;</span>
	  srcfile=<span class="enscript-string">&quot;$arg&quot;</span>
	  ;;
	<span class="enscript-keyword">esac</span>  <span class="enscript-comment">#  case $arg
</span>	;;
      <span class="enscript-keyword">esac</span>    <span class="enscript-comment">#  case $arg_mode
</span>
      <span class="enscript-comment"># Aesthetically quote the previous argument.
</span>      lastarg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$lastarg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`

      <span class="enscript-keyword">case</span> $lastarg <span class="enscript-keyword">in</span>
      <span class="enscript-comment"># Double-quote args containing other shell metacharacters.
</span>      <span class="enscript-comment"># Many Bourne shells cannot handle close brackets correctly
</span>      <span class="enscript-comment"># in scan sets, and some SunOS ksh mistreat backslash-escaping
</span>      <span class="enscript-comment"># in scan sets (worked around with variable expansion),
</span>      <span class="enscript-comment"># and furthermore cannot handle '|' '&amp;' '(' ')' in scan sets 
</span>      <span class="enscript-comment"># at all, so we specify them separately.
</span>      *[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	lastarg=<span class="enscript-string">&quot;\&quot;$lastarg\&quot;&quot;</span>
	;;
      <span class="enscript-keyword">esac</span>

      base_compile=<span class="enscript-string">&quot;$base_compile $lastarg&quot;</span>
    <span class="enscript-keyword">done</span> <span class="enscript-comment"># for arg
</span>
    <span class="enscript-keyword">case</span> $arg_mode <span class="enscript-keyword">in</span>
    arg)
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: you must specify an argument for -Xcompile&quot;</span>
      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
      ;;
    target)
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: you must specify a target with \`-o'&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
      ;;
    *)
      <span class="enscript-comment"># Get the name of the library object.
</span>      [ -z <span class="enscript-string">&quot;$libobj&quot;</span> ] &amp;&amp; libobj=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$srcfile&quot;</span> | $Xsed -e 's%^.*/%%'`
      ;;
    <span class="enscript-keyword">esac</span>

    <span class="enscript-comment"># Recognize several different file suffixes.
</span>    <span class="enscript-comment"># If the user specifies -o file.o, it is replaced with file.lo
</span>    xform='[cCFSifmso]'
    <span class="enscript-keyword">case</span> $libobj <span class="enscript-keyword">in</span>
    *.ada) xform=ada ;;
    *.adb) xform=adb ;;
    *.ads) xform=ads ;;
    *.asm) xform=asm ;;
    *.c++) xform=c++ ;;
    *.cc) xform=cc ;;
    *.ii) xform=ii ;;
    *.class) xform=class ;;
    *.cpp) xform=cpp ;;
    *.cxx) xform=cxx ;;
    *.f90) xform=f90 ;;
    *.<span class="enscript-keyword">for</span>) xform=<span class="enscript-keyword">for</span> ;;
    *.java) xform=java ;;
    <span class="enscript-keyword">esac</span>

    libobj=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$libobj&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s/\.$xform$/.lo/&quot;</span>`

    <span class="enscript-keyword">case</span> $libobj <span class="enscript-keyword">in</span>
    *.lo) obj=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$libobj&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$lo2o&quot;</span>` ;;
    *)
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: cannot determine name of library object from \`$libobj'&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
      ;;
    <span class="enscript-keyword">esac</span>

    func_infer_tag $base_compile

    <span class="enscript-keyword">for</span> arg <span class="enscript-keyword">in</span> $later; <span class="enscript-keyword">do</span>
      <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
      -static)
	build_old_libs=yes
	<span class="enscript-keyword">continue</span>
	;;

      -prefer-pic)
	pic_mode=yes
	<span class="enscript-keyword">continue</span>
	;;

      -prefer-non-pic)
	pic_mode=no
	<span class="enscript-keyword">continue</span>
	;;
      <span class="enscript-keyword">esac</span>
    <span class="enscript-keyword">done</span>

    qlibobj=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$libobj&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
    <span class="enscript-keyword">case</span> $qlibobj <span class="enscript-keyword">in</span>
      *[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	qlibobj=<span class="enscript-string">&quot;\&quot;$qlibobj\&quot;&quot;</span> ;;
    <span class="enscript-keyword">esac</span>
    <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$libobj&quot;</span> != <span class="enscript-string">&quot;X$qlibobj&quot;</span> \
	&amp;&amp; $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$libobj&quot;</span> | grep '[]~<span class="enscript-comment">#^*{};&lt;&gt;?&quot;'&quot;'&quot;' 	&amp;()|`$[]' \
</span>	&amp;&amp; $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: libobj name \`$libobj' may not contain shell special characters.&quot;</span>
    objname=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$obj&quot;</span> | $Xsed -e 's%^.*/%%'`
    xdir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$obj&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$xdir&quot;</span> = <span class="enscript-string">&quot;X$obj&quot;</span>; <span class="enscript-keyword">then</span>
      xdir=
    <span class="enscript-keyword">else</span>
      xdir=$xdir/
    <span class="enscript-keyword">fi</span>
    lobj=${xdir}$objdir/$objname

    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$base_compile&quot;</span>; <span class="enscript-keyword">then</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: you must specify a compilation command&quot;</span> 1&gt;&amp;2
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
    <span class="enscript-keyword">fi</span>

    <span class="enscript-comment"># Delete any leftover library objects.
</span>    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_old_libs&quot;</span> = yes; <span class="enscript-keyword">then</span>
      removelist=<span class="enscript-string">&quot;$obj $lobj $libobj ${libobj}T&quot;</span>
    <span class="enscript-keyword">else</span>
      removelist=<span class="enscript-string">&quot;$lobj $libobj ${libobj}T&quot;</span>
    <span class="enscript-keyword">fi</span>

    $run $rm $removelist
    <span class="enscript-keyword">trap</span> <span class="enscript-string">&quot;$run $rm $removelist; exit $EXIT_FAILURE&quot;</span> 1 2 15

    <span class="enscript-comment"># On Cygwin there's no &quot;real&quot; PIC flag so we must build both object types
</span>    <span class="enscript-keyword">case</span> $host_os <span class="enscript-keyword">in</span>
    cygwin* | mingw* | pw32* | os2*)
      pic_mode=default
      ;;
    <span class="enscript-keyword">esac</span>
    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pic_mode&quot;</span> = no &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$deplibs_check_method&quot;</span> != pass_all; <span class="enscript-keyword">then</span>
      <span class="enscript-comment"># non-PIC code in shared libraries is not supported
</span>      pic_mode=default
    <span class="enscript-keyword">fi</span>

    <span class="enscript-comment"># Calculate the filename of the output object if compiler does
</span>    <span class="enscript-comment"># not support -o with -c
</span>    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$compiler_c_o&quot;</span> = no; <span class="enscript-keyword">then</span>
      output_obj=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$srcfile&quot;</span> | $Xsed -e 's%^.*/%%' -e 's%\.[^.]*$%%'`.${objext}
      lockfile=<span class="enscript-string">&quot;$output_obj.lock&quot;</span>
      removelist=<span class="enscript-string">&quot;$removelist $output_obj $lockfile&quot;</span>
      <span class="enscript-keyword">trap</span> <span class="enscript-string">&quot;$run $rm $removelist; exit $EXIT_FAILURE&quot;</span> 1 2 15
    <span class="enscript-keyword">else</span>
      output_obj=
      need_locks=no
      lockfile=
    <span class="enscript-keyword">fi</span>

    <span class="enscript-comment"># Lock this critical section if it is needed
</span>    <span class="enscript-comment"># We use this script file to make the link, it avoids creating a new file
</span>    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$need_locks&quot;</span> = yes; <span class="enscript-keyword">then</span>
      until $run ln <span class="enscript-string">&quot;$progpath&quot;</span> <span class="enscript-string">&quot;$lockfile&quot;</span> 2&gt;/dev/null; <span class="enscript-keyword">do</span>
	$show <span class="enscript-string">&quot;Waiting for $lockfile to be removed&quot;</span>
	sleep 2
      <span class="enscript-keyword">done</span>
    elif <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$need_locks&quot;</span> = warn; <span class="enscript-keyword">then</span>
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -f <span class="enscript-string">&quot;$lockfile&quot;</span>; <span class="enscript-keyword">then</span>
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;\
*** ERROR, $lockfile exists and contains:
`cat $lockfile 2&gt;/dev/null`

This indicates that another process is trying to use the same
temporary object file, and libtool could not work around it because
your compiler does not support \`-c' and \`-o' together.  If you
repeat this compilation, it may succeed, by chance, but you had better
avoid parallel builds (make -j) in this platform, or get a better
compiler.&quot;</span>

	$run $rm $removelist
	<span class="enscript-keyword">exit</span> $EXIT_FAILURE
      <span class="enscript-keyword">fi</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$srcfile&quot;</span> &gt; <span class="enscript-string">&quot;$lockfile&quot;</span>
    <span class="enscript-keyword">fi</span>

    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$fix_srcfile_path&quot;</span>; <span class="enscript-keyword">then</span>
      <span class="enscript-keyword">eval</span> srcfile=\<span class="enscript-string">&quot;$fix_srcfile_path\&quot;
    fi
    qsrcfile=`$echo &quot;</span>X$srcfile<span class="enscript-string">&quot; | $Xsed -e &quot;</span>$sed_quote_subst<span class="enscript-string">&quot;`
    case $qsrcfile in
      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;</span><span class="enscript-string">&quot;)
      qsrcfile=&quot;</span>\<span class="enscript-string">&quot;$qsrcfile\&quot;&quot;</span> ;;
    <span class="enscript-keyword">esac</span>

    $run $rm <span class="enscript-string">&quot;$libobj&quot;</span> <span class="enscript-string">&quot;${libobj}T&quot;</span>

    <span class="enscript-comment"># Create a libtool object file (analogous to a &quot;.la&quot; file),
</span>    <span class="enscript-comment"># but don't create it if we're doing a dry run.
</span>    <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span> &amp;&amp; cat &gt; ${libobj}T &lt;&lt;EOF
<span class="enscript-comment"># $libobj - a libtool object file
</span><span class="enscript-comment"># Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP
</span><span class="enscript-comment">#
</span><span class="enscript-comment"># Please DO NOT delete this file!
</span><span class="enscript-comment"># It is necessary for linking the library.
</span>
<span class="enscript-comment"># Name of the PIC object.
</span>EOF

    <span class="enscript-comment"># Only build a PIC object if we are building libtool libraries.
</span>    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = yes; <span class="enscript-keyword">then</span>
      <span class="enscript-comment"># Without this assignment, base_compile gets emptied.
</span>      fbsd_hideous_sh_bug=$base_compile

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pic_mode&quot;</span> != no; <span class="enscript-keyword">then</span>
	command=<span class="enscript-string">&quot;$base_compile $qsrcfile $pic_flag&quot;</span>
      <span class="enscript-keyword">else</span>
	<span class="enscript-comment"># Don't build PIC code
</span>	command=<span class="enscript-string">&quot;$base_compile $qsrcfile&quot;</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> ! -d <span class="enscript-string">&quot;${xdir}$objdir&quot;</span>; <span class="enscript-keyword">then</span>
	$show <span class="enscript-string">&quot;$mkdir ${xdir}$objdir&quot;</span>
	$run $mkdir ${xdir}$objdir
	exit_status=$?
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$exit_status&quot;</span> -ne 0 &amp;&amp; <span class="enscript-keyword">test</span> ! -d <span class="enscript-string">&quot;${xdir}$objdir&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">exit</span> $exit_status
	<span class="enscript-keyword">fi</span>
	$show <span class="enscript-string">&quot;chmod 777 ${xdir}$objdir&quot;</span>
	$run chmod 777 ${xdir}$objdir
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$output_obj&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># Place PIC objects in $objdir
</span>	command=<span class="enscript-string">&quot;$command -o $lobj&quot;</span>
      <span class="enscript-keyword">fi</span>

      $run $rm <span class="enscript-string">&quot;$lobj&quot;</span> <span class="enscript-string">&quot;$output_obj&quot;</span>

      $show <span class="enscript-string">&quot;$command&quot;</span>
      <span class="enscript-keyword">if</span> $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$command&quot;</span>; <span class="enscript-keyword">then</span> :
      <span class="enscript-keyword">else</span>
	<span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$output_obj&quot;</span> &amp;&amp; $run $rm $removelist
	<span class="enscript-keyword">exit</span> $EXIT_FAILURE
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$need_locks&quot;</span> = warn &amp;&amp;
	 <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X`cat $lockfile 2&gt;/dev/null`&quot;</span> != <span class="enscript-string">&quot;X$srcfile&quot;</span>; <span class="enscript-keyword">then</span>
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;\
*** ERROR, $lockfile contains:
`cat $lockfile 2&gt;/dev/null`

but it should contain:
$srcfile

This indicates that another process is trying to use the same
temporary object file, and libtool could not work around it because
your compiler does not support \`-c' and \`-o' together.  If you
repeat this compilation, it may succeed, by chance, but you had better
avoid parallel builds (make -j) in this platform, or get a better
compiler.&quot;</span>

	$run $rm $removelist
	<span class="enscript-keyword">exit</span> $EXIT_FAILURE
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Just move the object if needed, then go on to compile the next one
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$output_obj&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$output_obj&quot;</span> != <span class="enscript-string">&quot;X$lobj&quot;</span>; <span class="enscript-keyword">then</span>
	$show <span class="enscript-string">&quot;$mv $output_obj $lobj&quot;</span>
	<span class="enscript-keyword">if</span> $run $mv $output_obj $lobj; <span class="enscript-keyword">then</span> :
	<span class="enscript-keyword">else</span>
	  error=$?
	  $run $rm $removelist
	  <span class="enscript-keyword">exit</span> $error
	<span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Append the name of the PIC object to the libtool object file.
</span>      <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span> &amp;&amp; cat &gt;&gt; ${libobj}T &lt;&lt;EOF
pic_object='$objdir/$objname'

EOF

      <span class="enscript-comment"># Allow error messages only from the first compilation.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$suppress_opt&quot;</span> = yes; <span class="enscript-keyword">then</span>
        suppress_output=' &gt;/dev/null 2&gt;&amp;1'
      <span class="enscript-keyword">fi</span>
    <span class="enscript-keyword">else</span>
      <span class="enscript-comment"># No PIC object so indicate it doesn't exist in the libtool
</span>      <span class="enscript-comment"># object file.
</span>      <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span> &amp;&amp; cat &gt;&gt; ${libobj}T &lt;&lt;EOF
pic_object=none

EOF
    <span class="enscript-keyword">fi</span>

    <span class="enscript-comment"># Only build a position-dependent object if we build old libraries.
</span>    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_old_libs&quot;</span> = yes; <span class="enscript-keyword">then</span>
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pic_mode&quot;</span> != yes; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># Don't build PIC code
</span>	command=<span class="enscript-string">&quot;$base_compile $qsrcfile&quot;</span>
      <span class="enscript-keyword">else</span>
	command=<span class="enscript-string">&quot;$base_compile $qsrcfile $pic_flag&quot;</span>
      <span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$compiler_c_o&quot;</span> = yes; <span class="enscript-keyword">then</span>
	command=<span class="enscript-string">&quot;$command -o $obj&quot;</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Suppress compiler output if we already did a PIC compilation.
</span>      command=<span class="enscript-string">&quot;$command$suppress_output&quot;</span>
      $run $rm <span class="enscript-string">&quot;$obj&quot;</span> <span class="enscript-string">&quot;$output_obj&quot;</span>
      $show <span class="enscript-string">&quot;$command&quot;</span>
      <span class="enscript-keyword">if</span> $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$command&quot;</span>; <span class="enscript-keyword">then</span> :
      <span class="enscript-keyword">else</span>
	$run $rm $removelist
	<span class="enscript-keyword">exit</span> $EXIT_FAILURE
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$need_locks&quot;</span> = warn &amp;&amp;
	 <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X`cat $lockfile 2&gt;/dev/null`&quot;</span> != <span class="enscript-string">&quot;X$srcfile&quot;</span>; <span class="enscript-keyword">then</span>
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;\
*** ERROR, $lockfile contains:
`cat $lockfile 2&gt;/dev/null`

but it should contain:
$srcfile

This indicates that another process is trying to use the same
temporary object file, and libtool could not work around it because
your compiler does not support \`-c' and \`-o' together.  If you
repeat this compilation, it may succeed, by chance, but you had better
avoid parallel builds (make -j) in this platform, or get a better
compiler.&quot;</span>

	$run $rm $removelist
	<span class="enscript-keyword">exit</span> $EXIT_FAILURE
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Just move the object if needed
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$output_obj&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$output_obj&quot;</span> != <span class="enscript-string">&quot;X$obj&quot;</span>; <span class="enscript-keyword">then</span>
	$show <span class="enscript-string">&quot;$mv $output_obj $obj&quot;</span>
	<span class="enscript-keyword">if</span> $run $mv $output_obj $obj; <span class="enscript-keyword">then</span> :
	<span class="enscript-keyword">else</span>
	  error=$?
	  $run $rm $removelist
	  <span class="enscript-keyword">exit</span> $error
	<span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Append the name of the non-PIC object the libtool object file.
</span>      <span class="enscript-comment"># Only append if the libtool object file exists.
</span>      <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span> &amp;&amp; cat &gt;&gt; ${libobj}T &lt;&lt;EOF
<span class="enscript-comment"># Name of the non-PIC object.
</span>non_pic_object='$objname'

EOF
    <span class="enscript-keyword">else</span>
      <span class="enscript-comment"># Append the name of the non-PIC object the libtool object file.
</span>      <span class="enscript-comment"># Only append if the libtool object file exists.
</span>      <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span> &amp;&amp; cat &gt;&gt; ${libobj}T &lt;&lt;EOF
<span class="enscript-comment"># Name of the non-PIC object.
</span>non_pic_object=none

EOF
    <span class="enscript-keyword">fi</span>

    $run $mv <span class="enscript-string">&quot;${libobj}T&quot;</span> <span class="enscript-string">&quot;${libobj}&quot;</span>

    <span class="enscript-comment"># Unlock the critical section if it was locked
</span>    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$need_locks&quot;</span> != no; <span class="enscript-keyword">then</span>
      $run $rm <span class="enscript-string">&quot;$lockfile&quot;</span>
    <span class="enscript-keyword">fi</span>

    <span class="enscript-keyword">exit</span> $EXIT_SUCCESS
    ;;

  <span class="enscript-comment"># libtool link mode
</span>  link | relink)
    modename=<span class="enscript-string">&quot;$modename: link&quot;</span>
    <span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
    *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*)
      <span class="enscript-comment"># It is impossible to link a dll without this setting, and
</span>      <span class="enscript-comment"># we shouldn't force the makefile maintainer to figure out
</span>      <span class="enscript-comment"># which system we are compiling for in order to pass an extra
</span>      <span class="enscript-comment"># flag for every libtool invocation.
</span>      <span class="enscript-comment"># allow_undefined=no
</span>
      <span class="enscript-comment"># FIXME: Unfortunately, there are problems with the above when trying
</span>      <span class="enscript-comment"># to make a dll which has undefined symbols, in which case not
</span>      <span class="enscript-comment"># even a static library is built.  For now, we need to specify
</span>      <span class="enscript-comment"># -no-undefined on the libtool link line when we can be certain
</span>      <span class="enscript-comment"># that all symbols are satisfied, otherwise we get a static library.
</span>      allow_undefined=yes
      ;;
    *)
      allow_undefined=yes
      ;;
    <span class="enscript-keyword">esac</span>
    libtool_args=<span class="enscript-string">&quot;$nonopt&quot;</span>
    base_compile=<span class="enscript-string">&quot;$nonopt $@&quot;</span>
    compile_command=<span class="enscript-string">&quot;$nonopt&quot;</span>
    finalize_command=<span class="enscript-string">&quot;$nonopt&quot;</span>

    compile_rpath=
    finalize_rpath=
    compile_shlibpath=
    finalize_shlibpath=
    convenience=
    old_convenience=
    deplibs=
    old_deplibs=
    compiler_flags=
    linker_flags=
    dllsearchpath=
    lib_search_path=`<span class="enscript-keyword">pwd</span>`
    inst_prefix_dir=

    avoid_version=no
    dlfiles=
    dlprefiles=
    dlself=no
    export_dynamic=no
    export_symbols=
    export_symbols_regex=
    generated=
    libobjs=
    ltlibs=
    module=no
    no_install=no
    objs=
    non_pic_objects=
    notinst_path= <span class="enscript-comment"># paths that contain not-installed libtool libraries
</span>    precious_files_regex=
    prefer_static_libs=no
    preload=no
    prev=
    prevarg=
    release=
    rpath=
    xrpath=
    perm_rpath=
    temp_rpath=
    thread_safe=no
    vinfo=
    vinfo_number=no

    func_infer_tag $base_compile

    <span class="enscript-comment"># We need to know -static, to get the right output filenames.
</span>    <span class="enscript-keyword">for</span> arg
    <span class="enscript-keyword">do</span>
      <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
      -all-static | -static)
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$arg&quot;</span> = <span class="enscript-string">&quot;X-all-static&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = yes &amp;&amp; <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$link_static_flag&quot;</span>; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: complete static linking is impossible in this configuration&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$link_static_flag&quot;</span>; <span class="enscript-keyword">then</span>
	    dlopen_self=$dlopen_self_static
	  <span class="enscript-keyword">fi</span>
	  prefer_static_libs=yes
	<span class="enscript-keyword">else</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$pic_flag&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$link_static_flag&quot;</span>; <span class="enscript-keyword">then</span>
	    dlopen_self=$dlopen_self_static
	  <span class="enscript-keyword">fi</span>
	  prefer_static_libs=built
	<span class="enscript-keyword">fi</span>
	build_libtool_libs=no
	build_old_libs=yes
	<span class="enscript-keyword">break</span>
	;;
      <span class="enscript-keyword">esac</span>
    <span class="enscript-keyword">done</span>

    <span class="enscript-comment"># See if our shared archives depend on static archives.
</span>    <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$old_archive_from_new_cmds&quot;</span> &amp;&amp; build_old_libs=yes

    <span class="enscript-comment"># Go through the arguments, transforming them on the way.
</span>    <span class="enscript-keyword">while</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$#&quot;</span> -gt 0; <span class="enscript-keyword">do</span>
      arg=<span class="enscript-string">&quot;$1&quot;</span>
      <span class="enscript-keyword">shift</span>
      <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
      *[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	qarg=\<span class="enscript-string">&quot;`$echo &quot;</span>X$arg<span class="enscript-string">&quot; | $Xsed -e &quot;</span>$sed_quote_subst<span class="enscript-string">&quot;`\&quot; ### testsuite: skip nested quoting test
	;;
      *) qarg=$arg ;;
      esac
      libtool_args=&quot;</span>$libtool_args $qarg<span class="enscript-string">&quot;

      # If the previous option needs an argument, assign it.
      if test -n &quot;</span>$prev<span class="enscript-string">&quot;; then
	case $prev in
	output)
	  compile_command=&quot;</span>$compile_command @OUTPUT@<span class="enscript-string">&quot;
	  finalize_command=&quot;</span>$finalize_command @OUTPUT@<span class="enscript-string">&quot;
	  ;;
	esac

	case $prev in
	dlfiles|dlprefiles)
	  if test &quot;</span>$preload<span class="enscript-string">&quot; = no; then
	    # Add the symbol object into the linking commands.
	    compile_command=&quot;</span>$compile_command @SYMFILE@<span class="enscript-string">&quot;
	    finalize_command=&quot;</span>$finalize_command @SYMFILE@<span class="enscript-string">&quot;
	    preload=yes
	  fi
	  case $arg in
	  *.la | *.lo) ;;  # We handle these cases below.
	  force)
	    if test &quot;</span>$dlself<span class="enscript-string">&quot; = no; then
	      dlself=needless
	      export_dynamic=yes
	    fi
	    prev=
	    continue
	    ;;
	  self)
	    if test &quot;</span>$prev<span class="enscript-string">&quot; = dlprefiles; then
	      dlself=yes
	    elif test &quot;</span>$prev<span class="enscript-string">&quot; = dlfiles &amp;&amp; test &quot;</span>$dlopen_self<span class="enscript-string">&quot; != yes; then
	      dlself=yes
	    else
	      dlself=needless
	      export_dynamic=yes
	    fi
	    prev=
	    continue
	    ;;
	  *)
	    if test &quot;</span>$prev<span class="enscript-string">&quot; = dlfiles; then
	      dlfiles=&quot;</span>$dlfiles $arg<span class="enscript-string">&quot;
	    else
	      dlprefiles=&quot;</span>$dlprefiles $arg<span class="enscript-string">&quot;
	    fi
	    prev=
	    continue
	    ;;
	  esac
	  ;;
	expsyms)
	  export_symbols=&quot;</span>$arg<span class="enscript-string">&quot;
	  if test ! -f &quot;</span>$arg<span class="enscript-string">&quot;; then
	    $echo &quot;</span>$modename: symbol file \`$arg' does not exist<span class="enscript-string">&quot;
	    exit $EXIT_FAILURE
	  fi
	  prev=
	  continue
	  ;;
	expsyms_regex)
	  export_symbols_regex=&quot;</span>$arg<span class="enscript-string">&quot;
	  prev=
	  continue
	  ;;
	inst_prefix)
	  inst_prefix_dir=&quot;</span>$arg<span class="enscript-string">&quot;
	  prev=
	  continue
	  ;;
	precious_regex)
	  precious_files_regex=&quot;</span>$arg<span class="enscript-string">&quot;
	  prev=
	  continue
	  ;;
	release)
	  release=&quot;</span>-$arg<span class="enscript-string">&quot;
	  prev=
	  continue
	  ;;
	objectlist)
	  if test -f &quot;</span>$arg<span class="enscript-string">&quot;; then
	    save_arg=$arg
	    moreargs=
	    for fil in `cat $save_arg`
	    do
#	      moreargs=&quot;</span>$moreargs $fil<span class="enscript-string">&quot;
	      arg=$fil
	      # A libtool-controlled object.

	      # Check to see that this really is a libtool object.
	      if (${SED} -e '2q' $arg | grep &quot;</span>^<span class="enscript-comment"># Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
</span>		pic_object=
		non_pic_object=

		<span class="enscript-comment"># Read the .lo file
</span>		<span class="enscript-comment"># If there is no directory component, then add one.
</span>		<span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
		*/* | *\\*) . $arg ;;
		*) . ./$arg ;;
		<span class="enscript-keyword">esac</span>

		<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$pic_object&quot;</span> || \
		   <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$non_pic_object&quot;</span> ||
		   <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pic_object&quot;</span> = none &amp;&amp; \
		   <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$non_pic_object&quot;</span> = none; <span class="enscript-keyword">then</span>
		  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: cannot find name of object for \`$arg'&quot;</span> 1&gt;&amp;2
		  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
		<span class="enscript-keyword">fi</span>

		<span class="enscript-comment"># Extract subdirectory from the argument.
</span>		xdir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
		<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$xdir&quot;</span> = <span class="enscript-string">&quot;X$arg&quot;</span>; <span class="enscript-keyword">then</span>
		  xdir=
		<span class="enscript-keyword">else</span>
		  xdir=<span class="enscript-string">&quot;$xdir/&quot;</span>
		<span class="enscript-keyword">fi</span>

		<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pic_object&quot;</span> != none; <span class="enscript-keyword">then</span>
		  <span class="enscript-comment"># Prepend the subdirectory the object is found in.
</span>		  pic_object=<span class="enscript-string">&quot;$xdir$pic_object&quot;</span>

		  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$prev&quot;</span> = dlfiles; <span class="enscript-keyword">then</span>
		    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = yes &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$dlopen_support&quot;</span> = yes; <span class="enscript-keyword">then</span>
		      dlfiles=<span class="enscript-string">&quot;$dlfiles $pic_object&quot;</span>
		      prev=
		      <span class="enscript-keyword">continue</span>
		    <span class="enscript-keyword">else</span>
		      <span class="enscript-comment"># If libtool objects are unsupported, then we need to preload.
</span>		      prev=dlprefiles
		    <span class="enscript-keyword">fi</span>
		  <span class="enscript-keyword">fi</span>

		  <span class="enscript-comment"># CHECK ME:  I think I busted this.  -Ossama
</span>		  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$prev&quot;</span> = dlprefiles; <span class="enscript-keyword">then</span>
		    <span class="enscript-comment"># Preload the old-style object.
</span>		    dlprefiles=<span class="enscript-string">&quot;$dlprefiles $pic_object&quot;</span>
		    prev=
		  <span class="enscript-keyword">fi</span>

		  <span class="enscript-comment"># A PIC object.
</span>		  libobjs=<span class="enscript-string">&quot;$libobjs $pic_object&quot;</span>
		  arg=<span class="enscript-string">&quot;$pic_object&quot;</span>
		<span class="enscript-keyword">fi</span>

		<span class="enscript-comment"># Non-PIC object.
</span>		<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$non_pic_object&quot;</span> != none; <span class="enscript-keyword">then</span>
		  <span class="enscript-comment"># Prepend the subdirectory the object is found in.
</span>		  non_pic_object=<span class="enscript-string">&quot;$xdir$non_pic_object&quot;</span>

		  <span class="enscript-comment"># A standard non-PIC object
</span>		  non_pic_objects=<span class="enscript-string">&quot;$non_pic_objects $non_pic_object&quot;</span>
		  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$pic_object&quot;</span> || <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pic_object&quot;</span> = none ; <span class="enscript-keyword">then</span>
		    arg=<span class="enscript-string">&quot;$non_pic_object&quot;</span>
		  <span class="enscript-keyword">fi</span>
		<span class="enscript-keyword">else</span>
		  <span class="enscript-comment"># If the PIC object exists, use it instead.
</span>		  <span class="enscript-comment"># $xdir was prepended to $pic_object above.
</span>		  non_pic_object=<span class="enscript-string">&quot;$pic_object&quot;</span>
		  non_pic_objects=<span class="enscript-string">&quot;$non_pic_objects $non_pic_object&quot;</span>
		<span class="enscript-keyword">fi</span>
	      <span class="enscript-keyword">else</span>
		<span class="enscript-comment"># Only an error if not doing a dry-run.
</span>		<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span>; <span class="enscript-keyword">then</span>
		  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$arg' is not a valid libtool object&quot;</span> 1&gt;&amp;2
		  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
		<span class="enscript-keyword">else</span>
		  <span class="enscript-comment"># Dry-run case.
</span>
		  <span class="enscript-comment"># Extract subdirectory from the argument.
</span>		  xdir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
		  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$xdir&quot;</span> = <span class="enscript-string">&quot;X$arg&quot;</span>; <span class="enscript-keyword">then</span>
		    xdir=
		  <span class="enscript-keyword">else</span>
		    xdir=<span class="enscript-string">&quot;$xdir/&quot;</span>
		  <span class="enscript-keyword">fi</span>

		  pic_object=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X${xdir}${objdir}/${arg}&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$lo2o&quot;</span>`
		  non_pic_object=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X${xdir}${arg}&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$lo2o&quot;</span>`
		  libobjs=<span class="enscript-string">&quot;$libobjs $pic_object&quot;</span>
		  non_pic_objects=<span class="enscript-string">&quot;$non_pic_objects $non_pic_object&quot;</span>
		<span class="enscript-keyword">fi</span>
	      <span class="enscript-keyword">fi</span>
	    <span class="enscript-keyword">done</span>
	  <span class="enscript-keyword">else</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: link input file \`$save_arg' does not exist&quot;</span>
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  <span class="enscript-keyword">fi</span>
	  arg=$save_arg
	  prev=
	  <span class="enscript-keyword">continue</span>
	  ;;
	rpath | xrpath)
	  <span class="enscript-comment"># We need an absolute path.
</span>	  <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
	  [\\/]* | [A-Za-z]:[\\/]*) ;;
	  *)
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: only absolute run-paths are allowed&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	    ;;
	  <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$prev&quot;</span> = rpath; <span class="enscript-keyword">then</span>
	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$rpath &quot;</span> <span class="enscript-keyword">in</span>
	    *<span class="enscript-string">&quot; $arg &quot;</span>*) ;;
	    *) rpath=<span class="enscript-string">&quot;$rpath $arg&quot;</span> ;;
	    <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">else</span>
	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$xrpath &quot;</span> <span class="enscript-keyword">in</span>
	    *<span class="enscript-string">&quot; $arg &quot;</span>*) ;;
	    *) xrpath=<span class="enscript-string">&quot;$xrpath $arg&quot;</span> ;;
	    <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">fi</span>
	  prev=
	  <span class="enscript-keyword">continue</span>
	  ;;
	xcompiler)
	  compiler_flags=<span class="enscript-string">&quot;$compiler_flags $qarg&quot;</span>
	  prev=
	  compile_command=<span class="enscript-string">&quot;$compile_command $qarg&quot;</span>
	  finalize_command=<span class="enscript-string">&quot;$finalize_command $qarg&quot;</span>
	  <span class="enscript-keyword">continue</span>
	  ;;
	xlinker)
	  linker_flags=<span class="enscript-string">&quot;$linker_flags $qarg&quot;</span>
	  compiler_flags=<span class="enscript-string">&quot;$compiler_flags $wl$qarg&quot;</span>
	  prev=
	  compile_command=<span class="enscript-string">&quot;$compile_command $wl$qarg&quot;</span>
	  finalize_command=<span class="enscript-string">&quot;$finalize_command $wl$qarg&quot;</span>
	  <span class="enscript-keyword">continue</span>
	  ;;
	xcclinker)
	  linker_flags=<span class="enscript-string">&quot;$linker_flags $qarg&quot;</span>
	  compiler_flags=<span class="enscript-string">&quot;$compiler_flags $qarg&quot;</span>
	  prev=
	  compile_command=<span class="enscript-string">&quot;$compile_command $qarg&quot;</span>
	  finalize_command=<span class="enscript-string">&quot;$finalize_command $qarg&quot;</span>
	  <span class="enscript-keyword">continue</span>
	  ;;
	shrext)
  	  shrext_cmds=<span class="enscript-string">&quot;$arg&quot;</span>
	  prev=
	  <span class="enscript-keyword">continue</span>
	  ;;
	darwin_framework|darwin_framework_skip)
	  <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$prev&quot;</span> = <span class="enscript-string">&quot;darwin_framework&quot;</span> &amp;&amp; compiler_flags=<span class="enscript-string">&quot;$compiler_flags $arg&quot;</span>
	  compile_command=<span class="enscript-string">&quot;$compile_command $arg&quot;</span>
	  finalize_command=<span class="enscript-string">&quot;$finalize_command $arg&quot;</span>
	  prev=
	  <span class="enscript-keyword">continue</span>
	  ;;
	*)
	  <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$prev=\&quot;\$arg\&quot;&quot;</span>
	  prev=
	  <span class="enscript-keyword">continue</span>
	  ;;
	<span class="enscript-keyword">esac</span>
      <span class="enscript-keyword">fi</span> <span class="enscript-comment"># test -n &quot;$prev&quot;
</span>
      prevarg=<span class="enscript-string">&quot;$arg&quot;</span>

      <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
      -all-static)
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$link_static_flag&quot;</span>; <span class="enscript-keyword">then</span>
	  compile_command=<span class="enscript-string">&quot;$compile_command $link_static_flag&quot;</span>
	  finalize_command=<span class="enscript-string">&quot;$finalize_command $link_static_flag&quot;</span>
	<span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">continue</span>
	;;

      -allow-undefined)
	<span class="enscript-comment"># FIXME: remove this flag sometime in the future.
</span>	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`-allow-undefined' is deprecated because it is the default&quot;</span> 1&gt;&amp;2
	<span class="enscript-keyword">continue</span>
	;;

      -avoid-version)
	avoid_version=yes
	<span class="enscript-keyword">continue</span>
	;;

      -dlopen)
	prev=dlfiles
	<span class="enscript-keyword">continue</span>
	;;

      -dlpreopen)
	prev=dlprefiles
	<span class="enscript-keyword">continue</span>
	;;

      -<span class="enscript-keyword">export</span>-dynamic)
	export_dynamic=yes
	<span class="enscript-keyword">continue</span>
	;;

      -<span class="enscript-keyword">export</span>-symbols | -<span class="enscript-keyword">export</span>-symbols-regex)
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$export_symbols&quot;</span> || <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$export_symbols_regex&quot;</span>; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: more than one -exported-symbols argument is not allowed&quot;</span>
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	<span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$arg&quot;</span> = <span class="enscript-string">&quot;X-export-symbols&quot;</span>; <span class="enscript-keyword">then</span>
	  prev=expsyms
	<span class="enscript-keyword">else</span>
	  prev=expsyms_regex
	<span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">continue</span>
	;;

      -framework|-arch|-isysroot)
	<span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $CC &quot;</span> <span class="enscript-keyword">in</span>
	  *<span class="enscript-string">&quot; ${arg} ${1} &quot;</span>* | *<span class="enscript-string">&quot; ${arg}	${1} &quot;</span>*) 
		prev=darwin_framework_skip ;;
	  *) compiler_flags=<span class="enscript-string">&quot;$compiler_flags $arg&quot;</span>
	     prev=darwin_framework ;;
	<span class="enscript-keyword">esac</span>
	compile_command=<span class="enscript-string">&quot;$compile_command $arg&quot;</span>
	finalize_command=<span class="enscript-string">&quot;$finalize_command $arg&quot;</span>
	<span class="enscript-keyword">continue</span>
	;;

      -inst-prefix-dir)
	prev=inst_prefix
	<span class="enscript-keyword">continue</span>
	;;

      <span class="enscript-comment"># The native IRIX linker understands -LANG:*, -LIST:* and -LNO:*
</span>      <span class="enscript-comment"># so, if we see these flags be careful not to treat them like -L
</span>      -L[A-Z][A-Z]*:*)
	<span class="enscript-keyword">case</span> $with_gcc/$host <span class="enscript-keyword">in</span>
	no/*-*-irix* | /*-*-irix*)
	  compile_command=<span class="enscript-string">&quot;$compile_command $arg&quot;</span>
	  finalize_command=<span class="enscript-string">&quot;$finalize_command $arg&quot;</span>
	  ;;
	<span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">continue</span>
	;;

      -L*)
	dir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e 's/^-L//'`
	<span class="enscript-comment"># We need an absolute path.
</span>	<span class="enscript-keyword">case</span> $dir <span class="enscript-keyword">in</span>
	[\\/]* | [A-Za-z]:[\\/]*) ;;
	*)
	  absdir=`<span class="enscript-keyword">cd</span> <span class="enscript-string">&quot;$dir&quot;</span> &amp;&amp; <span class="enscript-keyword">pwd</span>`
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$absdir&quot;</span>; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: cannot determine absolute directory name of \`$dir'&quot;</span> 1&gt;&amp;2
	    absdir=<span class="enscript-string">&quot;$dir&quot;</span>
	    notinst_path=<span class="enscript-string">&quot;$notinst_path $dir&quot;</span>
	  <span class="enscript-keyword">fi</span>
	  dir=<span class="enscript-string">&quot;$absdir&quot;</span>
	  ;;
	<span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$deplibs &quot;</span> <span class="enscript-keyword">in</span>
	*<span class="enscript-string">&quot; -L$dir &quot;</span>*) ;;
	*)
	  deplibs=<span class="enscript-string">&quot;$deplibs -L$dir&quot;</span>
	  lib_search_path=<span class="enscript-string">&quot;$lib_search_path $dir&quot;</span>
	  ;;
	<span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*)
	  testbindir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$dir&quot;</span> | $Xsed -e 's*/lib$*/bin*'`
	  <span class="enscript-keyword">case</span> :$dllsearchpath: <span class="enscript-keyword">in</span>
	  *<span class="enscript-string">&quot;:$dir:&quot;</span>*) ;;
	  *) dllsearchpath=<span class="enscript-string">&quot;$dllsearchpath:$dir&quot;</span>;;
	  <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">case</span> :$dllsearchpath: <span class="enscript-keyword">in</span>
	  *<span class="enscript-string">&quot;:$testbindir:&quot;</span>*) ;;
	  *) dllsearchpath=<span class="enscript-string">&quot;$dllsearchpath:$testbindir&quot;</span>;;
	  <span class="enscript-keyword">esac</span>
	  ;;
	<span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">continue</span>
	;;

      -l*)
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$arg&quot;</span> = <span class="enscript-string">&quot;X-lc&quot;</span> || <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$arg&quot;</span> = <span class="enscript-string">&quot;X-lm&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos*)
	    <span class="enscript-comment"># These systems don't actually have a C or math library (as such)
</span>	    <span class="enscript-keyword">continue</span>
	    ;;
	  *-*-os2*)
	    <span class="enscript-comment"># These systems don't actually have a C library (as such)
</span>	    <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$arg&quot;</span> = <span class="enscript-string">&quot;X-lc&quot;</span> &amp;&amp; <span class="enscript-keyword">continue</span>
	    ;;
	  *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
	    <span class="enscript-comment"># Do not include libc due to us having libc/libc_r.
</span>	    <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$arg&quot;</span> = <span class="enscript-string">&quot;X-lc&quot;</span> &amp;&amp; <span class="enscript-keyword">continue</span>
	    ;;
	  *-*-rhapsody* | *-*-darwin1.[012])
	    <span class="enscript-comment"># Rhapsody C and math libraries are in the System framework
</span>	    deplibs=<span class="enscript-string">&quot;$deplibs -framework System&quot;</span>
	    <span class="enscript-keyword">continue</span>
	    ;;
	  *-*-sco3.2v5* | *-*-sco5v6*)
	    <span class="enscript-comment"># Causes problems with __ctype
</span>	    <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$arg&quot;</span> = <span class="enscript-string">&quot;X-lc&quot;</span> &amp;&amp; <span class="enscript-keyword">continue</span>
	    ;;
	  *-*-sysv4.2uw2* | *-*-sysv5* | *-*-unixware* | *-*-OpenUNIX*)
	    <span class="enscript-comment"># Compiler inserts libc in the correct place for threads to work
</span>	    <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$arg&quot;</span> = <span class="enscript-string">&quot;X-lc&quot;</span> &amp;&amp; <span class="enscript-keyword">continue</span>
	    ;;
	  <span class="enscript-keyword">esac</span>
	elif <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$arg&quot;</span> = <span class="enscript-string">&quot;X-lc_r&quot;</span>; <span class="enscript-keyword">then</span>
	 <span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
	 *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
	   <span class="enscript-comment"># Do not include libc_r directly, use -pthread flag.
</span>	   <span class="enscript-keyword">continue</span>
	   ;;
	 <span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">fi</span>
	deplibs=<span class="enscript-string">&quot;$deplibs $arg&quot;</span>
	<span class="enscript-keyword">continue</span>
	;;

      <span class="enscript-comment"># Tru64 UNIX uses -model [arg] to determine the layout of C++
</span>      <span class="enscript-comment"># classes, name mangling, and exception handling.
</span>      -model)
	compile_command=<span class="enscript-string">&quot;$compile_command $arg&quot;</span>
	compiler_flags=<span class="enscript-string">&quot;$compiler_flags $arg&quot;</span>
	finalize_command=<span class="enscript-string">&quot;$finalize_command $arg&quot;</span>
	prev=xcompiler
	<span class="enscript-keyword">continue</span>
	;;

     -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe)
	compiler_flags=<span class="enscript-string">&quot;$compiler_flags $arg&quot;</span>
	compile_command=<span class="enscript-string">&quot;$compile_command $arg&quot;</span>
	finalize_command=<span class="enscript-string">&quot;$finalize_command $arg&quot;</span>
	<span class="enscript-keyword">continue</span>
	;;

      -module)
	module=yes
	<span class="enscript-keyword">continue</span>
	;;

      <span class="enscript-comment"># -64, -mips[0-9] enable 64-bit mode on the SGI compiler
</span>      <span class="enscript-comment"># -r[0-9][0-9]* specifies the processor on the SGI compiler
</span>      <span class="enscript-comment"># -xarch=*, -xtarget=* enable 64-bit mode on the Sun compiler
</span>      <span class="enscript-comment"># +DA*, +DD* enable 64-bit mode on the HP compiler
</span>      <span class="enscript-comment"># -q* pass through compiler args for the IBM compiler
</span>      <span class="enscript-comment"># -m* pass through architecture-specific compiler args for GCC
</span>      <span class="enscript-comment"># -m*, -t[45]*, -txscale* pass through architecture-specific
</span>      <span class="enscript-comment"># compiler args for GCC
</span>      <span class="enscript-comment"># -pg pass through profiling flag for GCC
</span>      <span class="enscript-comment"># @file GCC response files
</span>      -64|-mips[0-9]|-r[0-9][0-9]*|-xarch=*|-xtarget=*|+DA*|+DD*|-q*|-m*|-pg| \
      -t[45]*|-txscale*|@*)

	<span class="enscript-comment"># Unknown arguments in both finalize_command and compile_command need
</span>	<span class="enscript-comment"># to be aesthetically quoted because they are evaled later.
</span>	arg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
	<span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
	*[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	  arg=<span class="enscript-string">&quot;\&quot;$arg\&quot;&quot;</span>
	  ;;
	<span class="enscript-keyword">esac</span>
        compile_command=<span class="enscript-string">&quot;$compile_command $arg&quot;</span>
        finalize_command=<span class="enscript-string">&quot;$finalize_command $arg&quot;</span>
        compiler_flags=<span class="enscript-string">&quot;$compiler_flags $arg&quot;</span>
        <span class="enscript-keyword">continue</span>
        ;;

      -shrext)
	prev=shrext
	<span class="enscript-keyword">continue</span>
	;;

      -no-fast-install)
	fast_install=no
	<span class="enscript-keyword">continue</span>
	;;

      -no-install)
	<span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*)
	  <span class="enscript-comment"># The PATH hackery in wrapper scripts is required on Windows
</span>	  <span class="enscript-comment"># in order for the loader to find any dlls it needs.
</span>	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: \`-no-install' is ignored for $host&quot;</span> 1&gt;&amp;2
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: assuming \`-no-fast-install' instead&quot;</span> 1&gt;&amp;2
	  fast_install=no
	  ;;
	*) no_install=yes ;;
	<span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">continue</span>
	;;

      -no-undefined)
	allow_undefined=no
	<span class="enscript-keyword">continue</span>
	;;

      -objectlist)
	prev=objectlist
	<span class="enscript-keyword">continue</span>
	;;

      -o) prev=output ;;

      -precious-files-regex)
	prev=precious_regex
	<span class="enscript-keyword">continue</span>
	;;

      -release)
	prev=release
	<span class="enscript-keyword">continue</span>
	;;

      -rpath)
	prev=rpath
	<span class="enscript-keyword">continue</span>
	;;

      -R)
	prev=xrpath
	<span class="enscript-keyword">continue</span>
	;;

      -R*)
	dir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e 's/^-R//'`
	<span class="enscript-comment"># We need an absolute path.
</span>	<span class="enscript-keyword">case</span> $dir <span class="enscript-keyword">in</span>
	[\\/]* | [A-Za-z]:[\\/]*) ;;
	*)
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: only absolute run-paths are allowed&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  ;;
	<span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$xrpath &quot;</span> <span class="enscript-keyword">in</span>
	*<span class="enscript-string">&quot; $dir &quot;</span>*) ;;
	*) xrpath=<span class="enscript-string">&quot;$xrpath $dir&quot;</span> ;;
	<span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">continue</span>
	;;

      -static)
	<span class="enscript-comment"># The effects of -static are defined in a previous loop.
</span>	<span class="enscript-comment"># We used to do the same as -all-static on platforms that
</span>	<span class="enscript-comment"># didn't have a PIC flag, but the assumption that the effects
</span>	<span class="enscript-comment"># would be equivalent was wrong.  It would break on at least
</span>	<span class="enscript-comment"># Digital Unix and AIX.
</span>	<span class="enscript-keyword">continue</span>
	;;

      -thread-safe)
	thread_safe=yes
	<span class="enscript-keyword">continue</span>
	;;

      -version-info)
	prev=vinfo
	<span class="enscript-keyword">continue</span>
	;;
      -version-number)
	prev=vinfo
	vinfo_number=yes
	<span class="enscript-keyword">continue</span>
	;;

      -Wc,*)
	args=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span> -e 's/^-Wc,//'`
	arg=
	save_ifs=<span class="enscript-string">&quot;$IFS&quot;</span>; <span class="enscript-keyword">IFS</span>=','
	<span class="enscript-keyword">for</span> flag <span class="enscript-keyword">in</span> $args; <span class="enscript-keyword">do</span>
	  <span class="enscript-keyword">IFS</span>=<span class="enscript-string">&quot;$save_ifs&quot;</span>
	  <span class="enscript-keyword">case</span> $flag <span class="enscript-keyword">in</span>
	    *[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	    flag=<span class="enscript-string">&quot;\&quot;$flag\&quot;&quot;</span>
	    ;;
	  <span class="enscript-keyword">esac</span>
	  arg=<span class="enscript-string">&quot;$arg $wl$flag&quot;</span>
	  compiler_flags=<span class="enscript-string">&quot;$compiler_flags $flag&quot;</span>
	<span class="enscript-keyword">done</span>
	<span class="enscript-keyword">IFS</span>=<span class="enscript-string">&quot;$save_ifs&quot;</span>
	arg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s/^ //&quot;</span>`
	;;

      -Wl,*)
	args=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span> -e 's/^-Wl,//'`
	arg=
	save_ifs=<span class="enscript-string">&quot;$IFS&quot;</span>; <span class="enscript-keyword">IFS</span>=','
	<span class="enscript-keyword">for</span> flag <span class="enscript-keyword">in</span> $args; <span class="enscript-keyword">do</span>
	  <span class="enscript-keyword">IFS</span>=<span class="enscript-string">&quot;$save_ifs&quot;</span>
	  <span class="enscript-keyword">case</span> $flag <span class="enscript-keyword">in</span>
	    *[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	    flag=<span class="enscript-string">&quot;\&quot;$flag\&quot;&quot;</span>
	    ;;
	  <span class="enscript-keyword">esac</span>
	  arg=<span class="enscript-string">&quot;$arg $wl$flag&quot;</span>
	  compiler_flags=<span class="enscript-string">&quot;$compiler_flags $wl$flag&quot;</span>
	  linker_flags=<span class="enscript-string">&quot;$linker_flags $flag&quot;</span>
	<span class="enscript-keyword">done</span>
	<span class="enscript-keyword">IFS</span>=<span class="enscript-string">&quot;$save_ifs&quot;</span>
	arg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s/^ //&quot;</span>`
	;;

      -Xcompiler)
	prev=xcompiler
	<span class="enscript-keyword">continue</span>
	;;

      -Xlinker)
	prev=xlinker
	<span class="enscript-keyword">continue</span>
	;;

      -XCClinker)
	prev=xcclinker
	<span class="enscript-keyword">continue</span>
	;;

      <span class="enscript-comment"># Some other compiler flag.
</span>      -* | +*)
	<span class="enscript-comment"># Unknown arguments in both finalize_command and compile_command need
</span>	<span class="enscript-comment"># to be aesthetically quoted because they are evaled later.
</span>	arg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
	<span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
	*[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	  arg=<span class="enscript-string">&quot;\&quot;$arg\&quot;&quot;</span>
	  ;;
	<span class="enscript-keyword">esac</span>
	;;

      *.$objext)
	<span class="enscript-comment"># A standard object.
</span>	objs=<span class="enscript-string">&quot;$objs $arg&quot;</span>
	;;

      *.lo)
	<span class="enscript-comment"># A libtool-controlled object.
</span>
	<span class="enscript-comment"># Check to see that this really is a libtool object.
</span>	<span class="enscript-keyword">if</span> (${SED} -e '2q' $arg | grep <span class="enscript-string">&quot;^# Generated by .*$PACKAGE&quot;</span>) &gt;/dev/null 2&gt;&amp;1; <span class="enscript-keyword">then</span>
	  pic_object=
	  non_pic_object=

	  <span class="enscript-comment"># Read the .lo file
</span>	  <span class="enscript-comment"># If there is no directory component, then add one.
</span>	  <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
	  */* | *\\*) . $arg ;;
	  *) . ./$arg ;;
	  <span class="enscript-keyword">esac</span>

	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$pic_object&quot;</span> || \
	     <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$non_pic_object&quot;</span> ||
	     <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pic_object&quot;</span> = none &amp;&amp; \
	     <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$non_pic_object&quot;</span> = none; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: cannot find name of object for \`$arg'&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  <span class="enscript-keyword">fi</span>

	  <span class="enscript-comment"># Extract subdirectory from the argument.
</span>	  xdir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$xdir&quot;</span> = <span class="enscript-string">&quot;X$arg&quot;</span>; <span class="enscript-keyword">then</span>
	    xdir=
 	  <span class="enscript-keyword">else</span>
	    xdir=<span class="enscript-string">&quot;$xdir/&quot;</span>
	  <span class="enscript-keyword">fi</span>

	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pic_object&quot;</span> != none; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># Prepend the subdirectory the object is found in.
</span>	    pic_object=<span class="enscript-string">&quot;$xdir$pic_object&quot;</span>

	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$prev&quot;</span> = dlfiles; <span class="enscript-keyword">then</span>
	      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = yes &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$dlopen_support&quot;</span> = yes; <span class="enscript-keyword">then</span>
		dlfiles=<span class="enscript-string">&quot;$dlfiles $pic_object&quot;</span>
		prev=
		<span class="enscript-keyword">continue</span>
	      <span class="enscript-keyword">else</span>
		<span class="enscript-comment"># If libtool objects are unsupported, then we need to preload.
</span>		prev=dlprefiles
	      <span class="enscript-keyword">fi</span>
	    <span class="enscript-keyword">fi</span>

	    <span class="enscript-comment"># CHECK ME:  I think I busted this.  -Ossama
</span>	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$prev&quot;</span> = dlprefiles; <span class="enscript-keyword">then</span>
	      <span class="enscript-comment"># Preload the old-style object.
</span>	      dlprefiles=<span class="enscript-string">&quot;$dlprefiles $pic_object&quot;</span>
	      prev=
	    <span class="enscript-keyword">fi</span>

	    <span class="enscript-comment"># A PIC object.
</span>	    libobjs=<span class="enscript-string">&quot;$libobjs $pic_object&quot;</span>
	    arg=<span class="enscript-string">&quot;$pic_object&quot;</span>
	  <span class="enscript-keyword">fi</span>

	  <span class="enscript-comment"># Non-PIC object.
</span>	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$non_pic_object&quot;</span> != none; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># Prepend the subdirectory the object is found in.
</span>	    non_pic_object=<span class="enscript-string">&quot;$xdir$non_pic_object&quot;</span>

	    <span class="enscript-comment"># A standard non-PIC object
</span>	    non_pic_objects=<span class="enscript-string">&quot;$non_pic_objects $non_pic_object&quot;</span>
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$pic_object&quot;</span> || <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pic_object&quot;</span> = none ; <span class="enscript-keyword">then</span>
	      arg=<span class="enscript-string">&quot;$non_pic_object&quot;</span>
	    <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">else</span>
	    <span class="enscript-comment"># If the PIC object exists, use it instead.
</span>	    <span class="enscript-comment"># $xdir was prepended to $pic_object above.
</span>	    non_pic_object=<span class="enscript-string">&quot;$pic_object&quot;</span>
	    non_pic_objects=<span class="enscript-string">&quot;$non_pic_objects $non_pic_object&quot;</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">else</span>
	  <span class="enscript-comment"># Only an error if not doing a dry-run.
</span>	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span>; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$arg' is not a valid libtool object&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  <span class="enscript-keyword">else</span>
	    <span class="enscript-comment"># Dry-run case.
</span>
	    <span class="enscript-comment"># Extract subdirectory from the argument.
</span>	    xdir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$xdir&quot;</span> = <span class="enscript-string">&quot;X$arg&quot;</span>; <span class="enscript-keyword">then</span>
	      xdir=
	    <span class="enscript-keyword">else</span>
	      xdir=<span class="enscript-string">&quot;$xdir/&quot;</span>
	    <span class="enscript-keyword">fi</span>

	    pic_object=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X${xdir}${objdir}/${arg}&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$lo2o&quot;</span>`
	    non_pic_object=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X${xdir}${arg}&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$lo2o&quot;</span>`
	    libobjs=<span class="enscript-string">&quot;$libobjs $pic_object&quot;</span>
	    non_pic_objects=<span class="enscript-string">&quot;$non_pic_objects $non_pic_object&quot;</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">fi</span>
	;;

      *.$libext)
	<span class="enscript-comment"># An archive.
</span>	deplibs=<span class="enscript-string">&quot;$deplibs $arg&quot;</span>
	old_deplibs=<span class="enscript-string">&quot;$old_deplibs $arg&quot;</span>
	<span class="enscript-keyword">continue</span>
	;;

      *.la)
	<span class="enscript-comment"># A libtool-controlled library.
</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$prev&quot;</span> = dlfiles; <span class="enscript-keyword">then</span>
	  <span class="enscript-comment"># This library was specified with -dlopen.
</span>	  dlfiles=<span class="enscript-string">&quot;$dlfiles $arg&quot;</span>
	  prev=
	elif <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$prev&quot;</span> = dlprefiles; <span class="enscript-keyword">then</span>
	  <span class="enscript-comment"># The library was specified with -dlpreopen.
</span>	  dlprefiles=<span class="enscript-string">&quot;$dlprefiles $arg&quot;</span>
	  prev=
	<span class="enscript-keyword">else</span>
	  deplibs=<span class="enscript-string">&quot;$deplibs $arg&quot;</span>
	<span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">continue</span>
	;;

      <span class="enscript-comment"># Some other compiler argument.
</span>      *)
	<span class="enscript-comment"># Unknown arguments in both finalize_command and compile_command need
</span>	<span class="enscript-comment"># to be aesthetically quoted because they are evaled later.
</span>	arg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
	<span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
	*[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	  arg=<span class="enscript-string">&quot;\&quot;$arg\&quot;&quot;</span>
	  ;;
	<span class="enscript-keyword">esac</span>
	;;
      <span class="enscript-keyword">esac</span> <span class="enscript-comment"># arg
</span>
      <span class="enscript-comment"># Now actually substitute the argument into the commands.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$arg&quot;</span>; <span class="enscript-keyword">then</span>
	compile_command=<span class="enscript-string">&quot;$compile_command $arg&quot;</span>
	finalize_command=<span class="enscript-string">&quot;$finalize_command $arg&quot;</span>
      <span class="enscript-keyword">fi</span>
    <span class="enscript-keyword">done</span> <span class="enscript-comment"># argument parsing loop
</span>
    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$prev&quot;</span>; <span class="enscript-keyword">then</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: the \`$prevarg' option requires an argument&quot;</span> 1&gt;&amp;2
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
    <span class="enscript-keyword">fi</span>

    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$export_dynamic&quot;</span> = yes &amp;&amp; <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$export_dynamic_flag_spec&quot;</span>; <span class="enscript-keyword">then</span>
      <span class="enscript-keyword">eval</span> arg=\<span class="enscript-string">&quot;$export_dynamic_flag_spec\&quot;
      compile_command=&quot;</span>$compile_command $arg<span class="enscript-string">&quot;
      finalize_command=&quot;</span>$finalize_command $arg<span class="enscript-string">&quot;
    fi

    oldlibs=
    # calculate the name of the file, without its directory
    outputname=`$echo &quot;</span>X$output<span class="enscript-string">&quot; | $Xsed -e 's%^.*/%%'`
    libobjs_save=&quot;</span>$libobjs<span class="enscript-string">&quot;

    if test -n &quot;</span>$shlibpath_var<span class="enscript-string">&quot;; then
      # get the directories listed in $shlibpath_var
      eval shlib_search_path=\`\$echo \&quot;X\${$shlibpath_var}\&quot; \| \$Xsed -e \'s/:/ /g\'\`
    else
      shlib_search_path=
    fi
    eval sys_lib_search_path=\&quot;$sys_lib_search_path_spec\&quot;
    eval sys_lib_dlsearch_path=\&quot;$sys_lib_dlsearch_path_spec\&quot;

    output_objdir=`$echo &quot;</span>X$output<span class="enscript-string">&quot; | $Xsed -e 's%/[^/]*$%%'`
    if test &quot;</span>X$output_objdir<span class="enscript-string">&quot; = &quot;</span>X$output<span class="enscript-string">&quot;; then
      output_objdir=&quot;</span>$objdir<span class="enscript-string">&quot;
    else
      output_objdir=&quot;</span>$output_objdir/$objdir<span class="enscript-string">&quot;
    fi
    # Create the object directory.
    if test ! -d &quot;</span>$output_objdir<span class="enscript-string">&quot;; then
      $show &quot;</span>$mkdir $output_objdir<span class="enscript-string">&quot;
      $run $mkdir $output_objdir
      exit_status=$?
      if test &quot;</span>$exit_status<span class="enscript-string">&quot; -ne 0 &amp;&amp; test ! -d &quot;</span>$output_objdir<span class="enscript-string">&quot;; then
	exit $exit_status
      fi
      $show &quot;</span>chmod 777 $output_objdir<span class="enscript-string">&quot;
      $run chmod 777 $output_objdir
    fi

    # Determine the type of output
    case $output in
    &quot;</span><span class="enscript-string">&quot;)
      $echo &quot;</span>$modename: you must specify an output file<span class="enscript-string">&quot; 1&gt;&amp;2
      $echo &quot;</span>$help<span class="enscript-string">&quot; 1&gt;&amp;2
      exit $EXIT_FAILURE
      ;;
    *.$libext) linkmode=oldlib ;;
    *.lo | *.$objext) linkmode=obj ;;
    *.la) linkmode=lib ;;
    *) linkmode=prog ;; # Anything else should be a program.
    esac

    case $host in
    *cygwin* | *mingw* | *pw32*)
      # don't eliminate duplications in $postdeps and $predeps
      duplicate_compiler_generated_deps=yes
      ;;
    *)
      duplicate_compiler_generated_deps=$duplicate_deps
      ;;
    esac
    specialdeplibs=

    libs=
    # Find all interdependent deplibs by searching for libraries
    # that are linked more than once (e.g. -la -lb -la)
    for deplib in $deplibs; do
      if test &quot;</span>X$duplicate_deps<span class="enscript-string">&quot; = &quot;</span>Xyes<span class="enscript-string">&quot; ; then
	case &quot;</span>$libs <span class="enscript-string">&quot; in
	*&quot;</span> $deplib <span class="enscript-string">&quot;*) specialdeplibs=&quot;</span>$specialdeplibs $deplib<span class="enscript-string">&quot; ;;
	esac
      fi
      libs=&quot;</span>$libs $deplib<span class="enscript-string">&quot;
    done

    if test &quot;</span>$linkmode<span class="enscript-string">&quot; = lib; then
      libs=&quot;</span>$predeps $libs $compiler_lib_search_path $postdeps<span class="enscript-string">&quot;

      # Compute libraries that are listed more than once in $predeps
      # $postdeps and mark them as special (i.e., whose duplicates are
      # not to be eliminated).
      pre_post_deps=
      if test &quot;</span>X$duplicate_compiler_generated_deps<span class="enscript-string">&quot; = &quot;</span>Xyes<span class="enscript-string">&quot; ; then
	for pre_post_dep in $predeps $postdeps; do
	  case &quot;</span>$pre_post_deps <span class="enscript-string">&quot; in
	  *&quot;</span> $pre_post_dep <span class="enscript-string">&quot;*) specialdeplibs=&quot;</span>$specialdeplibs $pre_post_deps<span class="enscript-string">&quot; ;;
	  esac
	  pre_post_deps=&quot;</span>$pre_post_deps $pre_post_dep<span class="enscript-string">&quot;
	done
      fi
      pre_post_deps=
    fi

    deplibs=
    newdependency_libs=
    newlib_search_path=
    need_relink=no # whether we're linking any uninstalled libtool libraries
    notinst_deplibs= # not-installed libtool libraries
    case $linkmode in
    lib)
	passes=&quot;</span>conv link<span class="enscript-string">&quot;
	for file in $dlfiles $dlprefiles; do
	  case $file in
	  *.la) ;;
	  *)
	    $echo &quot;</span>$modename: libraries can \`-dlopen' only libtool libraries: $file<span class="enscript-string">&quot; 1&gt;&amp;2
	    exit $EXIT_FAILURE
	    ;;
	  esac
	done
	;;
    prog)
	compile_deplibs=
	finalize_deplibs=
	alldeplibs=no
	newdlfiles=
	newdlprefiles=
	passes=&quot;</span>conv scan dlopen dlpreopen link<span class="enscript-string">&quot;
	;;
    *)  passes=&quot;</span>conv<span class="enscript-string">&quot;
	;;
    esac
    for pass in $passes; do
      if test &quot;</span>$linkmode,$pass<span class="enscript-string">&quot; = &quot;</span>lib,link<span class="enscript-string">&quot; ||
	 test &quot;</span>$linkmode,$pass<span class="enscript-string">&quot; = &quot;</span>prog,scan<span class="enscript-string">&quot;; then
	libs=&quot;</span>$deplibs<span class="enscript-string">&quot;
	deplibs=
      fi
      if test &quot;</span>$linkmode<span class="enscript-string">&quot; = prog; then
	case $pass in
	dlopen) libs=&quot;</span>$dlfiles<span class="enscript-string">&quot; ;;
	dlpreopen) libs=&quot;</span>$dlprefiles<span class="enscript-string">&quot; ;;
	link) libs=&quot;</span>$deplibs %DEPLIBS% $dependency_libs<span class="enscript-string">&quot; ;;
	esac
      fi
      if test &quot;</span>$pass<span class="enscript-string">&quot; = dlopen; then
	# Collect dlpreopened libraries
	save_deplibs=&quot;</span>$deplibs<span class="enscript-string">&quot;
	deplibs=
      fi
      for deplib in $libs; do
	lib=
	found=no
	case $deplib in
	-mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe)
	  if test &quot;</span>$linkmode,$pass<span class="enscript-string">&quot; = &quot;</span>prog,link<span class="enscript-string">&quot;; then
	    compile_deplibs=&quot;</span>$deplib $compile_deplibs<span class="enscript-string">&quot;
	    finalize_deplibs=&quot;</span>$deplib $finalize_deplibs<span class="enscript-string">&quot;
	  else
	    compiler_flags=&quot;</span>$compiler_flags $deplib<span class="enscript-string">&quot;
	  fi
	  continue
	  ;;
	-l*)
	  if test &quot;</span>$linkmode<span class="enscript-string">&quot; != lib &amp;&amp; test &quot;</span>$linkmode<span class="enscript-string">&quot; != prog; then
	    $echo &quot;</span>$modename: warning: \`-l' is ignored <span class="enscript-keyword">for</span> archives/objects<span class="enscript-string">&quot; 1&gt;&amp;2
	    continue
	  fi
	  name=`$echo &quot;</span>X$deplib<span class="enscript-string">&quot; | $Xsed -e 's/^-l//'`
	  for searchdir in $newlib_search_path $lib_search_path $sys_lib_search_path $shlib_search_path; do
	    for search_ext in .la $std_shrext .so .a; do
	      # Search the libtool library
	      lib=&quot;</span>$searchdir/lib${name}${search_ext}<span class="enscript-string">&quot;
	      if test -f &quot;</span>$lib<span class="enscript-string">&quot;; then
		if test &quot;</span>$search_ext<span class="enscript-string">&quot; = &quot;</span>.la<span class="enscript-string">&quot;; then
		  found=yes
		else
		  found=no
		fi
		break 2
	      fi
	    done
	  done
	  if test &quot;</span>$found<span class="enscript-string">&quot; != yes; then
	    # deplib doesn't seem to be a libtool library
	    if test &quot;</span>$linkmode,$pass<span class="enscript-string">&quot; = &quot;</span>prog,link<span class="enscript-string">&quot;; then
	      compile_deplibs=&quot;</span>$deplib $compile_deplibs<span class="enscript-string">&quot;
	      finalize_deplibs=&quot;</span>$deplib $finalize_deplibs<span class="enscript-string">&quot;
	    else
	      deplibs=&quot;</span>$deplib $deplibs<span class="enscript-string">&quot;
	      test &quot;</span>$linkmode<span class="enscript-string">&quot; = lib &amp;&amp; newdependency_libs=&quot;</span>$deplib $newdependency_libs<span class="enscript-string">&quot;
	    fi
	    continue
	  else # deplib is a libtool library
	    # If $allow_libtool_libs_with_static_runtimes &amp;&amp; $deplib is a stdlib,
	    # We need to do some special things here, and not later.
	    if test &quot;</span>X$allow_libtool_libs_with_static_runtimes<span class="enscript-string">&quot; = &quot;</span>Xyes<span class="enscript-string">&quot; ; then
	      case &quot;</span> $predeps $postdeps <span class="enscript-string">&quot; in
	      *&quot;</span> $deplib <span class="enscript-string">&quot;*)
		if (${SED} -e '2q' $lib |
                    grep &quot;</span>^<span class="enscript-comment"># Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
</span>		  library_names=
		  old_library=
		  <span class="enscript-keyword">case</span> $lib <span class="enscript-keyword">in</span>
		  */* | *\\*) . $lib ;;
		  *) . ./$lib ;;
		  <span class="enscript-keyword">esac</span>
		  <span class="enscript-keyword">for</span> l <span class="enscript-keyword">in</span> $old_library $library_names; <span class="enscript-keyword">do</span>
		    ll=<span class="enscript-string">&quot;$l&quot;</span>
		  <span class="enscript-keyword">done</span>
		  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$ll&quot;</span> = <span class="enscript-string">&quot;X$old_library&quot;</span> ; <span class="enscript-keyword">then</span> <span class="enscript-comment"># only static version available
</span>		    found=no
		    ladir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$lib&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
		    <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$ladir&quot;</span> = <span class="enscript-string">&quot;X$lib&quot;</span> &amp;&amp; ladir=<span class="enscript-string">&quot;.&quot;</span>
		    lib=$ladir/$old_library
		    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode,$pass&quot;</span> = <span class="enscript-string">&quot;prog,link&quot;</span>; <span class="enscript-keyword">then</span>
		      compile_deplibs=<span class="enscript-string">&quot;$deplib $compile_deplibs&quot;</span>
		      finalize_deplibs=<span class="enscript-string">&quot;$deplib $finalize_deplibs&quot;</span>
		    <span class="enscript-keyword">else</span>
		      deplibs=<span class="enscript-string">&quot;$deplib $deplibs&quot;</span>
		      <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode&quot;</span> = lib &amp;&amp; newdependency_libs=<span class="enscript-string">&quot;$deplib $newdependency_libs&quot;</span>
		    <span class="enscript-keyword">fi</span>
		    <span class="enscript-keyword">continue</span>
		  <span class="enscript-keyword">fi</span>
		<span class="enscript-keyword">fi</span>
	        ;;
	      *) ;;
	      <span class="enscript-keyword">esac</span>
	    <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">fi</span>
	  ;; <span class="enscript-comment"># -l
</span>	-L*)
	  <span class="enscript-keyword">case</span> $linkmode <span class="enscript-keyword">in</span>
	  lib)
	    deplibs=<span class="enscript-string">&quot;$deplib $deplibs&quot;</span>
	    <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pass&quot;</span> = conv &amp;&amp; <span class="enscript-keyword">continue</span>
	    newdependency_libs=<span class="enscript-string">&quot;$deplib $newdependency_libs&quot;</span>
	    newlib_search_path=<span class="enscript-string">&quot;$newlib_search_path &quot;</span>`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$deplib&quot;</span> | $Xsed -e 's/^-L//'`
	    ;;
	  prog)
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pass&quot;</span> = conv; <span class="enscript-keyword">then</span>
	      deplibs=<span class="enscript-string">&quot;$deplib $deplibs&quot;</span>
	      <span class="enscript-keyword">continue</span>
	    <span class="enscript-keyword">fi</span>
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pass&quot;</span> = scan; <span class="enscript-keyword">then</span>
	      deplibs=<span class="enscript-string">&quot;$deplib $deplibs&quot;</span>
	    <span class="enscript-keyword">else</span>
	      compile_deplibs=<span class="enscript-string">&quot;$deplib $compile_deplibs&quot;</span>
	      finalize_deplibs=<span class="enscript-string">&quot;$deplib $finalize_deplibs&quot;</span>
	    <span class="enscript-keyword">fi</span>
	    newlib_search_path=<span class="enscript-string">&quot;$newlib_search_path &quot;</span>`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$deplib&quot;</span> | $Xsed -e 's/^-L//'`
	    ;;
	  *)
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: \`-L' is ignored for archives/objects&quot;</span> 1&gt;&amp;2
	    ;;
	  <span class="enscript-keyword">esac</span> <span class="enscript-comment"># linkmode
</span>	  <span class="enscript-keyword">continue</span>
	  ;; <span class="enscript-comment"># -L
</span>	-R*)
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pass&quot;</span> = link; <span class="enscript-keyword">then</span>
	    dir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$deplib&quot;</span> | $Xsed -e 's/^-R//'`
	    <span class="enscript-comment"># Make sure the xrpath contains only unique directories.
</span>	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$xrpath &quot;</span> <span class="enscript-keyword">in</span>
	    *<span class="enscript-string">&quot; $dir &quot;</span>*) ;;
	    *) xrpath=<span class="enscript-string">&quot;$xrpath $dir&quot;</span> ;;
	    <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">fi</span>
	  deplibs=<span class="enscript-string">&quot;$deplib $deplibs&quot;</span>
	  <span class="enscript-keyword">continue</span>
	  ;;
	*.la) lib=<span class="enscript-string">&quot;$deplib&quot;</span> ;;
	*.$libext)
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pass&quot;</span> = conv; <span class="enscript-keyword">then</span>
	    deplibs=<span class="enscript-string">&quot;$deplib $deplibs&quot;</span>
	    <span class="enscript-keyword">continue</span>
	  <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">case</span> $linkmode <span class="enscript-keyword">in</span>
	  lib)
	    valid_a_lib=no
	    <span class="enscript-keyword">case</span> $deplibs_check_method <span class="enscript-keyword">in</span>
	      match_pattern*)
		<span class="enscript-keyword">set</span> dummy $deplibs_check_method
	        match_pattern_regex=`expr <span class="enscript-string">&quot;$deplibs_check_method&quot;</span> : <span class="enscript-string">&quot;$2 \(.*\)&quot;</span>`
		<span class="enscript-keyword">if</span> <span class="enscript-keyword">eval</span> $<span class="enscript-keyword">echo</span> \<span class="enscript-string">&quot;$deplib\&quot; 2&gt;/dev/null \
		    | $SED 10q \
		    | $EGREP &quot;</span>$match_pattern_regex<span class="enscript-string">&quot; &gt; /dev/null; then
		  valid_a_lib=yes
		fi
		;;
	      pass_all)
		valid_a_lib=yes
		;;
            esac
	    if test &quot;</span>$valid_a_lib<span class="enscript-string">&quot; != yes; then
	      $echo
	      $echo &quot;</span>*** Warning: Trying to link with static lib archive $deplib.<span class="enscript-string">&quot;
	      $echo &quot;</span>*** I have the capability to make that library automatically link <span class="enscript-keyword">in</span> when<span class="enscript-string">&quot;
	      $echo &quot;</span>*** you link to this library.  But I can only <span class="enscript-keyword">do</span> this <span class="enscript-keyword">if</span> you have a<span class="enscript-string">&quot;
	      $echo &quot;</span>*** shared version of the library, which you <span class="enscript-keyword">do</span> not appear to have<span class="enscript-string">&quot;
	      $echo &quot;</span>*** because the file extensions .$libext of this argument makes me believe<span class="enscript-string">&quot;
	      $echo &quot;</span>*** that it is just a static archive that I should not used here.<span class="enscript-string">&quot;
	    else
	      $echo
	      $echo &quot;</span>*** Warning: Linking the shared library $output against the<span class="enscript-string">&quot;
	      $echo &quot;</span>*** static library $deplib is not portable!<span class="enscript-string">&quot;
	      deplibs=&quot;</span>$deplib $deplibs<span class="enscript-string">&quot;
	    fi
	    continue
	    ;;
	  prog)
	    if test &quot;</span>$pass<span class="enscript-string">&quot; != link; then
	      deplibs=&quot;</span>$deplib $deplibs<span class="enscript-string">&quot;
	    else
	      compile_deplibs=&quot;</span>$deplib $compile_deplibs<span class="enscript-string">&quot;
	      finalize_deplibs=&quot;</span>$deplib $finalize_deplibs<span class="enscript-string">&quot;
	    fi
	    continue
	    ;;
	  esac # linkmode
	  ;; # *.$libext
	*.lo | *.$objext)
	  if test &quot;</span>$pass<span class="enscript-string">&quot; = conv; then
	    deplibs=&quot;</span>$deplib $deplibs<span class="enscript-string">&quot;
	  elif test &quot;</span>$linkmode<span class="enscript-string">&quot; = prog; then
	    if test &quot;</span>$pass<span class="enscript-string">&quot; = dlpreopen || test &quot;</span>$dlopen_support<span class="enscript-string">&quot; != yes || test &quot;</span>$build_libtool_libs<span class="enscript-string">&quot; = no; then
	      # If there is no dlopen support or we're linking statically,
	      # we need to preload.
	      newdlprefiles=&quot;</span>$newdlprefiles $deplib<span class="enscript-string">&quot;
	      compile_deplibs=&quot;</span>$deplib $compile_deplibs<span class="enscript-string">&quot;
	      finalize_deplibs=&quot;</span>$deplib $finalize_deplibs<span class="enscript-string">&quot;
	    else
	      newdlfiles=&quot;</span>$newdlfiles $deplib<span class="enscript-string">&quot;
	    fi
	  fi
	  continue
	  ;;
	%DEPLIBS%)
	  alldeplibs=yes
	  continue
	  ;;
	esac # case $deplib
	if test &quot;</span>$found<span class="enscript-string">&quot; = yes || test -f &quot;</span>$lib<span class="enscript-string">&quot;; then :
	else
	  $echo &quot;</span>$modename: cannot find the library \`$lib' or unhandled argument \`$deplib'<span class="enscript-string">&quot; 1&gt;&amp;2
	  exit $EXIT_FAILURE
	fi

	# Check to see that this really is a libtool archive.
	if (${SED} -e '2q' $lib | grep &quot;</span>^<span class="enscript-comment"># Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
</span>	<span class="enscript-keyword">else</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$lib' is not a valid libtool archive&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	<span class="enscript-keyword">fi</span>

	ladir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$lib&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
	<span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$ladir&quot;</span> = <span class="enscript-string">&quot;X$lib&quot;</span> &amp;&amp; ladir=<span class="enscript-string">&quot;.&quot;</span>

	dlname=
	dlopen=
	dlpreopen=
	libdir=
	library_names=
	old_library=
	<span class="enscript-comment"># If the library was installed with an old release of libtool,
</span>	<span class="enscript-comment"># it will not redefine variables installed, or shouldnotlink
</span>	installed=yes
	shouldnotlink=no
	avoidtemprpath=


	<span class="enscript-comment"># Read the .la file
</span>	<span class="enscript-keyword">case</span> $lib <span class="enscript-keyword">in</span>
	*/* | *\\*) . $lib ;;
	*) . ./$lib ;;
	<span class="enscript-keyword">esac</span>

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode,$pass&quot;</span> = <span class="enscript-string">&quot;lib,link&quot;</span> ||
	   <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode,$pass&quot;</span> = <span class="enscript-string">&quot;prog,scan&quot;</span> ||
	   { <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode&quot;</span> != prog &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode&quot;</span> != lib; }; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$dlopen&quot;</span> &amp;&amp; dlfiles=<span class="enscript-string">&quot;$dlfiles $dlopen&quot;</span>
	  <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$dlpreopen&quot;</span> &amp;&amp; dlprefiles=<span class="enscript-string">&quot;$dlprefiles $dlpreopen&quot;</span>
	<span class="enscript-keyword">fi</span>

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pass&quot;</span> = conv; <span class="enscript-keyword">then</span>
	  <span class="enscript-comment"># Only check for convenience libraries
</span>	  deplibs=<span class="enscript-string">&quot;$lib $deplibs&quot;</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$libdir&quot;</span>; <span class="enscript-keyword">then</span>
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$old_library&quot;</span>; <span class="enscript-keyword">then</span>
	      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: cannot find name of link library for \`$lib'&quot;</span> 1&gt;&amp;2
	      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	    <span class="enscript-keyword">fi</span>
	    <span class="enscript-comment"># It is a libtool convenience library, so add in its objects.
</span>	    convenience=<span class="enscript-string">&quot;$convenience $ladir/$objdir/$old_library&quot;</span>
	    old_convenience=<span class="enscript-string">&quot;$old_convenience $ladir/$objdir/$old_library&quot;</span>
	    tmp_libs=
	    <span class="enscript-keyword">for</span> deplib <span class="enscript-keyword">in</span> $dependency_libs; <span class="enscript-keyword">do</span>
	      deplibs=<span class="enscript-string">&quot;$deplib $deplibs&quot;</span>
              <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$duplicate_deps&quot;</span> = <span class="enscript-string">&quot;Xyes&quot;</span> ; <span class="enscript-keyword">then</span>
	        <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$tmp_libs &quot;</span> <span class="enscript-keyword">in</span>
	        *<span class="enscript-string">&quot; $deplib &quot;</span>*) specialdeplibs=<span class="enscript-string">&quot;$specialdeplibs $deplib&quot;</span> ;;
	        <span class="enscript-keyword">esac</span>
              <span class="enscript-keyword">fi</span>
	      tmp_libs=<span class="enscript-string">&quot;$tmp_libs $deplib&quot;</span>
	    <span class="enscript-keyword">done</span>
	  elif <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode&quot;</span> != prog &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode&quot;</span> != lib; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$lib' is not a convenience library&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">continue</span>
	<span class="enscript-keyword">fi</span> <span class="enscript-comment"># $pass = conv
</span>

	<span class="enscript-comment"># Get the name of the library we link against.
</span>	linklib=
	<span class="enscript-keyword">for</span> l <span class="enscript-keyword">in</span> $old_library $library_names; <span class="enscript-keyword">do</span>
	  linklib=<span class="enscript-string">&quot;$l&quot;</span>
	<span class="enscript-keyword">done</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$linklib&quot;</span>; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: cannot find name of link library for \`$lib'&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	<span class="enscript-keyword">fi</span>

	<span class="enscript-comment"># This library was specified with -dlopen.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pass&quot;</span> = dlopen; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$libdir&quot;</span>; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: cannot -dlopen a convenience library: \`$lib'&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$dlname&quot;</span> ||
	     <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$dlopen_support&quot;</span> != yes ||
	     <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = no; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># If there is no dlname, no dlopen support or we're linking
</span>	    <span class="enscript-comment"># statically, we need to preload.  We also need to preload any
</span>	    <span class="enscript-comment"># dependent libraries so libltdl's deplib preloader doesn't
</span>	    <span class="enscript-comment"># bomb out in the load deplibs phase.
</span>	    dlprefiles=<span class="enscript-string">&quot;$dlprefiles $lib $dependency_libs&quot;</span>
	  <span class="enscript-keyword">else</span>
	    newdlfiles=<span class="enscript-string">&quot;$newdlfiles $lib&quot;</span>
	  <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">continue</span>
	<span class="enscript-keyword">fi</span> <span class="enscript-comment"># $pass = dlopen
</span>
	<span class="enscript-comment"># We need an absolute path.
</span>	<span class="enscript-keyword">case</span> $ladir <span class="enscript-keyword">in</span>
	[\\/]* | [A-Za-z]:[\\/]*) abs_ladir=<span class="enscript-string">&quot;$ladir&quot;</span> ;;
	*)
	  abs_ladir=`<span class="enscript-keyword">cd</span> <span class="enscript-string">&quot;$ladir&quot;</span> &amp;&amp; <span class="enscript-keyword">pwd</span>`
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$abs_ladir&quot;</span>; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: cannot determine absolute directory name of \`$ladir'&quot;</span> 1&gt;&amp;2
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: passing it literally to the linker, although it might fail&quot;</span> 1&gt;&amp;2
	    abs_ladir=<span class="enscript-string">&quot;$ladir&quot;</span>
	  <span class="enscript-keyword">fi</span>
	  ;;
	<span class="enscript-keyword">esac</span>
	laname=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$lib&quot;</span> | $Xsed -e 's%^.*/%%'`

	<span class="enscript-comment"># Find the relevant object directory and library name.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$installed&quot;</span> = Xyes; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> ! -f <span class="enscript-string">&quot;$libdir/$linklib&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> -f <span class="enscript-string">&quot;$abs_ladir/$linklib&quot;</span>; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: library \`$lib' was moved.&quot;</span> 1&gt;&amp;2
	    dir=<span class="enscript-string">&quot;$ladir&quot;</span>
	    absdir=<span class="enscript-string">&quot;$abs_ladir&quot;</span>
	    libdir=<span class="enscript-string">&quot;$abs_ladir&quot;</span>
	  <span class="enscript-keyword">else</span>
	    dir=<span class="enscript-string">&quot;$libdir&quot;</span>
	    absdir=<span class="enscript-string">&quot;$libdir&quot;</span>
	  <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$hardcode_automatic&quot;</span> = Xyes &amp;&amp; avoidtemprpath=yes
	<span class="enscript-keyword">else</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> ! -f <span class="enscript-string">&quot;$ladir/$objdir/$linklib&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> -f <span class="enscript-string">&quot;$abs_ladir/$linklib&quot;</span>; <span class="enscript-keyword">then</span>
	    dir=<span class="enscript-string">&quot;$ladir&quot;</span>
	    absdir=<span class="enscript-string">&quot;$abs_ladir&quot;</span>
	    <span class="enscript-comment"># Remove this search path later
</span>	    notinst_path=<span class="enscript-string">&quot;$notinst_path $abs_ladir&quot;</span>
	  <span class="enscript-keyword">else</span>
	    dir=<span class="enscript-string">&quot;$ladir/$objdir&quot;</span>
	    absdir=<span class="enscript-string">&quot;$abs_ladir/$objdir&quot;</span>
	    <span class="enscript-comment"># Remove this search path later
</span>	    notinst_path=<span class="enscript-string">&quot;$notinst_path $abs_ladir&quot;</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">fi</span> <span class="enscript-comment"># $installed = yes
</span>	name=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$laname&quot;</span> | $Xsed -e 's/\.la$//' -e 's/^lib//'`

	<span class="enscript-comment"># This library was specified with -dlpreopen.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pass&quot;</span> = dlpreopen; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$libdir&quot;</span>; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: cannot -dlpreopen a convenience library: \`$lib'&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  <span class="enscript-keyword">fi</span>
	  <span class="enscript-comment"># Prefer using a static library (so that no silly _DYNAMIC symbols
</span>	  <span class="enscript-comment"># are required to link).
</span>	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$old_library&quot;</span>; <span class="enscript-keyword">then</span>
	    newdlprefiles=<span class="enscript-string">&quot;$newdlprefiles $dir/$old_library&quot;</span>
	  <span class="enscript-comment"># Otherwise, use the dlname, so that lt_dlopen finds it.
</span>	  elif <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$dlname&quot;</span>; <span class="enscript-keyword">then</span>
	    newdlprefiles=<span class="enscript-string">&quot;$newdlprefiles $dir/$dlname&quot;</span>
	  <span class="enscript-keyword">else</span>
	    newdlprefiles=<span class="enscript-string">&quot;$newdlprefiles $dir/$linklib&quot;</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">fi</span> <span class="enscript-comment"># $pass = dlpreopen
</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$libdir&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-comment"># Link the convenience library
</span>	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode&quot;</span> = lib; <span class="enscript-keyword">then</span>
	    deplibs=<span class="enscript-string">&quot;$dir/$old_library $deplibs&quot;</span>
	  elif <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode,$pass&quot;</span> = <span class="enscript-string">&quot;prog,link&quot;</span>; <span class="enscript-keyword">then</span>
	    compile_deplibs=<span class="enscript-string">&quot;$dir/$old_library $compile_deplibs&quot;</span>
	    finalize_deplibs=<span class="enscript-string">&quot;$dir/$old_library $finalize_deplibs&quot;</span>
	  <span class="enscript-keyword">else</span>
	    deplibs=<span class="enscript-string">&quot;$lib $deplibs&quot;</span> <span class="enscript-comment"># used for prog,scan pass
</span>	  <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">continue</span>
	<span class="enscript-keyword">fi</span>


	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode&quot;</span> = prog &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pass&quot;</span> != link; <span class="enscript-keyword">then</span>
	  newlib_search_path=<span class="enscript-string">&quot;$newlib_search_path $ladir&quot;</span>
	  deplibs=<span class="enscript-string">&quot;$lib $deplibs&quot;</span>

	  linkalldeplibs=no
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$link_all_deplibs&quot;</span> != no || <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$library_names&quot;</span> ||
	     <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = no; <span class="enscript-keyword">then</span>
	    linkalldeplibs=yes
	  <span class="enscript-keyword">fi</span>

	  tmp_libs=
	  <span class="enscript-keyword">for</span> deplib <span class="enscript-keyword">in</span> $dependency_libs; <span class="enscript-keyword">do</span>
	    <span class="enscript-keyword">case</span> $deplib <span class="enscript-keyword">in</span>
	    -L*) newlib_search_path=<span class="enscript-string">&quot;$newlib_search_path &quot;</span>`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$deplib&quot;</span> | $Xsed -e 's/^-L//'`;; <span class="enscript-comment">### testsuite: skip nested quoting test
</span>	    <span class="enscript-keyword">esac</span>
	    <span class="enscript-comment"># Need to link against all dependency_libs?
</span>	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkalldeplibs&quot;</span> = yes; <span class="enscript-keyword">then</span>
	      deplibs=<span class="enscript-string">&quot;$deplib $deplibs&quot;</span>
	    <span class="enscript-keyword">else</span>
	      <span class="enscript-comment"># Need to hardcode shared library paths
</span>	      <span class="enscript-comment"># or/and link against static libraries
</span>	      newdependency_libs=<span class="enscript-string">&quot;$deplib $newdependency_libs&quot;</span>
	    <span class="enscript-keyword">fi</span>
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$duplicate_deps&quot;</span> = <span class="enscript-string">&quot;Xyes&quot;</span> ; <span class="enscript-keyword">then</span>
	      <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$tmp_libs &quot;</span> <span class="enscript-keyword">in</span>
	      *<span class="enscript-string">&quot; $deplib &quot;</span>*) specialdeplibs=<span class="enscript-string">&quot;$specialdeplibs $deplib&quot;</span> ;;
	      <span class="enscript-keyword">esac</span>
	    <span class="enscript-keyword">fi</span>
	    tmp_libs=<span class="enscript-string">&quot;$tmp_libs $deplib&quot;</span>
	  <span class="enscript-keyword">done</span> <span class="enscript-comment"># for deplib
</span>	  <span class="enscript-keyword">continue</span>
	<span class="enscript-keyword">fi</span> <span class="enscript-comment"># $linkmode = prog...
</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode,$pass&quot;</span> = <span class="enscript-string">&quot;prog,link&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$library_names&quot;</span> &amp;&amp;
	     { <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$prefer_static_libs&quot;</span> = no || <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$old_library&quot;</span>; }; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># We need to hardcode the library path
</span>	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$shlibpath_var&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$avoidtemprpath&quot;</span> ; <span class="enscript-keyword">then</span>
	      <span class="enscript-comment"># Make sure the rpath contains only unique directories.
</span>	      <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$temp_rpath &quot;</span> <span class="enscript-keyword">in</span>
	      *<span class="enscript-string">&quot; $dir &quot;</span>*) ;;
	      *<span class="enscript-string">&quot; $absdir &quot;</span>*) ;;
	      *) temp_rpath=<span class="enscript-string">&quot;$temp_rpath $absdir&quot;</span> ;;
	      <span class="enscript-keyword">esac</span>
	    <span class="enscript-keyword">fi</span>

	    <span class="enscript-comment"># Hardcode the library path.
</span>	    <span class="enscript-comment"># Skip directories that are in the system default run-time
</span>	    <span class="enscript-comment"># search path.
</span>	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $sys_lib_dlsearch_path &quot;</span> <span class="enscript-keyword">in</span>
	    *<span class="enscript-string">&quot; $absdir &quot;</span>*) ;;
	    *)
	      <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$compile_rpath &quot;</span> <span class="enscript-keyword">in</span>
	      *<span class="enscript-string">&quot; $absdir &quot;</span>*) ;;
	      *) compile_rpath=<span class="enscript-string">&quot;$compile_rpath $absdir&quot;</span>
	      <span class="enscript-keyword">esac</span>
	      ;;
	    <span class="enscript-keyword">esac</span>
	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $sys_lib_dlsearch_path &quot;</span> <span class="enscript-keyword">in</span>
	    *<span class="enscript-string">&quot; $libdir &quot;</span>*) ;;
	    *)
	      <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$finalize_rpath &quot;</span> <span class="enscript-keyword">in</span>
	      *<span class="enscript-string">&quot; $libdir &quot;</span>*) ;;
	      *) finalize_rpath=<span class="enscript-string">&quot;$finalize_rpath $libdir&quot;</span>
	      <span class="enscript-keyword">esac</span>
	      ;;
	    <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">fi</span> <span class="enscript-comment"># $linkmode,$pass = prog,link...
</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$alldeplibs&quot;</span> = yes &amp;&amp;
	     { <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$deplibs_check_method&quot;</span> = pass_all ||
	       { <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = yes &amp;&amp;
		 <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$library_names&quot;</span>; }; }; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># We only need to search for static libraries
</span>	    <span class="enscript-keyword">continue</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">fi</span>

	link_static=no <span class="enscript-comment"># Whether the deplib will be linked statically
</span>	use_static_libs=$prefer_static_libs
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$use_static_libs&quot;</span> = built &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$installed&quot;</span> = yes ; <span class="enscript-keyword">then</span>
	  use_static_libs=no
	<span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$library_names&quot;</span> &amp;&amp;
	   { <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$use_static_libs&quot;</span> = no || <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$old_library&quot;</span>; }; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$installed&quot;</span> = no; <span class="enscript-keyword">then</span>
	    notinst_deplibs=<span class="enscript-string">&quot;$notinst_deplibs $lib&quot;</span>
	    need_relink=yes
	  <span class="enscript-keyword">fi</span>
	  <span class="enscript-comment"># This is a shared library
</span>
	  <span class="enscript-comment"># Warn about portability, can't link against -module's on
</span>	  <span class="enscript-comment"># some systems (darwin)
</span>	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$shouldnotlink&quot;</span> = yes &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pass&quot;</span> = link ; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span>
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode&quot;</span> = prog; <span class="enscript-keyword">then</span>
	      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;*** Warning: Linking the executable $output against the loadable module&quot;</span>
	    <span class="enscript-keyword">else</span>
	      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;*** Warning: Linking the shared library $output against the loadable module&quot;</span>
	    <span class="enscript-keyword">fi</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;*** $linklib is not portable!&quot;</span>
	  <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkmode&quot;</span> = lib &amp;&amp;
	     <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$hardcode_into_libs&quot;</span> = yes; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># Hardcode the library path.
</span>	    <span class="enscript-comment"># Skip directories that are in the system default run-time
</span>	    <span class="enscript-comment"># search path.
</span>	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $sys_lib_dlsearch_path &quot;</span> <span class="enscript-keyword">in</span>
	    *<span class="enscript-string">&quot; $absdir &quot;</span>*) ;;
	    *)
	      <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$compile_rpath &quot;</span> <span class="enscript-keyword">in</span>
	      *<span class="enscript-string">&quot; $absdir &quot;</span>*) ;;
	      *) compile_rpath=<span class="enscript-string">&quot;$compile_rpath $absdir&quot;</span>
	      <span class="enscript-keyword">esac</span>
	      ;;
	    <span class="enscript-keyword">esac</span>
	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $sys_lib_dlsearch_path &quot;</span> <span class="enscript-keyword">in</span>
	    *<span class="enscript-string">&quot; $libdir &quot;</span>*) ;;
	    *)
	      <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$finalize_rpath &quot;</span> <span class="enscript-keyword">in</span>
	      *<span class="enscript-string">&quot; $libdir &quot;</span>*) ;;
	      *) finalize_rpath=<span class="enscript-string">&quot;$finalize_rpath $libdir&quot;</span>
	      <span class="enscript-keyword">esac</span>
	      ;;
	    <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">fi</span>

	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$old_archive_from_expsyms_cmds&quot;</span>; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># figure out the soname
</span>	    <span class="enscript-keyword">set</span> dummy $library_names
	    realname=<span class="enscript-string">&quot;$2&quot;</span>
	    <span class="enscript-keyword">shift</span>; <span class="enscript-keyword">shift</span>
	    libname=`<span class="enscript-keyword">eval</span> \\$<span class="enscript-keyword">echo</span> \<span class="enscript-string">&quot;$libname_spec\&quot;`
	    # use dlname if we got it. it's perfectly good, no?
	    if test -n &quot;</span>$dlname<span class="enscript-string">&quot;; then
	      soname=&quot;</span>$dlname<span class="enscript-string">&quot;
	    elif test -n &quot;</span>$soname_spec<span class="enscript-string">&quot;; then
	      # bleh windows
	      case $host in
	      *cygwin* | mingw*)
		major=`expr $current - $age`
		versuffix=&quot;</span>-$major<span class="enscript-string">&quot;
		;;
	      esac
	      eval soname=\&quot;$soname_spec\&quot;
	    else
	      soname=&quot;</span>$realname<span class="enscript-string">&quot;
	    fi

	    # Make a new name for the extract_expsyms_cmds to use
	    soroot=&quot;</span>$soname<span class="enscript-string">&quot;
	    soname=`$echo $soroot | ${SED} -e 's/^.*\///'`
	    newlib=&quot;</span>libimp-`$<span class="enscript-keyword">echo</span> $soname | ${SED} 's/^lib//;s/\.dll$//'`.a<span class="enscript-string">&quot;

	    # If the library has no export list, then create one now
	    if test -f &quot;</span>$output_objdir/$soname-def<span class="enscript-string">&quot;; then :
	    else
	      $show &quot;</span>extracting exported symbol list from \`$soname'<span class="enscript-string">&quot;
	      save_ifs=&quot;</span>$<span class="enscript-keyword">IFS</span><span class="enscript-string">&quot;; IFS='~'
	      cmds=$extract_expsyms_cmds
	      for cmd in $cmds; do
		IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
		eval cmd=\&quot;$cmd\&quot;
		$show &quot;</span>$cmd<span class="enscript-string">&quot;
		$run eval &quot;</span>$cmd<span class="enscript-string">&quot; || exit $?
	      done
	      IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	    fi

	    # Create $newlib
	    if test -f &quot;</span>$output_objdir/$newlib<span class="enscript-string">&quot;; then :; else
	      $show &quot;</span>generating import library <span class="enscript-keyword">for</span> \`$soname'<span class="enscript-string">&quot;
	      save_ifs=&quot;</span>$<span class="enscript-keyword">IFS</span><span class="enscript-string">&quot;; IFS='~'
	      cmds=$old_archive_from_expsyms_cmds
	      for cmd in $cmds; do
		IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
		eval cmd=\&quot;$cmd\&quot;
		$show &quot;</span>$cmd<span class="enscript-string">&quot;
		$run eval &quot;</span>$cmd<span class="enscript-string">&quot; || exit $?
	      done
	      IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	    fi
	    # make sure the library variables are pointing to the new library
	    dir=$output_objdir
	    linklib=$newlib
	  fi # test -n &quot;</span>$old_archive_from_expsyms_cmds<span class="enscript-string">&quot;

	  if test &quot;</span>$linkmode<span class="enscript-string">&quot; = prog || test &quot;</span>$mode<span class="enscript-string">&quot; != relink; then
	    add_shlibpath=
	    add_dir=
	    add=
	    lib_linked=yes
	    case $hardcode_action in
	    immediate | unsupported)
	      if test &quot;</span>$hardcode_direct<span class="enscript-string">&quot; = no; then
		add=&quot;</span>$dir/$linklib<span class="enscript-string">&quot;
		case $host in
		  *-*-sco3.2v5.0.[024]*) add_dir=&quot;</span>-L$dir<span class="enscript-string">&quot; ;;
		  *-*-sysv4*uw2*) add_dir=&quot;</span>-L$dir<span class="enscript-string">&quot; ;;
		  *-*-sysv5OpenUNIX* | *-*-sysv5UnixWare7.[01].[10]* | \
		    *-*-unixware7*) add_dir=&quot;</span>-L$dir<span class="enscript-string">&quot; ;;
		  *-*-darwin* )
		    # if the lib is a module then we can not link against
		    # it, someone is ignoring the new warnings I added
		    if /usr/bin/file -L $add 2&gt; /dev/null |
                      $EGREP &quot;</span>: [^:]* bundle<span class="enscript-string">&quot; &gt;/dev/null ; then
		      $echo &quot;</span>** Warning, lib $linklib is a module, not a shared library<span class="enscript-string">&quot;
		      if test -z &quot;</span>$old_library<span class="enscript-string">&quot; ; then
		        $echo
		        $echo &quot;</span>** And there doesn't seem to be a static archive available<span class="enscript-string">&quot;
		        $echo &quot;</span>** The link will probably fail, sorry<span class="enscript-string">&quot;
		      else
		        add=&quot;</span>$dir/$old_library<span class="enscript-string">&quot;
		      fi
		    fi
		esac
	      elif test &quot;</span>$hardcode_minus_L<span class="enscript-string">&quot; = no; then
		case $host in
		*-*-sunos*) add_shlibpath=&quot;</span>$dir<span class="enscript-string">&quot; ;;
		esac
		add_dir=&quot;</span>-L$dir<span class="enscript-string">&quot;
		add=&quot;</span>-l$name<span class="enscript-string">&quot;
	      elif test &quot;</span>$hardcode_shlibpath_var<span class="enscript-string">&quot; = no; then
		add_shlibpath=&quot;</span>$dir<span class="enscript-string">&quot;
		add=&quot;</span>-l$name<span class="enscript-string">&quot;
	      else
		lib_linked=no
	      fi
	      ;;
	    relink)
	      if test &quot;</span>$hardcode_direct<span class="enscript-string">&quot; = yes; then
		add=&quot;</span>$dir/$linklib<span class="enscript-string">&quot;
	      elif test &quot;</span>$hardcode_minus_L<span class="enscript-string">&quot; = yes; then
		add_dir=&quot;</span>-L$dir<span class="enscript-string">&quot;
		# Try looking first in the location we're being installed to.
		if test -n &quot;</span>$inst_prefix_dir<span class="enscript-string">&quot;; then
		  case $libdir in
		    [\\/]*)
		      add_dir=&quot;</span>$add_dir -L$inst_prefix_dir$libdir<span class="enscript-string">&quot;
		      ;;
		  esac
		fi
		add=&quot;</span>-l$name<span class="enscript-string">&quot;
	      elif test &quot;</span>$hardcode_shlibpath_var<span class="enscript-string">&quot; = yes; then
		add_shlibpath=&quot;</span>$dir<span class="enscript-string">&quot;
		add=&quot;</span>-l$name<span class="enscript-string">&quot;
	      else
		lib_linked=no
	      fi
	      ;;
	    *) lib_linked=no ;;
	    esac

	    if test &quot;</span>$lib_linked<span class="enscript-string">&quot; != yes; then
	      $echo &quot;</span>$modename: configuration error: unsupported hardcode properties<span class="enscript-string">&quot;
	      exit $EXIT_FAILURE
	    fi

	    if test -n &quot;</span>$add_shlibpath<span class="enscript-string">&quot;; then
	      case :$compile_shlibpath: in
	      *&quot;</span>:$add_shlibpath:<span class="enscript-string">&quot;*) ;;
	      *) compile_shlibpath=&quot;</span>$compile_shlibpath$add_shlibpath:<span class="enscript-string">&quot; ;;
	      esac
	    fi
	    if test &quot;</span>$linkmode<span class="enscript-string">&quot; = prog; then
	      test -n &quot;</span>$add_dir<span class="enscript-string">&quot; &amp;&amp; compile_deplibs=&quot;</span>$add_dir $compile_deplibs<span class="enscript-string">&quot;
	      test -n &quot;</span>$add<span class="enscript-string">&quot; &amp;&amp; compile_deplibs=&quot;</span>$add $compile_deplibs<span class="enscript-string">&quot;
	    else
	      test -n &quot;</span>$add_dir<span class="enscript-string">&quot; &amp;&amp; deplibs=&quot;</span>$add_dir $deplibs<span class="enscript-string">&quot;
	      test -n &quot;</span>$add<span class="enscript-string">&quot; &amp;&amp; deplibs=&quot;</span>$add $deplibs<span class="enscript-string">&quot;
	      if test &quot;</span>$hardcode_direct<span class="enscript-string">&quot; != yes &amp;&amp; \
		 test &quot;</span>$hardcode_minus_L<span class="enscript-string">&quot; != yes &amp;&amp; \
		 test &quot;</span>$hardcode_shlibpath_var<span class="enscript-string">&quot; = yes; then
		case :$finalize_shlibpath: in
		*&quot;</span>:$libdir:<span class="enscript-string">&quot;*) ;;
		*) finalize_shlibpath=&quot;</span>$finalize_shlibpath$libdir:<span class="enscript-string">&quot; ;;
		esac
	      fi
	    fi
	  fi

	  if test &quot;</span>$linkmode<span class="enscript-string">&quot; = prog || test &quot;</span>$mode<span class="enscript-string">&quot; = relink; then
	    add_shlibpath=
	    add_dir=
	    add=
	    # Finalize command for both is simple: just hardcode it.
	    if test &quot;</span>$hardcode_direct<span class="enscript-string">&quot; = yes; then
	      add=&quot;</span>$libdir/$linklib<span class="enscript-string">&quot;
	    elif test &quot;</span>$hardcode_minus_L<span class="enscript-string">&quot; = yes; then
	      add_dir=&quot;</span>-L$libdir<span class="enscript-string">&quot;
	      add=&quot;</span>-l$name<span class="enscript-string">&quot;
	    elif test &quot;</span>$hardcode_shlibpath_var<span class="enscript-string">&quot; = yes; then
	      case :$finalize_shlibpath: in
	      *&quot;</span>:$libdir:<span class="enscript-string">&quot;*) ;;
	      *) finalize_shlibpath=&quot;</span>$finalize_shlibpath$libdir:<span class="enscript-string">&quot; ;;
	      esac
	      add=&quot;</span>-l$name<span class="enscript-string">&quot;
	    elif test &quot;</span>$hardcode_automatic<span class="enscript-string">&quot; = yes; then
	      if test -n &quot;</span>$inst_prefix_dir<span class="enscript-string">&quot; &amp;&amp;
		 test -f &quot;</span>$inst_prefix_dir$libdir/$linklib<span class="enscript-string">&quot; ; then
	        add=&quot;</span>$inst_prefix_dir$libdir/$linklib<span class="enscript-string">&quot;
	      else
	        add=&quot;</span>$libdir/$linklib<span class="enscript-string">&quot;
	      fi
	    else
	      # We cannot seem to hardcode it, guess we'll fake it.
	      add_dir=&quot;</span>-L$libdir<span class="enscript-string">&quot;
	      # Try looking first in the location we're being installed to.
	      if test -n &quot;</span>$inst_prefix_dir<span class="enscript-string">&quot;; then
		case $libdir in
		  [\\/]*)
		    add_dir=&quot;</span>$add_dir -L$inst_prefix_dir$libdir<span class="enscript-string">&quot;
		    ;;
		esac
	      fi
	      add=&quot;</span>-l$name<span class="enscript-string">&quot;
	    fi

	    if test &quot;</span>$linkmode<span class="enscript-string">&quot; = prog; then
	      test -n &quot;</span>$add_dir<span class="enscript-string">&quot; &amp;&amp; finalize_deplibs=&quot;</span>$add_dir $finalize_deplibs<span class="enscript-string">&quot;
	      test -n &quot;</span>$add<span class="enscript-string">&quot; &amp;&amp; finalize_deplibs=&quot;</span>$add $finalize_deplibs<span class="enscript-string">&quot;
	    else
	      test -n &quot;</span>$add_dir<span class="enscript-string">&quot; &amp;&amp; deplibs=&quot;</span>$add_dir $deplibs<span class="enscript-string">&quot;
	      test -n &quot;</span>$add<span class="enscript-string">&quot; &amp;&amp; deplibs=&quot;</span>$add $deplibs<span class="enscript-string">&quot;
	    fi
	  fi
	elif test &quot;</span>$linkmode<span class="enscript-string">&quot; = prog; then
	  # Here we assume that one of hardcode_direct or hardcode_minus_L
	  # is not unsupported.  This is valid on all known static and
	  # shared platforms.
	  if test &quot;</span>$hardcode_direct<span class="enscript-string">&quot; != unsupported; then
	    test -n &quot;</span>$old_library<span class="enscript-string">&quot; &amp;&amp; linklib=&quot;</span>$old_library<span class="enscript-string">&quot;
	    compile_deplibs=&quot;</span>$dir/$linklib $compile_deplibs<span class="enscript-string">&quot;
	    finalize_deplibs=&quot;</span>$dir/$linklib $finalize_deplibs<span class="enscript-string">&quot;
	  else
	    compile_deplibs=&quot;</span>-l$name -L$dir $compile_deplibs<span class="enscript-string">&quot;
	    finalize_deplibs=&quot;</span>-l$name -L$dir $finalize_deplibs<span class="enscript-string">&quot;
	  fi
	elif test &quot;</span>$build_libtool_libs<span class="enscript-string">&quot; = yes; then
	  # Not a shared library
	  if test &quot;</span>$deplibs_check_method<span class="enscript-string">&quot; != pass_all; then
	    # We're trying link a shared library against a static one
	    # but the system doesn't support it.

	    # Just print a warning and add the library to dependency_libs so
	    # that the program can be linked against the static library.
	    $echo
	    $echo &quot;</span>*** Warning: This system can not link to static lib archive $lib.<span class="enscript-string">&quot;
	    $echo &quot;</span>*** I have the capability to make that library automatically link <span class="enscript-keyword">in</span> when<span class="enscript-string">&quot;
	    $echo &quot;</span>*** you link to this library.  But I can only <span class="enscript-keyword">do</span> this <span class="enscript-keyword">if</span> you have a<span class="enscript-string">&quot;
	    $echo &quot;</span>*** shared version of the library, which you <span class="enscript-keyword">do</span> not appear to have.<span class="enscript-string">&quot;
	    if test &quot;</span>$module<span class="enscript-string">&quot; = yes; then
	      $echo &quot;</span>*** But as you try to build a module library, libtool will still create <span class="enscript-string">&quot;
	      $echo &quot;</span>*** a static module, that should work as long as the dlopening application<span class="enscript-string">&quot;
	      $echo &quot;</span>*** is linked with the -dlopen flag to resolve symbols at runtime.<span class="enscript-string">&quot;
	      if test -z &quot;</span>$global_symbol_pipe<span class="enscript-string">&quot;; then
		$echo
		$echo &quot;</span>*** However, this would only work <span class="enscript-keyword">if</span> libtool was able to extract symbol<span class="enscript-string">&quot;
		$echo &quot;</span>*** lists from a program, using \`nm' or equivalent, but libtool could<span class="enscript-string">&quot;
		$echo &quot;</span>*** not find such a program.  So, this module is probably useless.<span class="enscript-string">&quot;
		$echo &quot;</span>*** \`nm' from GNU binutils and a full rebuild may help.<span class="enscript-string">&quot;
	      fi
	      if test &quot;</span>$build_old_libs<span class="enscript-string">&quot; = no; then
		build_libtool_libs=module
		build_old_libs=yes
	      else
		build_libtool_libs=no
	      fi
	    fi
	  else
	    deplibs=&quot;</span>$dir/$old_library $deplibs<span class="enscript-string">&quot;
	    link_static=yes
	  fi
	fi # link shared/static library?

	if test &quot;</span>$linkmode<span class="enscript-string">&quot; = lib; then
	  if test -n &quot;</span>$dependency_libs<span class="enscript-string">&quot; &amp;&amp;
	     { test &quot;</span>$hardcode_into_libs<span class="enscript-string">&quot; != yes ||
	       test &quot;</span>$build_old_libs<span class="enscript-string">&quot; = yes ||
	       test &quot;</span>$link_static<span class="enscript-string">&quot; = yes; }; then
	    # Extract -R from dependency_libs
	    temp_deplibs=
	    for libdir in $dependency_libs; do
	      case $libdir in
	      -R*) temp_xrpath=`$echo &quot;</span>X$libdir<span class="enscript-string">&quot; | $Xsed -e 's/^-R//'`
		   case &quot;</span> $xrpath <span class="enscript-string">&quot; in
		   *&quot;</span> $temp_xrpath <span class="enscript-string">&quot;*) ;;
		   *) xrpath=&quot;</span>$xrpath $temp_xrpath<span class="enscript-string">&quot;;;
		   esac;;
	      *) temp_deplibs=&quot;</span>$temp_deplibs $libdir<span class="enscript-string">&quot;;;
	      esac
	    done
	    dependency_libs=&quot;</span>$temp_deplibs<span class="enscript-string">&quot;
	  fi

	  newlib_search_path=&quot;</span>$newlib_search_path $absdir<span class="enscript-string">&quot;
	  # Link against this library
	  test &quot;</span>$link_static<span class="enscript-string">&quot; = no &amp;&amp; newdependency_libs=&quot;</span>$abs_ladir/$laname $newdependency_libs<span class="enscript-string">&quot;
	  # ... and its dependency_libs
	  tmp_libs=
	  for deplib in $dependency_libs; do
	    newdependency_libs=&quot;</span>$deplib $newdependency_libs<span class="enscript-string">&quot;
	    if test &quot;</span>X$duplicate_deps<span class="enscript-string">&quot; = &quot;</span>Xyes<span class="enscript-string">&quot; ; then
	      case &quot;</span>$tmp_libs <span class="enscript-string">&quot; in
	      *&quot;</span> $deplib <span class="enscript-string">&quot;*) specialdeplibs=&quot;</span>$specialdeplibs $deplib<span class="enscript-string">&quot; ;;
	      esac
	    fi
	    tmp_libs=&quot;</span>$tmp_libs $deplib<span class="enscript-string">&quot;
	  done

	  if test &quot;</span>$link_all_deplibs<span class="enscript-string">&quot; != no; then
	    # Add the search paths of all dependency libraries
	    for deplib in $dependency_libs; do
	      case $deplib in
	      -L*) path=&quot;</span>$deplib<span class="enscript-string">&quot; ;;
	      *.la)
		dir=`$echo &quot;</span>X$deplib<span class="enscript-string">&quot; | $Xsed -e 's%/[^/]*$%%'`
		test &quot;</span>X$dir<span class="enscript-string">&quot; = &quot;</span>X$deplib<span class="enscript-string">&quot; &amp;&amp; dir=&quot;</span>.<span class="enscript-string">&quot;
		# We need an absolute path.
		case $dir in
		[\\/]* | [A-Za-z]:[\\/]*) absdir=&quot;</span>$dir<span class="enscript-string">&quot; ;;
		*)
		  absdir=`cd &quot;</span>$dir<span class="enscript-string">&quot; &amp;&amp; pwd`
		  if test -z &quot;</span>$absdir<span class="enscript-string">&quot;; then
		    $echo &quot;</span>$modename: warning: cannot determine absolute directory name of \`$dir'<span class="enscript-string">&quot; 1&gt;&amp;2
		    absdir=&quot;</span>$dir<span class="enscript-string">&quot;
		  fi
		  ;;
		esac
		if grep &quot;</span>^installed=no<span class="enscript-string">&quot; $deplib &gt; /dev/null; then
		  path=&quot;</span>$absdir/$objdir<span class="enscript-string">&quot;
		else
		  eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
		  if test -z &quot;</span>$libdir<span class="enscript-string">&quot;; then
		    $echo &quot;</span>$modename: \`$deplib' is not a valid libtool archive<span class="enscript-string">&quot; 1&gt;&amp;2
		    exit $EXIT_FAILURE
		  fi
		  if test &quot;</span>$absdir<span class="enscript-string">&quot; != &quot;</span>$libdir<span class="enscript-string">&quot;; then
		    $echo &quot;</span>$modename: warning: \`$deplib' seems to be moved<span class="enscript-string">&quot; 1&gt;&amp;2
		  fi
		  path=&quot;</span>$absdir<span class="enscript-string">&quot;
		fi
		depdepl=
		case $host in
		*-*-darwin*)
		  # we do not want to link against static libs,
		  # but need to link against shared
		  eval deplibrary_names=`${SED} -n -e 's/^library_names=\(.*\)$/\1/p' $deplib`
		  if test -n &quot;</span>$deplibrary_names<span class="enscript-string">&quot; ; then
		    for tmp in $deplibrary_names ; do
		      depdepl=$tmp
		    done
		    if test -f &quot;</span>$path/$depdepl<span class="enscript-string">&quot; ; then
		      depdepl=&quot;</span>$path/$depdepl<span class="enscript-string">&quot;
		    fi
		    # do not add paths which are already there
		    case &quot;</span> $newlib_search_path <span class="enscript-string">&quot; in
		    *&quot;</span> $path <span class="enscript-string">&quot;*) ;;
		    *) newlib_search_path=&quot;</span>$newlib_search_path $path<span class="enscript-string">&quot;;;
		    esac
		  fi
		  path=&quot;</span><span class="enscript-string">&quot;
		  ;;
		*)
		  path=&quot;</span>-L$path<span class="enscript-string">&quot;
		  ;;
		esac
		;;
	      -l*)
		case $host in
		*-*-darwin*)
		  # Again, we only want to link against shared libraries
		  eval tmp_libs=`$echo &quot;</span>X$deplib<span class="enscript-string">&quot; | $Xsed -e &quot;</span>s,^\-l,,<span class="enscript-string">&quot;`
		  for tmp in $newlib_search_path ; do
		    if test -f &quot;</span>$tmp/lib$tmp_libs.dylib<span class="enscript-string">&quot; ; then
		      eval depdepl=&quot;</span>$tmp/lib$tmp_libs.dylib<span class="enscript-string">&quot;
		      break
		    fi
		  done
		  path=&quot;</span><span class="enscript-string">&quot;
		  ;;
		*) continue ;;
		esac
		;;
	      *) continue ;;
	      esac
	      case &quot;</span> $deplibs <span class="enscript-string">&quot; in
	      *&quot;</span> $path <span class="enscript-string">&quot;*) ;;
	      *) deplibs=&quot;</span>$path $deplibs<span class="enscript-string">&quot; ;;
	      esac
	      case &quot;</span> $deplibs <span class="enscript-string">&quot; in
	      *&quot;</span> $depdepl <span class="enscript-string">&quot;*) ;;
	      *) deplibs=&quot;</span>$depdepl $deplibs<span class="enscript-string">&quot; ;;
	      esac
	    done
	  fi # link_all_deplibs != no
	fi # linkmode = lib
      done # for deplib in $libs
      dependency_libs=&quot;</span>$newdependency_libs<span class="enscript-string">&quot;
      if test &quot;</span>$pass<span class="enscript-string">&quot; = dlpreopen; then
	# Link the dlpreopened libraries before other libraries
	for deplib in $save_deplibs; do
	  deplibs=&quot;</span>$deplib $deplibs<span class="enscript-string">&quot;
	done
      fi
      if test &quot;</span>$pass<span class="enscript-string">&quot; != dlopen; then
	if test &quot;</span>$pass<span class="enscript-string">&quot; != conv; then
	  # Make sure lib_search_path contains only unique directories.
	  lib_search_path=
	  for dir in $newlib_search_path; do
	    case &quot;</span>$lib_search_path <span class="enscript-string">&quot; in
	    *&quot;</span> $dir <span class="enscript-string">&quot;*) ;;
	    *) lib_search_path=&quot;</span>$lib_search_path $dir<span class="enscript-string">&quot; ;;
	    esac
	  done
	  newlib_search_path=
	fi

	if test &quot;</span>$linkmode,$pass<span class="enscript-string">&quot; != &quot;</span>prog,link<span class="enscript-string">&quot;; then
	  vars=&quot;</span>deplibs<span class="enscript-string">&quot;
	else
	  vars=&quot;</span>compile_deplibs finalize_deplibs<span class="enscript-string">&quot;
	fi
	for var in $vars dependency_libs; do
	  # Add libraries to $var in reverse order
	  eval tmp_libs=\&quot;\$$var\&quot;
	  new_libs=
	  for deplib in $tmp_libs; do
	    # FIXME: Pedantically, this is the right thing to do, so
	    #        that some nasty dependency loop isn't accidentally
	    #        broken:
	    #new_libs=&quot;</span>$deplib $new_libs<span class="enscript-string">&quot;
	    # Pragmatically, this seems to cause very few problems in
	    # practice:
	    case $deplib in
	    -L*) new_libs=&quot;</span>$deplib $new_libs<span class="enscript-string">&quot; ;;
	    -R*) ;;
	    *)
	      # And here is the reason: when a library appears more
	      # than once as an explicit dependence of a library, or
	      # is implicitly linked in more than once by the
	      # compiler, it is considered special, and multiple
	      # occurrences thereof are not removed.  Compare this
	      # with having the same library being listed as a
	      # dependency of multiple other libraries: in this case,
	      # we know (pedantically, we assume) the library does not
	      # need to be listed more than once, so we keep only the
	      # last copy.  This is not always right, but it is rare
	      # enough that we require users that really mean to play
	      # such unportable linking tricks to link the library
	      # using -Wl,-lname, so that libtool does not consider it
	      # for duplicate removal.
	      case &quot;</span> $specialdeplibs <span class="enscript-string">&quot; in
	      *&quot;</span> $deplib <span class="enscript-string">&quot;*) new_libs=&quot;</span>$deplib $new_libs<span class="enscript-string">&quot; ;;
	      *)
		case &quot;</span> $new_libs <span class="enscript-string">&quot; in
		*&quot;</span> $deplib <span class="enscript-string">&quot;*) ;;
		*) new_libs=&quot;</span>$deplib $new_libs<span class="enscript-string">&quot; ;;
		esac
		;;
	      esac
	      ;;
	    esac
	  done
	  tmp_libs=
	  for deplib in $new_libs; do
	    case $deplib in
	    -L*)
	      case &quot;</span> $tmp_libs <span class="enscript-string">&quot; in
	      *&quot;</span> $deplib <span class="enscript-string">&quot;*) ;;
	      *) tmp_libs=&quot;</span>$tmp_libs $deplib<span class="enscript-string">&quot; ;;
	      esac
	      ;;
	    *) tmp_libs=&quot;</span>$tmp_libs $deplib<span class="enscript-string">&quot; ;;
	    esac
	  done
	  eval $var=\&quot;$tmp_libs\&quot;
	done # for var
      fi
      # Last step: remove runtime libs from dependency_libs
      # (they stay in deplibs)
      tmp_libs=
      for i in $dependency_libs ; do
	case &quot;</span> $predeps $postdeps $compiler_lib_search_path <span class="enscript-string">&quot; in
	*&quot;</span> $i <span class="enscript-string">&quot;*)
	  i=&quot;</span><span class="enscript-string">&quot;
	  ;;
	esac
	if test -n &quot;</span>$i<span class="enscript-string">&quot; ; then
	  tmp_libs=&quot;</span>$tmp_libs $i<span class="enscript-string">&quot;
	fi
      done
      dependency_libs=$tmp_libs
    done # for pass
    if test &quot;</span>$linkmode<span class="enscript-string">&quot; = prog; then
      dlfiles=&quot;</span>$newdlfiles<span class="enscript-string">&quot;
      dlprefiles=&quot;</span>$newdlprefiles<span class="enscript-string">&quot;
    fi

    case $linkmode in
    oldlib)
      if test -n &quot;</span>$deplibs<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-l' and \`-L' are ignored <span class="enscript-keyword">for</span> archives<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$dlfiles$dlprefiles<span class="enscript-string">&quot; || test &quot;</span>$dlself<span class="enscript-string">&quot; != no; then
	$echo &quot;</span>$modename: warning: \`-dlopen' is ignored <span class="enscript-keyword">for</span> archives<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$rpath<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-rpath' is ignored <span class="enscript-keyword">for</span> archives<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$xrpath<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-R' is ignored <span class="enscript-keyword">for</span> archives<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$vinfo<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-version-info/-version-number' is ignored <span class="enscript-keyword">for</span> archives<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$release<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-release' is ignored <span class="enscript-keyword">for</span> archives<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$export_symbols<span class="enscript-string">&quot; || test -n &quot;</span>$export_symbols_regex<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-<span class="enscript-keyword">export</span>-symbols' is ignored <span class="enscript-keyword">for</span> archives<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      # Now set the variables for building old libraries.
      build_libtool_libs=no
      oldlibs=&quot;</span>$output<span class="enscript-string">&quot;
      objs=&quot;</span>$objs$old_deplibs<span class="enscript-string">&quot;
      ;;

    lib)
      # Make sure we only generate libraries of the form `libNAME.la'.
      case $outputname in
      lib*)
	name=`$echo &quot;</span>X$outputname<span class="enscript-string">&quot; | $Xsed -e 's/\.la$//' -e 's/^lib//'`
	eval shared_ext=\&quot;$shrext_cmds\&quot;
	eval libname=\&quot;$libname_spec\&quot;
	;;
      *)
	if test &quot;</span>$module<span class="enscript-string">&quot; = no; then
	  $echo &quot;</span>$modename: libtool library \`$output' must begin with \`lib'<span class="enscript-string">&quot; 1&gt;&amp;2
	  $echo &quot;</span>$help<span class="enscript-string">&quot; 1&gt;&amp;2
	  exit $EXIT_FAILURE
	fi
	if test &quot;</span>$need_lib_prefix<span class="enscript-string">&quot; != no; then
	  # Add the &quot;</span>lib<span class="enscript-string">&quot; prefix for modules if required
	  name=`$echo &quot;</span>X$outputname<span class="enscript-string">&quot; | $Xsed -e 's/\.la$//'`
	  eval shared_ext=\&quot;$shrext_cmds\&quot;
	  eval libname=\&quot;$libname_spec\&quot;
	else
	  libname=`$echo &quot;</span>X$outputname<span class="enscript-string">&quot; | $Xsed -e 's/\.la$//'`
	fi
	;;
      esac

      if test -n &quot;</span>$objs<span class="enscript-string">&quot;; then
	if test &quot;</span>$deplibs_check_method<span class="enscript-string">&quot; != pass_all; then
	  $echo &quot;</span>$modename: cannot build libtool library \`$output' from non-libtool objects on this host:$objs<span class="enscript-string">&quot; 2&gt;&amp;1
	  exit $EXIT_FAILURE
	else
	  $echo
	  $echo &quot;</span>*** Warning: Linking the shared library $output against the non-libtool<span class="enscript-string">&quot;
	  $echo &quot;</span>*** objects $objs is not portable!<span class="enscript-string">&quot;
	  libobjs=&quot;</span>$libobjs $objs<span class="enscript-string">&quot;
	fi
      fi

      if test &quot;</span>$dlself<span class="enscript-string">&quot; != no; then
	$echo &quot;</span>$modename: warning: \`-dlopen self' is ignored <span class="enscript-keyword">for</span> libtool libraries<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      set dummy $rpath
      if test &quot;</span>$<span class="enscript-comment">#&quot; -gt 2; then
</span>	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: ignoring multiple \`-rpath's for a libtool library&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">fi</span>
      install_libdir=<span class="enscript-string">&quot;$2&quot;</span>

      oldlibs=
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$rpath&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = yes; <span class="enscript-keyword">then</span>
	  <span class="enscript-comment"># Building a libtool convenience library.
</span>	  <span class="enscript-comment"># Some compilers have problems with a `.al' extension so
</span>	  <span class="enscript-comment"># convenience libraries should have the same extension an
</span>	  <span class="enscript-comment"># archive normally would.
</span>	  oldlibs=<span class="enscript-string">&quot;$output_objdir/$libname.$libext $oldlibs&quot;</span>
	  build_libtool_libs=convenience
	  build_old_libs=yes
	<span class="enscript-keyword">fi</span>

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$vinfo&quot;</span>; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: \`-version-info/-version-number' is ignored for convenience libraries&quot;</span> 1&gt;&amp;2
	<span class="enscript-keyword">fi</span>

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$release&quot;</span>; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: \`-release' is ignored for convenience libraries&quot;</span> 1&gt;&amp;2
	<span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">else</span>

	<span class="enscript-comment"># Parse the version information argument.
</span>	save_ifs=<span class="enscript-string">&quot;$IFS&quot;</span>; <span class="enscript-keyword">IFS</span>=':'
	<span class="enscript-keyword">set</span> dummy $vinfo 0 0 0
	<span class="enscript-keyword">IFS</span>=<span class="enscript-string">&quot;$save_ifs&quot;</span>

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$8&quot;</span>; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: too many parameters to \`-version-info'&quot;</span> 1&gt;&amp;2
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	<span class="enscript-keyword">fi</span>

	<span class="enscript-comment"># convert absolute version numbers to libtool ages
</span>	<span class="enscript-comment"># this retains compatibility with .la files and attempts
</span>	<span class="enscript-comment"># to make the code below a bit more comprehensible
</span>
	<span class="enscript-keyword">case</span> $vinfo_number <span class="enscript-keyword">in</span>
	yes)
	  number_major=<span class="enscript-string">&quot;$2&quot;</span>
	  number_minor=<span class="enscript-string">&quot;$3&quot;</span>
	  number_revision=<span class="enscript-string">&quot;$4&quot;</span>
	  <span class="enscript-comment">#
</span>	  <span class="enscript-comment"># There are really only two kinds -- those that
</span>	  <span class="enscript-comment"># use the current revision as the major version
</span>	  <span class="enscript-comment"># and those that subtract age and use age as
</span>	  <span class="enscript-comment"># a minor version.  But, then there is irix
</span>	  <span class="enscript-comment"># which has an extra 1 added just for fun
</span>	  <span class="enscript-comment">#
</span>	  <span class="enscript-keyword">case</span> $version_type <span class="enscript-keyword">in</span>
	  darwin|linux|osf|windows)
	    current=`expr $number_major + $number_minor`
	    age=<span class="enscript-string">&quot;$number_minor&quot;</span>
	    revision=<span class="enscript-string">&quot;$number_revision&quot;</span>
	    ;;
	  freebsd-aout|freebsd-elf|sunos)
	    current=<span class="enscript-string">&quot;$number_major&quot;</span>
	    revision=<span class="enscript-string">&quot;$number_minor&quot;</span>
	    age=<span class="enscript-string">&quot;0&quot;</span>
	    ;;
	  irix|nonstopux)
	    current=`expr $number_major + $number_minor - 1`
	    age=<span class="enscript-string">&quot;$number_minor&quot;</span>
	    revision=<span class="enscript-string">&quot;$number_minor&quot;</span>
	    ;;
	  <span class="enscript-keyword">esac</span>
	  ;;
	no)
	  current=<span class="enscript-string">&quot;$2&quot;</span>
	  revision=<span class="enscript-string">&quot;$3&quot;</span>
	  age=<span class="enscript-string">&quot;$4&quot;</span>
	  ;;
	<span class="enscript-keyword">esac</span>

	<span class="enscript-comment"># Check that each of the things are valid numbers.
</span>	<span class="enscript-keyword">case</span> $current <span class="enscript-keyword">in</span>
	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
	*)
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: CURRENT \`$current' must be a nonnegative integer&quot;</span> 1&gt;&amp;2
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$vinfo' is not valid version information&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  ;;
	<span class="enscript-keyword">esac</span>

	<span class="enscript-keyword">case</span> $revision <span class="enscript-keyword">in</span>
	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
	*)
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: REVISION \`$revision' must be a nonnegative integer&quot;</span> 1&gt;&amp;2
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$vinfo' is not valid version information&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  ;;
	<span class="enscript-keyword">esac</span>

	<span class="enscript-keyword">case</span> $age <span class="enscript-keyword">in</span>
	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
	*)
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: AGE \`$age' must be a nonnegative integer&quot;</span> 1&gt;&amp;2
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$vinfo' is not valid version information&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  ;;
	<span class="enscript-keyword">esac</span>

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$age&quot;</span> -gt <span class="enscript-string">&quot;$current&quot;</span>; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: AGE \`$age' is greater than the current interface number \`$current'&quot;</span> 1&gt;&amp;2
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$vinfo' is not valid version information&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	<span class="enscript-keyword">fi</span>

	<span class="enscript-comment"># Calculate the version variables.
</span>	major=
	versuffix=
	verstring=
	<span class="enscript-keyword">case</span> $version_type <span class="enscript-keyword">in</span>
	none) ;;

	darwin)
	  <span class="enscript-comment"># Like Linux, but with the current version available in
</span>	  <span class="enscript-comment"># verstring for coding it into the library header
</span>	  major=.`expr $current - $age`
	  versuffix=<span class="enscript-string">&quot;$major.$age.$revision&quot;</span>
	  <span class="enscript-comment"># Darwin ld doesn't like 0 for these options...
</span>	  minor_current=`expr $current + 1`
	  verstring=<span class="enscript-string">&quot;${wl}-compatibility_version ${wl}$minor_current ${wl}-current_version ${wl}$minor_current.$revision&quot;</span>
	  ;;

	freebsd-aout)
	  major=<span class="enscript-string">&quot;.$current&quot;</span>
	  versuffix=<span class="enscript-string">&quot;.$current.$revision&quot;</span>;
	  ;;

	freebsd-elf)
	  major=<span class="enscript-string">&quot;.$current&quot;</span>
	  versuffix=<span class="enscript-string">&quot;.$current&quot;</span>;
	  ;;

	irix | nonstopux)
	  major=`expr $current - $age + 1`

	  <span class="enscript-keyword">case</span> $version_type <span class="enscript-keyword">in</span>
	    nonstopux) verstring_prefix=nonstopux ;;
	    *)         verstring_prefix=sgi ;;
	  <span class="enscript-keyword">esac</span>
	  verstring=<span class="enscript-string">&quot;$verstring_prefix$major.$revision&quot;</span>

	  <span class="enscript-comment"># Add in all the interfaces that we are compatible with.
</span>	  loop=$revision
	  <span class="enscript-keyword">while</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$loop&quot;</span> -ne 0; <span class="enscript-keyword">do</span>
	    iface=`expr $revision - $loop`
	    loop=`expr $loop - 1`
	    verstring=<span class="enscript-string">&quot;$verstring_prefix$major.$iface:$verstring&quot;</span>
	  <span class="enscript-keyword">done</span>

	  <span class="enscript-comment"># Before this point, $major must not contain `.'.
</span>	  major=.$major
	  versuffix=<span class="enscript-string">&quot;$major.$revision&quot;</span>
	  ;;

	linux)
	  major=.`expr $current - $age`
	  versuffix=<span class="enscript-string">&quot;$major.$age.$revision&quot;</span>
	  ;;

	osf)
	  major=.`expr $current - $age`
	  versuffix=<span class="enscript-string">&quot;.$current.$age.$revision&quot;</span>
	  verstring=<span class="enscript-string">&quot;$current.$age.$revision&quot;</span>

	  <span class="enscript-comment"># Add in all the interfaces that we are compatible with.
</span>	  loop=$age
	  <span class="enscript-keyword">while</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$loop&quot;</span> -ne 0; <span class="enscript-keyword">do</span>
	    iface=`expr $current - $loop`
	    loop=`expr $loop - 1`
	    verstring=<span class="enscript-string">&quot;$verstring:${iface}.0&quot;</span>
	  <span class="enscript-keyword">done</span>

	  <span class="enscript-comment"># Make executables depend on our current version.
</span>	  verstring=<span class="enscript-string">&quot;$verstring:${current}.0&quot;</span>
	  ;;

	sunos)
	  major=<span class="enscript-string">&quot;.$current&quot;</span>
	  versuffix=<span class="enscript-string">&quot;.$current.$revision&quot;</span>
	  ;;

	windows)
	  <span class="enscript-comment"># Use '-' rather than '.', since we only want one
</span>	  <span class="enscript-comment"># extension on DOS 8.3 filesystems.
</span>	  major=`expr $current - $age`
	  versuffix=<span class="enscript-string">&quot;-$major&quot;</span>
	  ;;

	*)
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: unknown library version type \`$version_type'&quot;</span> 1&gt;&amp;2
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;Fatal configuration error.  See the $PACKAGE docs for more information.&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  ;;
	<span class="enscript-keyword">esac</span>

	<span class="enscript-comment"># Clear the version info if we defaulted, and they specified a release.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$vinfo&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$release&quot;</span>; <span class="enscript-keyword">then</span>
	  major=
	  <span class="enscript-keyword">case</span> $version_type <span class="enscript-keyword">in</span>
	  darwin)
	    <span class="enscript-comment"># we can't check for &quot;0.0&quot; in archive_cmds due to quoting
</span>	    <span class="enscript-comment"># problems, so we reset it completely
</span>	    verstring=
	    ;;
	  *)
	    verstring=<span class="enscript-string">&quot;0.0&quot;</span>
	    ;;
	  <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$need_version&quot;</span> = no; <span class="enscript-keyword">then</span>
	    versuffix=
	  <span class="enscript-keyword">else</span>
	    versuffix=<span class="enscript-string">&quot;.0.0&quot;</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">fi</span>

	<span class="enscript-comment"># Remove version info from name if versioning should be avoided
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$avoid_version&quot;</span> = yes &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$need_version&quot;</span> = no; <span class="enscript-keyword">then</span>
	  major=
	  versuffix=
	  verstring=<span class="enscript-string">&quot;&quot;</span>
	<span class="enscript-keyword">fi</span>

	<span class="enscript-comment"># Check to see if the archive will have undefined symbols.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$allow_undefined&quot;</span> = yes; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$allow_undefined_flag&quot;</span> = unsupported; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: undefined symbols not allowed in $host shared libraries&quot;</span> 1&gt;&amp;2
	    build_libtool_libs=no
	    build_old_libs=yes
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">else</span>
	  <span class="enscript-comment"># Don't allow undefined symbols.
</span>	  allow_undefined_flag=<span class="enscript-string">&quot;$no_undefined_flag&quot;</span>
	<span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$mode&quot;</span> != relink; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># Remove our outputs, but don't remove object files since they
</span>	<span class="enscript-comment"># may have been created when compiling PIC objects.
</span>	removelist=
	tempremovelist=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$output_objdir/*&quot;</span>`
	<span class="enscript-keyword">for</span> p <span class="enscript-keyword">in</span> $tempremovelist; <span class="enscript-keyword">do</span>
	  <span class="enscript-keyword">case</span> $p <span class="enscript-keyword">in</span>
	    *.$objext)
	       ;;
	    $output_objdir/$outputname | $output_objdir/$libname.* | $output_objdir/${libname}${release}.*)
	       <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$precious_files_regex&quot;</span> != <span class="enscript-string">&quot;X&quot;</span>; <span class="enscript-keyword">then</span>
	         <span class="enscript-keyword">if</span> <span class="enscript-keyword">echo</span> $p | $EGREP -e <span class="enscript-string">&quot;$precious_files_regex&quot;</span> &gt;/dev/null 2&gt;&amp;1
	         <span class="enscript-keyword">then</span>
		   <span class="enscript-keyword">continue</span>
		 <span class="enscript-keyword">fi</span>
	       <span class="enscript-keyword">fi</span>
	       removelist=<span class="enscript-string">&quot;$removelist $p&quot;</span>
	       ;;
	    *) ;;
	  <span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">done</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$removelist&quot;</span>; <span class="enscript-keyword">then</span>
	  $show <span class="enscript-string">&quot;${rm}r $removelist&quot;</span>
	  $run ${rm}r $removelist
	<span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Now set the variables for building old libraries.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_old_libs&quot;</span> = yes &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> != convenience ; <span class="enscript-keyword">then</span>
	oldlibs=<span class="enscript-string">&quot;$oldlibs $output_objdir/$libname.$libext&quot;</span>

	<span class="enscript-comment"># Transform .lo files to .o files.
</span>	oldobjs=<span class="enscript-string">&quot;$objs &quot;</span>`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$libobjs&quot;</span> | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e <span class="enscript-string">&quot;$lo2o&quot;</span> | $NL2SP`
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Eliminate all temporary directories.
</span>      <span class="enscript-keyword">for</span> path <span class="enscript-keyword">in</span> $notinst_path; <span class="enscript-keyword">do</span>
	lib_search_path=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$lib_search_path &quot;</span> | ${SED} -e <span class="enscript-string">&quot;s% $path % %g&quot;</span>`
	deplibs=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$deplibs &quot;</span> | ${SED} -e <span class="enscript-string">&quot;s% -L$path % %g&quot;</span>`
	dependency_libs=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$dependency_libs &quot;</span> | ${SED} -e <span class="enscript-string">&quot;s% -L$path % %g&quot;</span>`
      <span class="enscript-keyword">done</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$xrpath&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># If the user specified any rpath flags, then add them.
</span>	temp_xrpath=
	<span class="enscript-keyword">for</span> libdir <span class="enscript-keyword">in</span> $xrpath; <span class="enscript-keyword">do</span>
	  temp_xrpath=<span class="enscript-string">&quot;$temp_xrpath -R$libdir&quot;</span>
	  <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$finalize_rpath &quot;</span> <span class="enscript-keyword">in</span>
	  *<span class="enscript-string">&quot; $libdir &quot;</span>*) ;;
	  *) finalize_rpath=<span class="enscript-string">&quot;$finalize_rpath $libdir&quot;</span> ;;
	  <span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">done</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$hardcode_into_libs&quot;</span> != yes || <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_old_libs&quot;</span> = yes; <span class="enscript-keyword">then</span>
	  dependency_libs=<span class="enscript-string">&quot;$temp_xrpath $dependency_libs&quot;</span>
	<span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Make sure dlfiles contains only unique files that won't be dlpreopened
</span>      old_dlfiles=<span class="enscript-string">&quot;$dlfiles&quot;</span>
      dlfiles=
      <span class="enscript-keyword">for</span> lib <span class="enscript-keyword">in</span> $old_dlfiles; <span class="enscript-keyword">do</span>
	<span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $dlprefiles $dlfiles &quot;</span> <span class="enscript-keyword">in</span>
	*<span class="enscript-string">&quot; $lib &quot;</span>*) ;;
	*) dlfiles=<span class="enscript-string">&quot;$dlfiles $lib&quot;</span> ;;
	<span class="enscript-keyword">esac</span>
      <span class="enscript-keyword">done</span>

      <span class="enscript-comment"># Make sure dlprefiles contains only unique files
</span>      old_dlprefiles=<span class="enscript-string">&quot;$dlprefiles&quot;</span>
      dlprefiles=
      <span class="enscript-keyword">for</span> lib <span class="enscript-keyword">in</span> $old_dlprefiles; <span class="enscript-keyword">do</span>
	<span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$dlprefiles &quot;</span> <span class="enscript-keyword">in</span>
	*<span class="enscript-string">&quot; $lib &quot;</span>*) ;;
	*) dlprefiles=<span class="enscript-string">&quot;$dlprefiles $lib&quot;</span> ;;
	<span class="enscript-keyword">esac</span>
      <span class="enscript-keyword">done</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = yes; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$rpath&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos*)
	    <span class="enscript-comment"># these systems don't actually have a c library (as such)!
</span>	    ;;
	  *-*-rhapsody* | *-*-darwin1.[012])
	    <span class="enscript-comment"># Rhapsody C library is in the System framework
</span>	    deplibs=<span class="enscript-string">&quot;$deplibs -framework System&quot;</span>
	    ;;
	  *-*-netbsd*)
	    <span class="enscript-comment"># Don't link with libc until the a.out ld.so is fixed.
</span>	    ;;
	  *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
	    <span class="enscript-comment"># Do not include libc due to us having libc/libc_r.
</span>	    ;;
	  *-*-sco3.2v5* | *-*-sco5v6*)
	    <span class="enscript-comment"># Causes problems with __ctype
</span>	    ;;
	  *-*-sysv4.2uw2* | *-*-sysv5* | *-*-unixware* | *-*-OpenUNIX*)
	    <span class="enscript-comment"># Compiler inserts libc in the correct place for threads to work
</span>	    ;;
 	  *)
	    <span class="enscript-comment"># Add libc to deplibs on all other systems if necessary.
</span>	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_need_lc&quot;</span> = <span class="enscript-string">&quot;yes&quot;</span>; <span class="enscript-keyword">then</span>
	      deplibs=<span class="enscript-string">&quot;$deplibs -lc&quot;</span>
	    <span class="enscript-keyword">fi</span>
	    ;;
	  <span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">fi</span>

	<span class="enscript-comment"># Transform deplibs into only deplibs that can be linked in shared.
</span>	name_save=$name
	libname_save=$libname
	release_save=$release
	versuffix_save=$versuffix
	major_save=$major
	<span class="enscript-comment"># I'm not sure if I'm treating the release correctly.  I think
</span>	<span class="enscript-comment"># release should show up in the -l (ie -lgmp5) so we don't want to
</span>	<span class="enscript-comment"># add it in twice.  Is that correct?
</span>	release=<span class="enscript-string">&quot;&quot;</span>
	versuffix=<span class="enscript-string">&quot;&quot;</span>
	major=<span class="enscript-string">&quot;&quot;</span>
	newdeplibs=
	droppeddeps=no
	<span class="enscript-keyword">case</span> $deplibs_check_method <span class="enscript-keyword">in</span>
	pass_all)
	  <span class="enscript-comment"># Don't check for shared/static.  Everything works.
</span>	  <span class="enscript-comment"># This might be a little naive.  We might want to check
</span>	  <span class="enscript-comment"># whether the library exists or not.  But this is on
</span>	  <span class="enscript-comment"># osf3 &amp; osf4 and I'm not really sure... Just
</span>	  <span class="enscript-comment"># implementing what was already the behavior.
</span>	  newdeplibs=$deplibs
	  ;;
	test_compile)
	  <span class="enscript-comment"># This code stresses the &quot;libraries are programs&quot; paradigm to its
</span>	  <span class="enscript-comment"># limits. Maybe even breaks it.  We compile a program, linking it
</span>	  <span class="enscript-comment"># against the deplibs as a proxy for the library.  Then we can check
</span>	  <span class="enscript-comment"># whether they linked in statically or dynamically with ldd.
</span>	  $rm conftest.c
	  cat &gt; conftest.c &lt;&lt;EOF
	  int main() { <span class="enscript-keyword">return</span> 0; }
EOF
	  $rm conftest
	  $LTCC $LTCFLAGS -o conftest conftest.c $deplibs
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$?&quot;</span> -eq 0 ; <span class="enscript-keyword">then</span>
	    ldd_output=`ldd conftest`
	    <span class="enscript-keyword">for</span> i <span class="enscript-keyword">in</span> $deplibs; <span class="enscript-keyword">do</span>
	      name=`expr $i : '-l\(.*\)'`
	      <span class="enscript-comment"># If $name is empty we are operating on a -L argument.
</span>              <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$name&quot;</span> != <span class="enscript-string">&quot;&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$name&quot;</span> -ne <span class="enscript-string">&quot;0&quot;</span>; <span class="enscript-keyword">then</span>
		<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$allow_libtool_libs_with_static_runtimes&quot;</span> = <span class="enscript-string">&quot;Xyes&quot;</span> ; <span class="enscript-keyword">then</span>
		  <span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $predeps $postdeps &quot;</span> <span class="enscript-keyword">in</span>
		  *<span class="enscript-string">&quot; $i &quot;</span>*)
		    newdeplibs=<span class="enscript-string">&quot;$newdeplibs $i&quot;</span>
		    i=<span class="enscript-string">&quot;&quot;</span>
		    ;;
		  <span class="enscript-keyword">esac</span>
	        <span class="enscript-keyword">fi</span>
		<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$i&quot;</span> ; <span class="enscript-keyword">then</span>
		  libname=`<span class="enscript-keyword">eval</span> \\$<span class="enscript-keyword">echo</span> \<span class="enscript-string">&quot;$libname_spec\&quot;`
		  deplib_matches=`eval \\$echo \&quot;$library_names_spec\&quot;`
		  set dummy $deplib_matches
		  deplib_match=$2
		  if test `expr &quot;</span>$ldd_output<span class="enscript-string">&quot; : &quot;</span>.*$deplib_match<span class="enscript-string">&quot;` -ne 0 ; then
		    newdeplibs=&quot;</span>$newdeplibs $i<span class="enscript-string">&quot;
		  else
		    droppeddeps=yes
		    $echo
		    $echo &quot;</span>*** Warning: dynamic linker does not accept needed library $i.<span class="enscript-string">&quot;
		    $echo &quot;</span>*** I have the capability to make that library automatically link <span class="enscript-keyword">in</span> when<span class="enscript-string">&quot;
		    $echo &quot;</span>*** you link to this library.  But I can only <span class="enscript-keyword">do</span> this <span class="enscript-keyword">if</span> you have a<span class="enscript-string">&quot;
		    $echo &quot;</span>*** shared version of the library, which I believe you <span class="enscript-keyword">do</span> not have<span class="enscript-string">&quot;
		    $echo &quot;</span>*** because a test_compile did reveal that the linker did not use it <span class="enscript-keyword">for</span><span class="enscript-string">&quot;
		    $echo &quot;</span>*** its dynamic dependency list that programs get resolved with at runtime.<span class="enscript-string">&quot;
		  fi
		fi
	      else
		newdeplibs=&quot;</span>$newdeplibs $i<span class="enscript-string">&quot;
	      fi
	    done
	  else
	    # Error occurred in the first compile.  Let's try to salvage
	    # the situation: Compile a separate program for each library.
	    for i in $deplibs; do
	      name=`expr $i : '-l\(.*\)'`
	      # If $name is empty we are operating on a -L argument.
              if test &quot;</span>$name<span class="enscript-string">&quot; != &quot;</span><span class="enscript-string">&quot; &amp;&amp; test &quot;</span>$name<span class="enscript-string">&quot; != &quot;</span>0<span class="enscript-string">&quot;; then
		$rm conftest
		$LTCC $LTCFLAGS -o conftest conftest.c $i
		# Did it work?
		if test &quot;</span>$?<span class="enscript-string">&quot; -eq 0 ; then
		  ldd_output=`ldd conftest`
		  if test &quot;</span>X$allow_libtool_libs_with_static_runtimes<span class="enscript-string">&quot; = &quot;</span>Xyes<span class="enscript-string">&quot; ; then
		    case &quot;</span> $predeps $postdeps <span class="enscript-string">&quot; in
		    *&quot;</span> $i <span class="enscript-string">&quot;*)
		      newdeplibs=&quot;</span>$newdeplibs $i<span class="enscript-string">&quot;
		      i=&quot;</span><span class="enscript-string">&quot;
		      ;;
		    esac
		  fi
		  if test -n &quot;</span>$i<span class="enscript-string">&quot; ; then
		    libname=`eval \\$echo \&quot;$libname_spec\&quot;`
		    deplib_matches=`eval \\$echo \&quot;$library_names_spec\&quot;`
		    set dummy $deplib_matches
		    deplib_match=$2
		    if test `expr &quot;</span>$ldd_output<span class="enscript-string">&quot; : &quot;</span>.*$deplib_match<span class="enscript-string">&quot;` -ne 0 ; then
		      newdeplibs=&quot;</span>$newdeplibs $i<span class="enscript-string">&quot;
		    else
		      droppeddeps=yes
		      $echo
		      $echo &quot;</span>*** Warning: dynamic linker does not accept needed library $i.<span class="enscript-string">&quot;
		      $echo &quot;</span>*** I have the capability to make that library automatically link <span class="enscript-keyword">in</span> when<span class="enscript-string">&quot;
		      $echo &quot;</span>*** you link to this library.  But I can only <span class="enscript-keyword">do</span> this <span class="enscript-keyword">if</span> you have a<span class="enscript-string">&quot;
		      $echo &quot;</span>*** shared version of the library, which you <span class="enscript-keyword">do</span> not appear to have<span class="enscript-string">&quot;
		      $echo &quot;</span>*** because a test_compile did reveal that the linker did not use this one<span class="enscript-string">&quot;
		      $echo &quot;</span>*** as a dynamic dependency that programs can get resolved with at runtime.<span class="enscript-string">&quot;
		    fi
		  fi
		else
		  droppeddeps=yes
		  $echo
		  $echo &quot;</span>*** Warning!  Library $i is needed by this library but I was not able to<span class="enscript-string">&quot;
		  $echo &quot;</span>***  make it link <span class="enscript-keyword">in</span>!  You will probably need to install it or some<span class="enscript-string">&quot;
		  $echo &quot;</span>*** library that it depends on before this library will be fully<span class="enscript-string">&quot;
		  $echo &quot;</span>*** functional.  Installing it before continuing would be even better.<span class="enscript-string">&quot;
		fi
	      else
		newdeplibs=&quot;</span>$newdeplibs $i<span class="enscript-string">&quot;
	      fi
	    done
	  fi
	  ;;
	file_magic*)
	  set dummy $deplibs_check_method
	  file_magic_regex=`expr &quot;</span>$deplibs_check_method<span class="enscript-string">&quot; : &quot;</span>$2 \(.*\)<span class="enscript-string">&quot;`
	  for a_deplib in $deplibs; do
	    name=`expr $a_deplib : '-l\(.*\)'`
	    # If $name is empty we are operating on a -L argument.
            if test &quot;</span>$name<span class="enscript-string">&quot; != &quot;</span><span class="enscript-string">&quot; &amp;&amp; test  &quot;</span>$name<span class="enscript-string">&quot; != &quot;</span>0<span class="enscript-string">&quot;; then
	      if test &quot;</span>X$allow_libtool_libs_with_static_runtimes<span class="enscript-string">&quot; = &quot;</span>Xyes<span class="enscript-string">&quot; ; then
		case &quot;</span> $predeps $postdeps <span class="enscript-string">&quot; in
		*&quot;</span> $a_deplib <span class="enscript-string">&quot;*)
		  newdeplibs=&quot;</span>$newdeplibs $a_deplib<span class="enscript-string">&quot;
		  a_deplib=&quot;</span><span class="enscript-string">&quot;
		  ;;
		esac
	      fi
	      if test -n &quot;</span>$a_deplib<span class="enscript-string">&quot; ; then
		libname=`eval \\$echo \&quot;$libname_spec\&quot;`
		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
		  potential_libs=`ls $i/$libname[.-]* 2&gt;/dev/null`
		  for potent_lib in $potential_libs; do
		      # Follow soft links.
		      if ls -lLd &quot;</span>$potent_lib<span class="enscript-string">&quot; 2&gt;/dev/null \
			 | grep &quot;</span> -&gt; <span class="enscript-string">&quot; &gt;/dev/null; then
			continue
		      fi
		      # The statement above tries to avoid entering an
		      # endless loop below, in case of cyclic links.
		      # We might still enter an endless loop, since a link
		      # loop can be closed while we follow links,
		      # but so what?
		      potlib=&quot;</span>$potent_lib<span class="enscript-string">&quot;
		      while test -h &quot;</span>$potlib<span class="enscript-string">&quot; 2&gt;/dev/null; do
			potliblink=`ls -ld $potlib | ${SED} 's/.* -&gt; //'`
			case $potliblink in
			[\\/]* | [A-Za-z]:[\\/]*) potlib=&quot;</span>$potliblink<span class="enscript-string">&quot;;;
			*) potlib=`$echo &quot;</span>X$potlib<span class="enscript-string">&quot; | $Xsed -e 's,[^/]*$,,'`&quot;</span>$potliblink<span class="enscript-string">&quot;;;
			esac
		      done
		      if eval $file_magic_cmd \&quot;\$potlib\&quot; 2&gt;/dev/null \
			 | ${SED} 10q \
			 | $EGREP &quot;</span>$file_magic_regex<span class="enscript-string">&quot; &gt; /dev/null; then
			newdeplibs=&quot;</span>$newdeplibs $a_deplib<span class="enscript-string">&quot;
			a_deplib=&quot;</span><span class="enscript-string">&quot;
			break 2
		      fi
		  done
		done
	      fi
	      if test -n &quot;</span>$a_deplib<span class="enscript-string">&quot; ; then
		droppeddeps=yes
		$echo
		$echo &quot;</span>*** Warning: linker path does not have real file <span class="enscript-keyword">for</span> library $a_deplib.<span class="enscript-string">&quot;
		$echo &quot;</span>*** I have the capability to make that library automatically link <span class="enscript-keyword">in</span> when<span class="enscript-string">&quot;
		$echo &quot;</span>*** you link to this library.  But I can only <span class="enscript-keyword">do</span> this <span class="enscript-keyword">if</span> you have a<span class="enscript-string">&quot;
		$echo &quot;</span>*** shared version of the library, which you <span class="enscript-keyword">do</span> not appear to have<span class="enscript-string">&quot;
		$echo &quot;</span>*** because I did check the linker path looking <span class="enscript-keyword">for</span> a file starting<span class="enscript-string">&quot;
		if test -z &quot;</span>$potlib<span class="enscript-string">&quot; ; then
		  $echo &quot;</span>*** with $libname but no candidates were found. (...<span class="enscript-keyword">for</span> file magic <span class="enscript-keyword">test</span>)<span class="enscript-string">&quot;
		else
		  $echo &quot;</span>*** with $libname and none of the candidates passed a file format <span class="enscript-keyword">test</span><span class="enscript-string">&quot;
		  $echo &quot;</span>*** using a file magic. Last file checked: $potlib<span class="enscript-string">&quot;
		fi
	      fi
	    else
	      # Add a -L argument.
	      newdeplibs=&quot;</span>$newdeplibs $a_deplib<span class="enscript-string">&quot;
	    fi
	  done # Gone through all deplibs.
	  ;;
	match_pattern*)
	  set dummy $deplibs_check_method
	  match_pattern_regex=`expr &quot;</span>$deplibs_check_method<span class="enscript-string">&quot; : &quot;</span>$2 \(.*\)<span class="enscript-string">&quot;`
	  for a_deplib in $deplibs; do
	    name=`expr $a_deplib : '-l\(.*\)'`
	    # If $name is empty we are operating on a -L argument.
	    if test -n &quot;</span>$name<span class="enscript-string">&quot; &amp;&amp; test &quot;</span>$name<span class="enscript-string">&quot; != &quot;</span>0<span class="enscript-string">&quot;; then
	      if test &quot;</span>X$allow_libtool_libs_with_static_runtimes<span class="enscript-string">&quot; = &quot;</span>Xyes<span class="enscript-string">&quot; ; then
		case &quot;</span> $predeps $postdeps <span class="enscript-string">&quot; in
		*&quot;</span> $a_deplib <span class="enscript-string">&quot;*)
		  newdeplibs=&quot;</span>$newdeplibs $a_deplib<span class="enscript-string">&quot;
		  a_deplib=&quot;</span><span class="enscript-string">&quot;
		  ;;
		esac
	      fi
	      if test -n &quot;</span>$a_deplib<span class="enscript-string">&quot; ; then
		libname=`eval \\$echo \&quot;$libname_spec\&quot;`
		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
		  potential_libs=`ls $i/$libname[.-]* 2&gt;/dev/null`
		  for potent_lib in $potential_libs; do
		    potlib=&quot;</span>$potent_lib<span class="enscript-string">&quot; # see symlink-check above in file_magic test
		    if eval $echo \&quot;$potent_lib\&quot; 2&gt;/dev/null \
		        | ${SED} 10q \
		        | $EGREP &quot;</span>$match_pattern_regex<span class="enscript-string">&quot; &gt; /dev/null; then
		      newdeplibs=&quot;</span>$newdeplibs $a_deplib<span class="enscript-string">&quot;
		      a_deplib=&quot;</span><span class="enscript-string">&quot;
		      break 2
		    fi
		  done
		done
	      fi
	      if test -n &quot;</span>$a_deplib<span class="enscript-string">&quot; ; then
		droppeddeps=yes
		$echo
		$echo &quot;</span>*** Warning: linker path does not have real file <span class="enscript-keyword">for</span> library $a_deplib.<span class="enscript-string">&quot;
		$echo &quot;</span>*** I have the capability to make that library automatically link <span class="enscript-keyword">in</span> when<span class="enscript-string">&quot;
		$echo &quot;</span>*** you link to this library.  But I can only <span class="enscript-keyword">do</span> this <span class="enscript-keyword">if</span> you have a<span class="enscript-string">&quot;
		$echo &quot;</span>*** shared version of the library, which you <span class="enscript-keyword">do</span> not appear to have<span class="enscript-string">&quot;
		$echo &quot;</span>*** because I did check the linker path looking <span class="enscript-keyword">for</span> a file starting<span class="enscript-string">&quot;
		if test -z &quot;</span>$potlib<span class="enscript-string">&quot; ; then
		  $echo &quot;</span>*** with $libname but no candidates were found. (...<span class="enscript-keyword">for</span> regex pattern <span class="enscript-keyword">test</span>)<span class="enscript-string">&quot;
		else
		  $echo &quot;</span>*** with $libname and none of the candidates passed a file format <span class="enscript-keyword">test</span><span class="enscript-string">&quot;
		  $echo &quot;</span>*** using a regex pattern. Last file checked: $potlib<span class="enscript-string">&quot;
		fi
	      fi
	    else
	      # Add a -L argument.
	      newdeplibs=&quot;</span>$newdeplibs $a_deplib<span class="enscript-string">&quot;
	    fi
	  done # Gone through all deplibs.
	  ;;
	none | unknown | *)
	  newdeplibs=&quot;</span><span class="enscript-string">&quot;
	  tmp_deplibs=`$echo &quot;</span>X $deplibs<span class="enscript-string">&quot; | $Xsed -e 's/ -lc$//' \
	    -e 's/ -[LR][^ ]*//g'`
	  if test &quot;</span>X$allow_libtool_libs_with_static_runtimes<span class="enscript-string">&quot; = &quot;</span>Xyes<span class="enscript-string">&quot; ; then
	    for i in $predeps $postdeps ; do
	      # can't use Xsed below, because $i might contain '/'
	      tmp_deplibs=`$echo &quot;</span>X $tmp_deplibs<span class="enscript-string">&quot; | ${SED} -e &quot;</span>1s,^X,,<span class="enscript-string">&quot; -e &quot;</span>s,$i,,<span class="enscript-string">&quot;`
	    done
	  fi
	  if $echo &quot;</span>X $tmp_deplibs<span class="enscript-string">&quot; | $Xsed -e 's/[ 	]//g' \
	    | grep . &gt;/dev/null; then
	    $echo
	    if test &quot;</span>X$deplibs_check_method<span class="enscript-string">&quot; = &quot;</span>Xnone<span class="enscript-string">&quot;; then
	      $echo &quot;</span>*** Warning: inter-library dependencies are not supported <span class="enscript-keyword">in</span> this platform.<span class="enscript-string">&quot;
	    else
	      $echo &quot;</span>*** Warning: inter-library dependencies are not known to be supported.<span class="enscript-string">&quot;
	    fi
	    $echo &quot;</span>*** All declared inter-library dependencies are being dropped.<span class="enscript-string">&quot;
	    droppeddeps=yes
	  fi
	  ;;
	esac
	versuffix=$versuffix_save
	major=$major_save
	release=$release_save
	libname=$libname_save
	name=$name_save

	case $host in
	*-*-rhapsody* | *-*-darwin1.[012])
	  # On Rhapsody replace the C library is the System framework
	  newdeplibs=`$echo &quot;</span>X $newdeplibs<span class="enscript-string">&quot; | $Xsed -e 's/ -lc / -framework System /'`
	  ;;
	esac

	if test &quot;</span>$droppeddeps<span class="enscript-string">&quot; = yes; then
	  if test &quot;</span>$module<span class="enscript-string">&quot; = yes; then
	    $echo
	    $echo &quot;</span>*** Warning: libtool could not satisfy all declared inter-library<span class="enscript-string">&quot;
	    $echo &quot;</span>*** dependencies of module $libname.  Therefore, libtool will create<span class="enscript-string">&quot;
	    $echo &quot;</span>*** a static module, that should work as long as the dlopening<span class="enscript-string">&quot;
	    $echo &quot;</span>*** application is linked with the -dlopen flag.<span class="enscript-string">&quot;
	    if test -z &quot;</span>$global_symbol_pipe<span class="enscript-string">&quot;; then
	      $echo
	      $echo &quot;</span>*** However, this would only work <span class="enscript-keyword">if</span> libtool was able to extract symbol<span class="enscript-string">&quot;
	      $echo &quot;</span>*** lists from a program, using \`nm' or equivalent, but libtool could<span class="enscript-string">&quot;
	      $echo &quot;</span>*** not find such a program.  So, this module is probably useless.<span class="enscript-string">&quot;
	      $echo &quot;</span>*** \`nm' from GNU binutils and a full rebuild may help.<span class="enscript-string">&quot;
	    fi
	    if test &quot;</span>$build_old_libs<span class="enscript-string">&quot; = no; then
	      oldlibs=&quot;</span>$output_objdir/$libname.$libext<span class="enscript-string">&quot;
	      build_libtool_libs=module
	      build_old_libs=yes
	    else
	      build_libtool_libs=no
	    fi
	  else
	    $echo &quot;</span>*** The inter-library dependencies that have been dropped here will be<span class="enscript-string">&quot;
	    $echo &quot;</span>*** automatically added whenever a program is linked with this library<span class="enscript-string">&quot;
	    $echo &quot;</span>*** or is declared to -dlopen it.<span class="enscript-string">&quot;

	    if test &quot;</span>$allow_undefined<span class="enscript-string">&quot; = no; then
	      $echo
	      $echo &quot;</span>*** Since this library must not contain undefined symbols,<span class="enscript-string">&quot;
	      $echo &quot;</span>*** because either the platform does not support them or<span class="enscript-string">&quot;
	      $echo &quot;</span>*** it was explicitly requested with -no-undefined,<span class="enscript-string">&quot;
	      $echo &quot;</span>*** libtool will only create a static version of it.<span class="enscript-string">&quot;
	      if test &quot;</span>$build_old_libs<span class="enscript-string">&quot; = no; then
		oldlibs=&quot;</span>$output_objdir/$libname.$libext<span class="enscript-string">&quot;
		build_libtool_libs=module
		build_old_libs=yes
	      else
		build_libtool_libs=no
	      fi
	    fi
	  fi
	fi
	# Done checking deplibs!
	deplibs=$newdeplibs
      fi


      # move library search paths that coincide with paths to not yet
      # installed libraries to the beginning of the library search list
      new_libs=
      for path in $notinst_path; do
	case &quot;</span> $new_libs <span class="enscript-string">&quot; in
	*&quot;</span> -L$path/$objdir <span class="enscript-string">&quot;*) ;;
	*)
	  case &quot;</span> $deplibs <span class="enscript-string">&quot; in
	  *&quot;</span> -L$path/$objdir <span class="enscript-string">&quot;*)
	    new_libs=&quot;</span>$new_libs -L$path/$objdir<span class="enscript-string">&quot; ;;
	  esac
	  ;;
	esac
      done
      for deplib in $deplibs; do
	case $deplib in
	-L*)
	  case &quot;</span> $new_libs <span class="enscript-string">&quot; in
	  *&quot;</span> $deplib <span class="enscript-string">&quot;*) ;;
	  *) new_libs=&quot;</span>$new_libs $deplib<span class="enscript-string">&quot; ;;
	  esac
	  ;;
	*) new_libs=&quot;</span>$new_libs $deplib<span class="enscript-string">&quot; ;;
	esac
      done
      deplibs=&quot;</span>$new_libs<span class="enscript-string">&quot;


      # All the library-specific variables (install_libdir is set above).
      library_names=
      old_library=
      dlname=

      # Test again, we may have decided not to build it any more
      if test &quot;</span>$build_libtool_libs<span class="enscript-string">&quot; = yes; then
	if test &quot;</span>$hardcode_into_libs<span class="enscript-string">&quot; = yes; then
	  # Hardcode the library paths
	  hardcode_libdirs=
	  dep_rpath=
	  rpath=&quot;</span>$finalize_rpath<span class="enscript-string">&quot;
	  test &quot;</span>$mode<span class="enscript-string">&quot; != relink &amp;&amp; rpath=&quot;</span>$compile_rpath$rpath<span class="enscript-string">&quot;
	  for libdir in $rpath; do
	    if test -n &quot;</span>$hardcode_libdir_flag_spec<span class="enscript-string">&quot;; then
	      if test -n &quot;</span>$hardcode_libdir_separator<span class="enscript-string">&quot;; then
		if test -z &quot;</span>$hardcode_libdirs<span class="enscript-string">&quot;; then
		  hardcode_libdirs=&quot;</span>$libdir<span class="enscript-string">&quot;
		else
		  # Just accumulate the unique libdirs.
		  case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
		  *&quot;</span>$hardcode_libdir_separator$libdir$hardcode_libdir_separator<span class="enscript-string">&quot;*)
		    ;;
		  *)
		    hardcode_libdirs=&quot;</span>$hardcode_libdirs$hardcode_libdir_separator$libdir<span class="enscript-string">&quot;
		    ;;
		  esac
		fi
	      else
		eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
		dep_rpath=&quot;</span>$dep_rpath $flag<span class="enscript-string">&quot;
	      fi
	    elif test -n &quot;</span>$runpath_var<span class="enscript-string">&quot;; then
	      case &quot;</span>$perm_rpath <span class="enscript-string">&quot; in
	      *&quot;</span> $libdir <span class="enscript-string">&quot;*) ;;
	      *) perm_rpath=&quot;</span>$perm_rpath $libdir<span class="enscript-string">&quot; ;;
	      esac
	    fi
	  done
	  # Substitute the hardcoded libdirs into the rpath.
	  if test -n &quot;</span>$hardcode_libdir_separator<span class="enscript-string">&quot; &amp;&amp;
	     test -n &quot;</span>$hardcode_libdirs<span class="enscript-string">&quot;; then
	    libdir=&quot;</span>$hardcode_libdirs<span class="enscript-string">&quot;
	    if test -n &quot;</span>$hardcode_libdir_flag_spec_ld<span class="enscript-string">&quot;; then
	      eval dep_rpath=\&quot;$hardcode_libdir_flag_spec_ld\&quot;
	    else
	      eval dep_rpath=\&quot;$hardcode_libdir_flag_spec\&quot;
	    fi
	  fi
	  if test -n &quot;</span>$runpath_var<span class="enscript-string">&quot; &amp;&amp; test -n &quot;</span>$perm_rpath<span class="enscript-string">&quot;; then
	    # We should set the runpath_var.
	    rpath=
	    for dir in $perm_rpath; do
	      rpath=&quot;</span>$rpath$dir:<span class="enscript-string">&quot;
	    done
	    eval &quot;</span>$runpath_var='$rpath\$$runpath_var'; <span class="enscript-keyword">export</span> $runpath_var<span class="enscript-string">&quot;
	  fi
	  test -n &quot;</span>$dep_rpath<span class="enscript-string">&quot; &amp;&amp; deplibs=&quot;</span>$dep_rpath $deplibs<span class="enscript-string">&quot;
	fi

	shlibpath=&quot;</span>$finalize_shlibpath<span class="enscript-string">&quot;
	test &quot;</span>$mode<span class="enscript-string">&quot; != relink &amp;&amp; shlibpath=&quot;</span>$compile_shlibpath$shlibpath<span class="enscript-string">&quot;
	if test -n &quot;</span>$shlibpath<span class="enscript-string">&quot;; then
	  eval &quot;</span>$shlibpath_var='$shlibpath\$$shlibpath_var'; <span class="enscript-keyword">export</span> $shlibpath_var<span class="enscript-string">&quot;
	fi

	# Get the real and link names of the library.
	eval shared_ext=\&quot;$shrext_cmds\&quot;
	eval library_names=\&quot;$library_names_spec\&quot;
	set dummy $library_names
	realname=&quot;</span>$2<span class="enscript-string">&quot;
	shift; shift

	if test -n &quot;</span>$soname_spec<span class="enscript-string">&quot;; then
	  eval soname=\&quot;$soname_spec\&quot;
	else
	  soname=&quot;</span>$realname<span class="enscript-string">&quot;
	fi
	if test -z &quot;</span>$dlname<span class="enscript-string">&quot;; then
	  dlname=$soname
	fi

	lib=&quot;</span>$output_objdir/$realname<span class="enscript-string">&quot;
	linknames=
	for link
	do
	  linknames=&quot;</span>$linknames $link<span class="enscript-string">&quot;
	done

	# Use standard objects if they are pic
	test -z &quot;</span>$pic_flag<span class="enscript-string">&quot; &amp;&amp; libobjs=`$echo &quot;</span>X$libobjs<span class="enscript-string">&quot; | $SP2NL | $Xsed -e &quot;</span>$lo2o<span class="enscript-string">&quot; | $NL2SP`

	# Prepare the list of exported symbols
	if test -z &quot;</span>$export_symbols<span class="enscript-string">&quot;; then
	  if test &quot;</span>$always_export_symbols<span class="enscript-string">&quot; = yes || test -n &quot;</span>$export_symbols_regex<span class="enscript-string">&quot;; then
	    $show &quot;</span>generating symbol list <span class="enscript-keyword">for</span> \`$libname.la'<span class="enscript-string">&quot;
	    export_symbols=&quot;</span>$output_objdir/$libname.exp<span class="enscript-string">&quot;
	    $run $rm $export_symbols
	    cmds=$export_symbols_cmds
	    save_ifs=&quot;</span>$<span class="enscript-keyword">IFS</span><span class="enscript-string">&quot;; IFS='~'
	    for cmd in $cmds; do
	      IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	      eval cmd=\&quot;$cmd\&quot;
	      if len=`expr &quot;</span>X$cmd<span class="enscript-string">&quot; : &quot;</span>.*<span class="enscript-string">&quot;` &amp;&amp;
	       test &quot;</span>$len<span class="enscript-string">&quot; -le &quot;</span>$max_cmd_len<span class="enscript-string">&quot; || test &quot;</span>$max_cmd_len<span class="enscript-string">&quot; -le -1; then
	        $show &quot;</span>$cmd<span class="enscript-string">&quot;
	        $run eval &quot;</span>$cmd<span class="enscript-string">&quot; || exit $?
	        skipped_export=false
	      else
	        # The command line is too long to execute in one step.
	        $show &quot;</span>using reloadable object file <span class="enscript-keyword">for</span> <span class="enscript-keyword">export</span> list...<span class="enscript-string">&quot;
	        skipped_export=:
		# Break out early, otherwise skipped_export may be
		# set to false by a later but shorter cmd.
		break
	      fi
	    done
	    IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	    if test -n &quot;</span>$export_symbols_regex<span class="enscript-string">&quot;; then
	      $show &quot;</span>$EGREP -e \<span class="enscript-string">&quot;$export_symbols_regex\&quot; \&quot;$export_symbols\&quot; &gt; \&quot;${export_symbols}T\&quot;&quot;</span>
	      $run <span class="enscript-keyword">eval</span> '$EGREP -e <span class="enscript-string">&quot;$export_symbols_regex&quot;</span> <span class="enscript-string">&quot;$export_symbols&quot;</span> &gt; <span class="enscript-string">&quot;${export_symbols}T&quot;</span>'
	      $show <span class="enscript-string">&quot;$mv \&quot;${export_symbols}T\&quot; \&quot;$export_symbols\&quot;&quot;</span>
	      $run <span class="enscript-keyword">eval</span> '$mv <span class="enscript-string">&quot;${export_symbols}T&quot;</span> <span class="enscript-string">&quot;$export_symbols&quot;</span>'
	    <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">fi</span>

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$export_symbols&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$include_expsyms&quot;</span>; <span class="enscript-keyword">then</span>
	  $run <span class="enscript-keyword">eval</span> '$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$include_expsyms&quot;</span> | $SP2NL &gt;&gt; <span class="enscript-string">&quot;$export_symbols&quot;</span>'
	<span class="enscript-keyword">fi</span>

	tmp_deplibs=
	<span class="enscript-keyword">for</span> test_deplib <span class="enscript-keyword">in</span> $deplibs; <span class="enscript-keyword">do</span>
		<span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $convenience &quot;</span> <span class="enscript-keyword">in</span>
		*<span class="enscript-string">&quot; $test_deplib &quot;</span>*) ;;
		*)
			tmp_deplibs=<span class="enscript-string">&quot;$tmp_deplibs $test_deplib&quot;</span>
			;;
		<span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">done</span>
	deplibs=<span class="enscript-string">&quot;$tmp_deplibs&quot;</span>

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$convenience&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$whole_archive_flag_spec&quot;</span>; <span class="enscript-keyword">then</span>
	    save_libobjs=$libobjs
	    <span class="enscript-keyword">eval</span> libobjs=\<span class="enscript-string">&quot;\$libobjs $whole_archive_flag_spec\&quot;
	  else
	    gentop=&quot;</span>$output_objdir/${outputname}x<span class="enscript-string">&quot;
	    generated=&quot;</span>$generated $gentop<span class="enscript-string">&quot;

	    func_extract_archives $gentop $convenience
	    libobjs=&quot;</span>$libobjs $func_extract_archives_result<span class="enscript-string">&quot;
	  fi
	fi
	
	if test &quot;</span>$thread_safe<span class="enscript-string">&quot; = yes &amp;&amp; test -n &quot;</span>$thread_safe_flag_spec<span class="enscript-string">&quot;; then
	  eval flag=\&quot;$thread_safe_flag_spec\&quot;
	  linker_flags=&quot;</span>$linker_flags $flag<span class="enscript-string">&quot;
	fi

	# Make a backup of the uninstalled library when relinking
	if test &quot;</span>$mode<span class="enscript-string">&quot; = relink; then
	  $run eval '(cd $output_objdir &amp;&amp; $rm ${realname}U &amp;&amp; $mv $realname ${realname}U)' || exit $?
	fi

	# Do each of the archive commands.
	if test &quot;</span>$module<span class="enscript-string">&quot; = yes &amp;&amp; test -n &quot;</span>$module_cmds<span class="enscript-string">&quot; ; then
	  if test -n &quot;</span>$export_symbols<span class="enscript-string">&quot; &amp;&amp; test -n &quot;</span>$module_expsym_cmds<span class="enscript-string">&quot;; then
	    eval test_cmds=\&quot;$module_expsym_cmds\&quot;
	    cmds=$module_expsym_cmds
	  else
	    eval test_cmds=\&quot;$module_cmds\&quot;
	    cmds=$module_cmds
	  fi
	else
	if test -n &quot;</span>$export_symbols<span class="enscript-string">&quot; &amp;&amp; test -n &quot;</span>$archive_expsym_cmds<span class="enscript-string">&quot;; then
	  eval test_cmds=\&quot;$archive_expsym_cmds\&quot;
	  cmds=$archive_expsym_cmds
	else
	  eval test_cmds=\&quot;$archive_cmds\&quot;
	  cmds=$archive_cmds
	  fi
	fi

	if test &quot;</span>X$skipped_export<span class="enscript-string">&quot; != &quot;</span>X:<span class="enscript-string">&quot; &amp;&amp;
	   len=`expr &quot;</span>X$test_cmds<span class="enscript-string">&quot; : &quot;</span>.*<span class="enscript-string">&quot; 2&gt;/dev/null` &amp;&amp;
	   test &quot;</span>$len<span class="enscript-string">&quot; -le &quot;</span>$max_cmd_len<span class="enscript-string">&quot; || test &quot;</span>$max_cmd_len<span class="enscript-string">&quot; -le -1; then
	  :
	else
	  # The command line is too long to link in one step, link piecewise.
	  $echo &quot;</span>creating reloadable object files...<span class="enscript-string">&quot;

	  # Save the value of $output and $libobjs because we want to
	  # use them later.  If we have whole_archive_flag_spec, we
	  # want to use save_libobjs as it was before
	  # whole_archive_flag_spec was expanded, because we can't
	  # assume the linker understands whole_archive_flag_spec.
	  # This may have to be revisited, in case too many
	  # convenience libraries get linked in and end up exceeding
	  # the spec.
	  if test -z &quot;</span>$convenience<span class="enscript-string">&quot; || test -z &quot;</span>$whole_archive_flag_spec<span class="enscript-string">&quot;; then
	    save_libobjs=$libobjs
	  fi
	  save_output=$output
	  output_la=`$echo &quot;</span>X$output<span class="enscript-string">&quot; | $Xsed -e &quot;</span>$basename<span class="enscript-string">&quot;`

	  # Clear the reloadable object creation command queue and
	  # initialize k to one.
	  test_cmds=
	  concat_cmds=
	  objlist=
	  delfiles=
	  last_robj=
	  k=1
	  output=$output_objdir/$output_la-${k}.$objext
	  # Loop over the list of objects to be linked.
	  for obj in $save_libobjs
	  do
	    eval test_cmds=\&quot;$reload_cmds $objlist $last_robj\&quot;
	    if test &quot;</span>X$objlist<span class="enscript-string">&quot; = X ||
	       { len=`expr &quot;</span>X$test_cmds<span class="enscript-string">&quot; : &quot;</span>.*<span class="enscript-string">&quot; 2&gt;/dev/null` &amp;&amp;
		 test &quot;</span>$len<span class="enscript-string">&quot; -le &quot;</span>$max_cmd_len<span class="enscript-string">&quot;; }; then
	      objlist=&quot;</span>$objlist $obj<span class="enscript-string">&quot;
	    else
	      # The command $test_cmds is almost too long, add a
	      # command to the queue.
	      if test &quot;</span>$k<span class="enscript-string">&quot; -eq 1 ; then
		# The first file doesn't have a previous command to add.
		eval concat_cmds=\&quot;$reload_cmds $objlist $last_robj\&quot;
	      else
		# All subsequent reloadable object files will link in
		# the last one created.
		eval concat_cmds=\&quot;\$concat_cmds~$reload_cmds $objlist $last_robj\&quot;
	      fi
	      last_robj=$output_objdir/$output_la-${k}.$objext
	      k=`expr $k + 1`
	      output=$output_objdir/$output_la-${k}.$objext
	      objlist=$obj
	      len=1
	    fi
	  done
	  # Handle the remaining objects by creating one last
	  # reloadable object file.  All subsequent reloadable object
	  # files will link in the last one created.
	  test -z &quot;</span>$concat_cmds<span class="enscript-string">&quot; || concat_cmds=$concat_cmds~
	  eval concat_cmds=\&quot;\${concat_cmds}$reload_cmds $objlist $last_robj\&quot;

	  if ${skipped_export-false}; then
	    $show &quot;</span>generating symbol list <span class="enscript-keyword">for</span> \`$libname.la'<span class="enscript-string">&quot;
	    export_symbols=&quot;</span>$output_objdir/$libname.exp<span class="enscript-string">&quot;
	    $run $rm $export_symbols
	    libobjs=$output
	    # Append the command to create the export file.
	    eval concat_cmds=\&quot;\$concat_cmds~$export_symbols_cmds\&quot;
          fi

	  # Set up a command to remove the reloadable object files
	  # after they are used.
	  i=0
	  while test &quot;</span>$i<span class="enscript-string">&quot; -lt &quot;</span>$k<span class="enscript-string">&quot;
	  do
	    i=`expr $i + 1`
	    delfiles=&quot;</span>$delfiles $output_objdir/$output_la-${i}.$objext<span class="enscript-string">&quot;
	  done

	  $echo &quot;</span>creating a temporary reloadable object file: $output<span class="enscript-string">&quot;

	  # Loop through the commands generated above and execute them.
	  save_ifs=&quot;</span>$<span class="enscript-keyword">IFS</span><span class="enscript-string">&quot;; IFS='~'
	  for cmd in $concat_cmds; do
	    IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	    $show &quot;</span>$cmd<span class="enscript-string">&quot;
	    $run eval &quot;</span>$cmd<span class="enscript-string">&quot; || exit $?
	  done
	  IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;

	  libobjs=$output
	  # Restore the value of output.
	  output=$save_output

	  if test -n &quot;</span>$convenience<span class="enscript-string">&quot; &amp;&amp; test -n &quot;</span>$whole_archive_flag_spec<span class="enscript-string">&quot;; then
	    eval libobjs=\&quot;\$libobjs $whole_archive_flag_spec\&quot;
	  fi
	  # Expand the library linking commands again to reset the
	  # value of $libobjs for piecewise linking.

	  # Do each of the archive commands.
	  if test &quot;</span>$module<span class="enscript-string">&quot; = yes &amp;&amp; test -n &quot;</span>$module_cmds<span class="enscript-string">&quot; ; then
	    if test -n &quot;</span>$export_symbols<span class="enscript-string">&quot; &amp;&amp; test -n &quot;</span>$module_expsym_cmds<span class="enscript-string">&quot;; then
	      cmds=$module_expsym_cmds
	    else
	      cmds=$module_cmds
	    fi
	  else
	  if test -n &quot;</span>$export_symbols<span class="enscript-string">&quot; &amp;&amp; test -n &quot;</span>$archive_expsym_cmds<span class="enscript-string">&quot;; then
	    cmds=$archive_expsym_cmds
	  else
	    cmds=$archive_cmds
	    fi
	  fi

	  # Append the command to remove the reloadable object files
	  # to the just-reset $cmds.
	  eval cmds=\&quot;\$cmds~\$rm $delfiles\&quot;
	fi
	save_ifs=&quot;</span>$<span class="enscript-keyword">IFS</span><span class="enscript-string">&quot;; IFS='~'
	for cmd in $cmds; do
	  IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	  eval cmd=\&quot;$cmd\&quot;
	  $show &quot;</span>$cmd<span class="enscript-string">&quot;
	  $run eval &quot;</span>$cmd<span class="enscript-string">&quot; || {
	    lt_exit=$?

	    # Restore the uninstalled library and exit
	    if test &quot;</span>$mode<span class="enscript-string">&quot; = relink; then
	      $run eval '(cd $output_objdir &amp;&amp; $rm ${realname}T &amp;&amp; $mv ${realname}U $realname)'
	    fi

	    exit $lt_exit
	  }
	done
	IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;

	# Restore the uninstalled library and exit
	if test &quot;</span>$mode<span class="enscript-string">&quot; = relink; then
	  $run eval '(cd $output_objdir &amp;&amp; $rm ${realname}T &amp;&amp; $mv $realname ${realname}T &amp;&amp; $mv &quot;</span>$realname<span class="enscript-string">&quot;U $realname)' || exit $?

	  if test -n &quot;</span>$convenience<span class="enscript-string">&quot;; then
	    if test -z &quot;</span>$whole_archive_flag_spec<span class="enscript-string">&quot;; then
	      $show &quot;</span>${rm}r $gentop<span class="enscript-string">&quot;
	      $run ${rm}r &quot;</span>$gentop<span class="enscript-string">&quot;
	    fi
	  fi

	  exit $EXIT_SUCCESS
	fi

	# Create links to the real library.
	for linkname in $linknames; do
	  if test &quot;</span>$realname<span class="enscript-string">&quot; != &quot;</span>$linkname<span class="enscript-string">&quot;; then
	    $show &quot;</span>(<span class="enscript-keyword">cd</span> $output_objdir &amp;&amp; $rm $linkname &amp;&amp; $LN_S $realname $linkname)<span class="enscript-string">&quot;
	    $run eval '(cd $output_objdir &amp;&amp; $rm $linkname &amp;&amp; $LN_S $realname $linkname)' || exit $?
	  fi
	done

	# If -module or -export-dynamic was specified, set the dlname.
	if test &quot;</span>$module<span class="enscript-string">&quot; = yes || test &quot;</span>$export_dynamic<span class="enscript-string">&quot; = yes; then
	  # On all known operating systems, these are identical.
	  dlname=&quot;</span>$soname<span class="enscript-string">&quot;
	fi
      fi
      ;;

    obj)
      if test -n &quot;</span>$deplibs<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-l' and \`-L' are ignored <span class="enscript-keyword">for</span> objects<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$dlfiles$dlprefiles<span class="enscript-string">&quot; || test &quot;</span>$dlself<span class="enscript-string">&quot; != no; then
	$echo &quot;</span>$modename: warning: \`-dlopen' is ignored <span class="enscript-keyword">for</span> objects<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$rpath<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-rpath' is ignored <span class="enscript-keyword">for</span> objects<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$xrpath<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-R' is ignored <span class="enscript-keyword">for</span> objects<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$vinfo<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-version-info' is ignored <span class="enscript-keyword">for</span> objects<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$release<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-release' is ignored <span class="enscript-keyword">for</span> objects<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      case $output in
      *.lo)
	if test -n &quot;</span>$objs$old_deplibs<span class="enscript-string">&quot;; then
	  $echo &quot;</span>$modename: cannot build library object \`$output' from non-libtool objects<span class="enscript-string">&quot; 1&gt;&amp;2
	  exit $EXIT_FAILURE
	fi
	libobj=&quot;</span>$output<span class="enscript-string">&quot;
	obj=`$echo &quot;</span>X$output<span class="enscript-string">&quot; | $Xsed -e &quot;</span>$lo2o<span class="enscript-string">&quot;`
	;;
      *)
	libobj=
	obj=&quot;</span>$output<span class="enscript-string">&quot;
	;;
      esac

      # Delete the old objects.
      $run $rm $obj $libobj

      # Objects from convenience libraries.  This assumes
      # single-version convenience libraries.  Whenever we create
      # different ones for PIC/non-PIC, this we'll have to duplicate
      # the extraction.
      reload_conv_objs=
      gentop=
      # reload_cmds runs $LD directly, so let us get rid of
      # -Wl from whole_archive_flag_spec
      wl=

      if test -n &quot;</span>$convenience<span class="enscript-string">&quot;; then
	if test -n &quot;</span>$whole_archive_flag_spec<span class="enscript-string">&quot;; then
	  eval reload_conv_objs=\&quot;\$reload_objs $whole_archive_flag_spec\&quot;
	else
	  gentop=&quot;</span>$output_objdir/${obj}x<span class="enscript-string">&quot;
	  generated=&quot;</span>$generated $gentop<span class="enscript-string">&quot;

	  func_extract_archives $gentop $convenience
	  reload_conv_objs=&quot;</span>$reload_objs $func_extract_archives_result<span class="enscript-string">&quot;
	fi
      fi

      # Create the old-style object.
      reload_objs=&quot;</span>$objs$old_deplibs <span class="enscript-string">&quot;`$echo &quot;</span>X$libobjs<span class="enscript-string">&quot; | $SP2NL | $Xsed -e '/\.'${libext}$'/d' -e '/\.lib$/d' -e &quot;</span>$lo2o<span class="enscript-string">&quot; | $NL2SP`&quot;</span> $reload_conv_objs<span class="enscript-string">&quot; ### testsuite: skip nested quoting test

      output=&quot;</span>$obj<span class="enscript-string">&quot;
      cmds=$reload_cmds
      save_ifs=&quot;</span>$<span class="enscript-keyword">IFS</span><span class="enscript-string">&quot;; IFS='~'
      for cmd in $cmds; do
	IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	eval cmd=\&quot;$cmd\&quot;
	$show &quot;</span>$cmd<span class="enscript-string">&quot;
	$run eval &quot;</span>$cmd<span class="enscript-string">&quot; || exit $?
      done
      IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;

      # Exit if we aren't doing a library object file.
      if test -z &quot;</span>$libobj<span class="enscript-string">&quot;; then
	if test -n &quot;</span>$gentop<span class="enscript-string">&quot;; then
	  $show &quot;</span>${rm}r $gentop<span class="enscript-string">&quot;
	  $run ${rm}r $gentop
	fi

	exit $EXIT_SUCCESS
      fi

      if test &quot;</span>$build_libtool_libs<span class="enscript-string">&quot; != yes; then
	if test -n &quot;</span>$gentop<span class="enscript-string">&quot;; then
	  $show &quot;</span>${rm}r $gentop<span class="enscript-string">&quot;
	  $run ${rm}r $gentop
	fi

	# Create an invalid libtool object if no PIC, so that we don't
	# accidentally link it into a program.
	# $show &quot;</span><span class="enscript-keyword">echo</span> timestamp &gt; $libobj<span class="enscript-string">&quot;
	# $run eval &quot;</span><span class="enscript-keyword">echo</span> timestamp &gt; $libobj<span class="enscript-string">&quot; || exit $?
	exit $EXIT_SUCCESS
      fi

      if test -n &quot;</span>$pic_flag<span class="enscript-string">&quot; || test &quot;</span>$pic_mode<span class="enscript-string">&quot; != default; then
	# Only do commands if we really have different PIC objects.
	reload_objs=&quot;</span>$libobjs $reload_conv_objs<span class="enscript-string">&quot;
	output=&quot;</span>$libobj<span class="enscript-string">&quot;
	cmds=$reload_cmds
	save_ifs=&quot;</span>$<span class="enscript-keyword">IFS</span><span class="enscript-string">&quot;; IFS='~'
	for cmd in $cmds; do
	  IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	  eval cmd=\&quot;$cmd\&quot;
	  $show &quot;</span>$cmd<span class="enscript-string">&quot;
	  $run eval &quot;</span>$cmd<span class="enscript-string">&quot; || exit $?
	done
	IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
      fi

      if test -n &quot;</span>$gentop<span class="enscript-string">&quot;; then
	$show &quot;</span>${rm}r $gentop<span class="enscript-string">&quot;
	$run ${rm}r $gentop
      fi

      exit $EXIT_SUCCESS
      ;;

    prog)
      case $host in
	*cygwin*) output=`$echo $output | ${SED} -e 's,.exe$,,;s,$,.exe,'` ;;
      esac
      if test -n &quot;</span>$vinfo<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-version-info' is ignored <span class="enscript-keyword">for</span> programs<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test -n &quot;</span>$release<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: warning: \`-release' is ignored <span class="enscript-keyword">for</span> programs<span class="enscript-string">&quot; 1&gt;&amp;2
      fi

      if test &quot;</span>$preload<span class="enscript-string">&quot; = yes; then
	if test &quot;</span>$dlopen_support<span class="enscript-string">&quot; = unknown &amp;&amp; test &quot;</span>$dlopen_self<span class="enscript-string">&quot; = unknown &amp;&amp;
	   test &quot;</span>$dlopen_self_static<span class="enscript-string">&quot; = unknown; then
	  $echo &quot;</span>$modename: warning: \`AC_LIBTOOL_DLOPEN' not used. Assuming no dlopen support.<span class="enscript-string">&quot;
	fi
      fi

      case $host in
      *-*-rhapsody* | *-*-darwin1.[012])
	# On Rhapsody replace the C library is the System framework
	compile_deplibs=`$echo &quot;</span>X $compile_deplibs<span class="enscript-string">&quot; | $Xsed -e 's/ -lc / -framework System /'`
	finalize_deplibs=`$echo &quot;</span>X $finalize_deplibs<span class="enscript-string">&quot; | $Xsed -e 's/ -lc / -framework System /'`
	;;
      esac

      case $host in
      *darwin*)
        # Don't allow lazy linking, it breaks C++ global constructors
        if test &quot;</span>$tagname<span class="enscript-string">&quot; = CXX ; then
        compile_command=&quot;</span>$compile_command ${wl}-bind_at_load<span class="enscript-string">&quot;
        finalize_command=&quot;</span>$finalize_command ${wl}-bind_at_load<span class="enscript-string">&quot;
        fi
        ;;
      esac


      # move library search paths that coincide with paths to not yet
      # installed libraries to the beginning of the library search list
      new_libs=
      for path in $notinst_path; do
	case &quot;</span> $new_libs <span class="enscript-string">&quot; in
	*&quot;</span> -L$path/$objdir <span class="enscript-string">&quot;*) ;;
	*)
	  case &quot;</span> $compile_deplibs <span class="enscript-string">&quot; in
	  *&quot;</span> -L$path/$objdir <span class="enscript-string">&quot;*)
	    new_libs=&quot;</span>$new_libs -L$path/$objdir<span class="enscript-string">&quot; ;;
	  esac
	  ;;
	esac
      done
      for deplib in $compile_deplibs; do
	case $deplib in
	-L*)
	  case &quot;</span> $new_libs <span class="enscript-string">&quot; in
	  *&quot;</span> $deplib <span class="enscript-string">&quot;*) ;;
	  *) new_libs=&quot;</span>$new_libs $deplib<span class="enscript-string">&quot; ;;
	  esac
	  ;;
	*) new_libs=&quot;</span>$new_libs $deplib<span class="enscript-string">&quot; ;;
	esac
      done
      compile_deplibs=&quot;</span>$new_libs<span class="enscript-string">&quot;


      compile_command=&quot;</span>$compile_command $compile_deplibs<span class="enscript-string">&quot;
      finalize_command=&quot;</span>$finalize_command $finalize_deplibs<span class="enscript-string">&quot;

      if test -n &quot;</span>$rpath$xrpath<span class="enscript-string">&quot;; then
	# If the user specified any rpath flags, then add them.
	for libdir in $rpath $xrpath; do
	  # This is the magic to use -rpath.
	  case &quot;</span>$finalize_rpath <span class="enscript-string">&quot; in
	  *&quot;</span> $libdir <span class="enscript-string">&quot;*) ;;
	  *) finalize_rpath=&quot;</span>$finalize_rpath $libdir<span class="enscript-string">&quot; ;;
	  esac
	done
      fi

      # Now hardcode the library paths
      rpath=
      hardcode_libdirs=
      for libdir in $compile_rpath $finalize_rpath; do
	if test -n &quot;</span>$hardcode_libdir_flag_spec<span class="enscript-string">&quot;; then
	  if test -n &quot;</span>$hardcode_libdir_separator<span class="enscript-string">&quot;; then
	    if test -z &quot;</span>$hardcode_libdirs<span class="enscript-string">&quot;; then
	      hardcode_libdirs=&quot;</span>$libdir<span class="enscript-string">&quot;
	    else
	      # Just accumulate the unique libdirs.
	      case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
	      *&quot;</span>$hardcode_libdir_separator$libdir$hardcode_libdir_separator<span class="enscript-string">&quot;*)
		;;
	      *)
		hardcode_libdirs=&quot;</span>$hardcode_libdirs$hardcode_libdir_separator$libdir<span class="enscript-string">&quot;
		;;
	      esac
	    fi
	  else
	    eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
	    rpath=&quot;</span>$rpath $flag<span class="enscript-string">&quot;
	  fi
	elif test -n &quot;</span>$runpath_var<span class="enscript-string">&quot;; then
	  case &quot;</span>$perm_rpath <span class="enscript-string">&quot; in
	  *&quot;</span> $libdir <span class="enscript-string">&quot;*) ;;
	  *) perm_rpath=&quot;</span>$perm_rpath $libdir<span class="enscript-string">&quot; ;;
	  esac
	fi
	case $host in
	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*)
	  testbindir=`$echo &quot;</span>X$libdir<span class="enscript-string">&quot; | $Xsed -e 's*/lib$*/bin*'`
	  case :$dllsearchpath: in
	  *&quot;</span>:$libdir:<span class="enscript-string">&quot;*) ;;
	  *) dllsearchpath=&quot;</span>$dllsearchpath:$libdir<span class="enscript-string">&quot;;;
	  esac
	  case :$dllsearchpath: in
	  *&quot;</span>:$testbindir:<span class="enscript-string">&quot;*) ;;
	  *) dllsearchpath=&quot;</span>$dllsearchpath:$testbindir<span class="enscript-string">&quot;;;
	  esac
	  ;;
	esac
      done
      # Substitute the hardcoded libdirs into the rpath.
      if test -n &quot;</span>$hardcode_libdir_separator<span class="enscript-string">&quot; &amp;&amp;
	 test -n &quot;</span>$hardcode_libdirs<span class="enscript-string">&quot;; then
	libdir=&quot;</span>$hardcode_libdirs<span class="enscript-string">&quot;
	eval rpath=\&quot; $hardcode_libdir_flag_spec\&quot;
      fi
      compile_rpath=&quot;</span>$rpath<span class="enscript-string">&quot;

      rpath=
      hardcode_libdirs=
      for libdir in $finalize_rpath; do
	if test -n &quot;</span>$hardcode_libdir_flag_spec<span class="enscript-string">&quot;; then
	  if test -n &quot;</span>$hardcode_libdir_separator<span class="enscript-string">&quot;; then
	    if test -z &quot;</span>$hardcode_libdirs<span class="enscript-string">&quot;; then
	      hardcode_libdirs=&quot;</span>$libdir<span class="enscript-string">&quot;
	    else
	      # Just accumulate the unique libdirs.
	      case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
	      *&quot;</span>$hardcode_libdir_separator$libdir$hardcode_libdir_separator<span class="enscript-string">&quot;*)
		;;
	      *)
		hardcode_libdirs=&quot;</span>$hardcode_libdirs$hardcode_libdir_separator$libdir<span class="enscript-string">&quot;
		;;
	      esac
	    fi
	  else
	    eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
	    rpath=&quot;</span>$rpath $flag<span class="enscript-string">&quot;
	  fi
	elif test -n &quot;</span>$runpath_var<span class="enscript-string">&quot;; then
	  case &quot;</span>$finalize_perm_rpath <span class="enscript-string">&quot; in
	  *&quot;</span> $libdir <span class="enscript-string">&quot;*) ;;
	  *) finalize_perm_rpath=&quot;</span>$finalize_perm_rpath $libdir<span class="enscript-string">&quot; ;;
	  esac
	fi
      done
      # Substitute the hardcoded libdirs into the rpath.
      if test -n &quot;</span>$hardcode_libdir_separator<span class="enscript-string">&quot; &amp;&amp;
	 test -n &quot;</span>$hardcode_libdirs<span class="enscript-string">&quot;; then
	libdir=&quot;</span>$hardcode_libdirs<span class="enscript-string">&quot;
	eval rpath=\&quot; $hardcode_libdir_flag_spec\&quot;
      fi
      finalize_rpath=&quot;</span>$rpath<span class="enscript-string">&quot;

      if test -n &quot;</span>$libobjs<span class="enscript-string">&quot; &amp;&amp; test &quot;</span>$build_old_libs<span class="enscript-string">&quot; = yes; then
	# Transform all the library objects into standard objects.
	compile_command=`$echo &quot;</span>X$compile_command<span class="enscript-string">&quot; | $SP2NL | $Xsed -e &quot;</span>$lo2o<span class="enscript-string">&quot; | $NL2SP`
	finalize_command=`$echo &quot;</span>X$finalize_command<span class="enscript-string">&quot; | $SP2NL | $Xsed -e &quot;</span>$lo2o<span class="enscript-string">&quot; | $NL2SP`
      fi

      dlsyms=
      if test -n &quot;</span>$dlfiles$dlprefiles<span class="enscript-string">&quot; || test &quot;</span>$dlself<span class="enscript-string">&quot; != no; then
	if test -n &quot;</span>$NM<span class="enscript-string">&quot; &amp;&amp; test -n &quot;</span>$global_symbol_pipe<span class="enscript-string">&quot;; then
	  dlsyms=&quot;</span>${outputname}S.c<span class="enscript-string">&quot;
	else
	  $echo &quot;</span>$modename: not configured to extract global symbols from dlpreopened files<span class="enscript-string">&quot; 1&gt;&amp;2
	fi
      fi

      if test -n &quot;</span>$dlsyms<span class="enscript-string">&quot;; then
	case $dlsyms in
	&quot;</span><span class="enscript-string">&quot;) ;;
	*.c)
	  # Discover the nlist of each of the dlfiles.
	  nlist=&quot;</span>$output_objdir/${outputname}.nm<span class="enscript-string">&quot;

	  $show &quot;</span>$rm $nlist ${nlist}S ${nlist}T<span class="enscript-string">&quot;
	  $run $rm &quot;</span>$nlist<span class="enscript-string">&quot; &quot;</span>${nlist}S<span class="enscript-string">&quot; &quot;</span>${nlist}T<span class="enscript-string">&quot;

	  # Parse the name list into a source file.
	  $show &quot;</span>creating $output_objdir/$dlsyms<span class="enscript-string">&quot;

	  test -z &quot;</span>$run<span class="enscript-string">&quot; &amp;&amp; $echo &gt; &quot;</span>$output_objdir/$dlsyms<span class="enscript-string">&quot; &quot;</span>\
/* $dlsyms - symbol resolution table <span class="enscript-keyword">for</span> \`$outputname' dlsym emulation. */
/* Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP */

<span class="enscript-comment">#ifdef __cplusplus
</span>extern \<span class="enscript-string">&quot;C\&quot; {
#endif

/* Prevent the only kind of declaration conflicts we can make. */
#define lt_preloaded_symbols some_other_symbol

/* External symbol declarations for the compiler. */\
&quot;</span>

	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$dlself&quot;</span> = yes; <span class="enscript-keyword">then</span>
	    $show <span class="enscript-string">&quot;generating symbol list for \`$output'&quot;</span>

	    <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span> &amp;&amp; $<span class="enscript-keyword">echo</span> ': @PROGRAM@ ' &gt; <span class="enscript-string">&quot;$nlist&quot;</span>

	    <span class="enscript-comment"># Add our own program objects to the symbol list.
</span>	    progfiles=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$objs$old_deplibs&quot;</span> | $SP2NL | $Xsed -e <span class="enscript-string">&quot;$lo2o&quot;</span> | $NL2SP`
	    <span class="enscript-keyword">for</span> arg <span class="enscript-keyword">in</span> $progfiles; <span class="enscript-keyword">do</span>
	      $show <span class="enscript-string">&quot;extracting global C symbols from \`$arg'&quot;</span>
	      $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$NM $arg | $global_symbol_pipe &gt;&gt; '$nlist'&quot;</span>
	    <span class="enscript-keyword">done</span>

	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$exclude_expsyms&quot;</span>; <span class="enscript-keyword">then</span>
	      $run <span class="enscript-keyword">eval</span> '$EGREP -v <span class="enscript-string">&quot; ($exclude_expsyms)$&quot;</span> <span class="enscript-string">&quot;$nlist&quot;</span> &gt; <span class="enscript-string">&quot;$nlist&quot;</span>T'
	      $run <span class="enscript-keyword">eval</span> '$mv <span class="enscript-string">&quot;$nlist&quot;</span>T <span class="enscript-string">&quot;$nlist&quot;</span>'
	    <span class="enscript-keyword">fi</span>

	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$export_symbols_regex&quot;</span>; <span class="enscript-keyword">then</span>
	      $run <span class="enscript-keyword">eval</span> '$EGREP -e <span class="enscript-string">&quot;$export_symbols_regex&quot;</span> <span class="enscript-string">&quot;$nlist&quot;</span> &gt; <span class="enscript-string">&quot;$nlist&quot;</span>T'
	      $run <span class="enscript-keyword">eval</span> '$mv <span class="enscript-string">&quot;$nlist&quot;</span>T <span class="enscript-string">&quot;$nlist&quot;</span>'
	    <span class="enscript-keyword">fi</span>

	    <span class="enscript-comment"># Prepare the list of exported symbols
</span>	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$export_symbols&quot;</span>; <span class="enscript-keyword">then</span>
	      export_symbols=<span class="enscript-string">&quot;$output_objdir/$outputname.exp&quot;</span>
	      $run $rm $export_symbols
	      $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;${SED} -n -e '/^: @PROGRAM@ $/d' -e 's/^.* \(.*\)$/\1/p' &quot;</span>'&lt; <span class="enscript-string">&quot;$nlist&quot;</span> &gt; <span class="enscript-string">&quot;$export_symbols&quot;</span>'
              <span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
              *cygwin* | *mingw* )
	        $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;echo EXPORTS &quot;</span>'&gt; <span class="enscript-string">&quot;$output_objdir/$outputname.def&quot;</span>'
		$run <span class="enscript-keyword">eval</span> 'cat <span class="enscript-string">&quot;$export_symbols&quot;</span> &gt;&gt; <span class="enscript-string">&quot;$output_objdir/$outputname.def&quot;</span>'
                ;;
              <span class="enscript-keyword">esac</span>
	    <span class="enscript-keyword">else</span>
	      $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;${SED} -e 's/\([].[*^$]\)/\\\\\1/g' -e 's/^/ /' -e 's/$/$/'&quot;</span>' &lt; <span class="enscript-string">&quot;$export_symbols&quot;</span> &gt; <span class="enscript-string">&quot;$output_objdir/$outputname.exp&quot;</span>'
	      $run <span class="enscript-keyword">eval</span> 'grep -f <span class="enscript-string">&quot;$output_objdir/$outputname.exp&quot;</span> &lt; <span class="enscript-string">&quot;$nlist&quot;</span> &gt; <span class="enscript-string">&quot;$nlist&quot;</span>T'
	      $run <span class="enscript-keyword">eval</span> 'mv <span class="enscript-string">&quot;$nlist&quot;</span>T <span class="enscript-string">&quot;$nlist&quot;</span>'
              <span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
              *cygwin* | *mingw* )
	        $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;echo EXPORTS &quot;</span>'&gt; <span class="enscript-string">&quot;$output_objdir/$outputname.def&quot;</span>'
		$run <span class="enscript-keyword">eval</span> 'cat <span class="enscript-string">&quot;$nlist&quot;</span> &gt;&gt; <span class="enscript-string">&quot;$output_objdir/$outputname.def&quot;</span>'
                ;;
              <span class="enscript-keyword">esac</span>
	    <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">fi</span>

	  <span class="enscript-keyword">for</span> arg <span class="enscript-keyword">in</span> $dlprefiles; <span class="enscript-keyword">do</span>
	    $show <span class="enscript-string">&quot;extracting global C symbols from \`$arg'&quot;</span>
	    name=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$arg&quot;</span> | ${SED} -e 's%^.*/%%'`
	    $run <span class="enscript-keyword">eval</span> '$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;: $name &quot;</span> &gt;&gt; <span class="enscript-string">&quot;$nlist&quot;</span>'
	    $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$NM $arg | $global_symbol_pipe &gt;&gt; '$nlist'&quot;</span>
	  <span class="enscript-keyword">done</span>

	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span>; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># Make sure we have at least an empty file.
</span>	    <span class="enscript-keyword">test</span> -f <span class="enscript-string">&quot;$nlist&quot;</span> || : &gt; <span class="enscript-string">&quot;$nlist&quot;</span>

	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$exclude_expsyms&quot;</span>; <span class="enscript-keyword">then</span>
	      $EGREP -v <span class="enscript-string">&quot; ($exclude_expsyms)$&quot;</span> <span class="enscript-string">&quot;$nlist&quot;</span> &gt; <span class="enscript-string">&quot;$nlist&quot;</span>T
	      $mv <span class="enscript-string">&quot;$nlist&quot;</span>T <span class="enscript-string">&quot;$nlist&quot;</span>
	    <span class="enscript-keyword">fi</span>

	    <span class="enscript-comment"># Try sorting and uniquifying the output.
</span>	    <span class="enscript-keyword">if</span> grep -v <span class="enscript-string">&quot;^: &quot;</span> &lt; <span class="enscript-string">&quot;$nlist&quot;</span> |
		<span class="enscript-keyword">if</span> sort -k 3 &lt;/dev/null &gt;/dev/null 2&gt;&amp;1; <span class="enscript-keyword">then</span>
		  sort -k 3
		<span class="enscript-keyword">else</span>
		  sort +2
		<span class="enscript-keyword">fi</span> |
		uniq &gt; <span class="enscript-string">&quot;$nlist&quot;</span>S; <span class="enscript-keyword">then</span>
	      :
	    <span class="enscript-keyword">else</span>
	      grep -v <span class="enscript-string">&quot;^: &quot;</span> &lt; <span class="enscript-string">&quot;$nlist&quot;</span> &gt; <span class="enscript-string">&quot;$nlist&quot;</span>S
	    <span class="enscript-keyword">fi</span>

	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -f <span class="enscript-string">&quot;$nlist&quot;</span>S; <span class="enscript-keyword">then</span>
	      <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$global_symbol_to_cdecl&quot;</span>' &lt; <span class="enscript-string">&quot;$nlist&quot;</span>S &gt;&gt; <span class="enscript-string">&quot;$output_objdir/$dlsyms&quot;</span>'
	    <span class="enscript-keyword">else</span>
	      $<span class="enscript-keyword">echo</span> '/* NONE */' &gt;&gt; <span class="enscript-string">&quot;$output_objdir/$dlsyms&quot;</span>
	    <span class="enscript-keyword">fi</span>

	    $<span class="enscript-keyword">echo</span> &gt;&gt; <span class="enscript-string">&quot;$output_objdir/$dlsyms&quot;</span> <span class="enscript-string">&quot;\

#undef lt_preloaded_symbols

#if defined (__STDC__) &amp;&amp; __STDC__
# define lt_ptr void *
#else
# define lt_ptr char *
# define const
#endif

/* The mapping between symbol names and symbols. */
&quot;</span>

	    <span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
	    *cygwin* | *mingw* )
	  $<span class="enscript-keyword">echo</span> &gt;&gt; <span class="enscript-string">&quot;$output_objdir/$dlsyms&quot;</span> <span class="enscript-string">&quot;\
/* DATA imports from DLLs on WIN32 can't be const, because
   runtime relocations are performed -- see ld's documentation
   on pseudo-relocs */
struct {
&quot;</span>
	      ;;
	    * )
	  $<span class="enscript-keyword">echo</span> &gt;&gt; <span class="enscript-string">&quot;$output_objdir/$dlsyms&quot;</span> <span class="enscript-string">&quot;\
const struct {
&quot;</span>
	      ;;
	    <span class="enscript-keyword">esac</span>


	  $<span class="enscript-keyword">echo</span> &gt;&gt; <span class="enscript-string">&quot;$output_objdir/$dlsyms&quot;</span> <span class="enscript-string">&quot;\
  const char *name;
  lt_ptr address;
}
lt_preloaded_symbols[] =
{\
&quot;</span>

	    <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$global_symbol_to_c_name_address&quot;</span> &lt; <span class="enscript-string">&quot;$nlist&quot;</span> &gt;&gt; <span class="enscript-string">&quot;$output_objdir/$dlsyms&quot;</span>

	    $<span class="enscript-keyword">echo</span> &gt;&gt; <span class="enscript-string">&quot;$output_objdir/$dlsyms&quot;</span> <span class="enscript-string">&quot;\
  {0, (lt_ptr) 0}
};

/* This works around a problem in FreeBSD linker */
#ifdef FREEBSD_WORKAROUND
static const void *lt_preloaded_setup() {
  return lt_preloaded_symbols;
}
#endif

#ifdef __cplusplus
}
#endif\
&quot;</span>
	  <span class="enscript-keyword">fi</span>

	  pic_flag_for_symtable=
	  <span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
	  <span class="enscript-comment"># compiling the symbol table file with pic_flag works around
</span>	  <span class="enscript-comment"># a FreeBSD bug that causes programs to crash when -lm is
</span>	  <span class="enscript-comment"># linked before any other PIC object.  But we must not use
</span>	  <span class="enscript-comment"># pic_flag when linking with -static.  The problem exists in
</span>	  <span class="enscript-comment"># FreeBSD 2.2.6 and is fixed in FreeBSD 3.1.
</span>	  *-*-freebsd2*|*-*-freebsd3.0*|*-*-freebsdelf3.0*)
	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$compile_command &quot;</span> <span class="enscript-keyword">in</span>
	    *<span class="enscript-string">&quot; -static &quot;</span>*) ;;
	    *) pic_flag_for_symtable=<span class="enscript-string">&quot; $pic_flag -DFREEBSD_WORKAROUND&quot;</span>;;
	    <span class="enscript-keyword">esac</span>;;
	  *-*-hpux*)
	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$compile_command &quot;</span> <span class="enscript-keyword">in</span>
	    *<span class="enscript-string">&quot; -static &quot;</span>*) ;;
	    *) pic_flag_for_symtable=<span class="enscript-string">&quot; $pic_flag&quot;</span>;;
	    <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">esac</span>

	  <span class="enscript-comment"># Now compile the dynamic symbol file.
</span>	  $show <span class="enscript-string">&quot;(cd $output_objdir &amp;&amp; $LTCC  $LTCFLAGS -c$no_builtin_flag$pic_flag_for_symtable \&quot;$dlsyms\&quot;)&quot;</span>
	  $run <span class="enscript-keyword">eval</span> '(<span class="enscript-keyword">cd</span> $output_objdir &amp;&amp; $LTCC  $LTCFLAGS -c$no_builtin_flag$pic_flag_for_symtable <span class="enscript-string">&quot;$dlsyms&quot;</span>)' || <span class="enscript-keyword">exit</span> $?

	  <span class="enscript-comment"># Clean up the generated files.
</span>	  $show <span class="enscript-string">&quot;$rm $output_objdir/$dlsyms $nlist ${nlist}S ${nlist}T&quot;</span>
	  $run $rm <span class="enscript-string">&quot;$output_objdir/$dlsyms&quot;</span> <span class="enscript-string">&quot;$nlist&quot;</span> <span class="enscript-string">&quot;${nlist}S&quot;</span> <span class="enscript-string">&quot;${nlist}T&quot;</span>

	  <span class="enscript-comment"># Transform the symbol file into the correct name.
</span>          <span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
          *cygwin* | *mingw* )
            <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -f <span class="enscript-string">&quot;$output_objdir/${outputname}.def&quot;</span> ; <span class="enscript-keyword">then</span>
              compile_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$compile_command&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s%@SYMFILE@%$output_objdir/${outputname}.def $output_objdir/${outputname}S.${objext}%&quot;</span>`
              finalize_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$finalize_command&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s%@SYMFILE@%$output_objdir/${outputname}.def $output_objdir/${outputname}S.${objext}%&quot;</span>`
            <span class="enscript-keyword">else</span>
              compile_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$compile_command&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%&quot;</span>`
              finalize_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$finalize_command&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%&quot;</span>`
             <span class="enscript-keyword">fi</span>
            ;;
          * )
            compile_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$compile_command&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%&quot;</span>`
            finalize_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$finalize_command&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%&quot;</span>`
            ;;
          <span class="enscript-keyword">esac</span>
	  ;;
	*)
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: unknown suffix for \`$dlsyms'&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  ;;
	<span class="enscript-keyword">esac</span>
      <span class="enscript-keyword">else</span>
	<span class="enscript-comment"># We keep going just in case the user didn't refer to
</span>	<span class="enscript-comment"># lt_preloaded_symbols.  The linker will fail if global_symbol_pipe
</span>	<span class="enscript-comment"># really was required.
</span>
	<span class="enscript-comment"># Nullify the symbol file.
</span>	compile_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$compile_command&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s% @SYMFILE@%%&quot;</span>`
	finalize_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$finalize_command&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s% @SYMFILE@%%&quot;</span>`
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$need_relink&quot;</span> = no || <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> != yes; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># Replace the output file specification.
</span>	compile_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$compile_command&quot;</span> | $Xsed -e 's%@OUTPUT@%'<span class="enscript-string">&quot;$output&quot;</span>'%g'`
	link_command=<span class="enscript-string">&quot;$compile_command$compile_rpath&quot;</span>

	<span class="enscript-comment"># We have no uninstalled library dependencies, so finalize right now.
</span>	$show <span class="enscript-string">&quot;$link_command&quot;</span>
	$run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$link_command&quot;</span>
	exit_status=$?

	<span class="enscript-comment"># Delete the generated files.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$dlsyms&quot;</span>; <span class="enscript-keyword">then</span>
	  $show <span class="enscript-string">&quot;$rm $output_objdir/${outputname}S.${objext}&quot;</span>
	  $run $rm <span class="enscript-string">&quot;$output_objdir/${outputname}S.${objext}&quot;</span>
	<span class="enscript-keyword">fi</span>

	<span class="enscript-keyword">exit</span> $exit_status
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$shlibpath_var&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># We should set the shlibpath_var
</span>	rpath=
	<span class="enscript-keyword">for</span> dir <span class="enscript-keyword">in</span> $temp_rpath; <span class="enscript-keyword">do</span>
	  <span class="enscript-keyword">case</span> $dir <span class="enscript-keyword">in</span>
	  [\\/]* | [A-Za-z]:[\\/]*)
	    <span class="enscript-comment"># Absolute path.
</span>	    rpath=<span class="enscript-string">&quot;$rpath$dir:&quot;</span>
	    ;;
	  *)
	    <span class="enscript-comment"># Relative path: add a thisdir entry.
</span>	    rpath=<span class="enscript-string">&quot;$rpath\$thisdir/$dir:&quot;</span>
	    ;;
	  <span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">done</span>
	temp_rpath=<span class="enscript-string">&quot;$rpath&quot;</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$compile_shlibpath$finalize_shlibpath&quot;</span>; <span class="enscript-keyword">then</span>
	compile_command=<span class="enscript-string">&quot;$shlibpath_var=\&quot;$compile_shlibpath$finalize_shlibpath\$$shlibpath_var\&quot; $compile_command&quot;</span>
      <span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$finalize_shlibpath&quot;</span>; <span class="enscript-keyword">then</span>
	finalize_command=<span class="enscript-string">&quot;$shlibpath_var=\&quot;$finalize_shlibpath\$$shlibpath_var\&quot; $finalize_command&quot;</span>
      <span class="enscript-keyword">fi</span>

      compile_var=
      finalize_var=
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$runpath_var&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$perm_rpath&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-comment"># We should set the runpath_var.
</span>	  rpath=
	  <span class="enscript-keyword">for</span> dir <span class="enscript-keyword">in</span> $perm_rpath; <span class="enscript-keyword">do</span>
	    rpath=<span class="enscript-string">&quot;$rpath$dir:&quot;</span>
	  <span class="enscript-keyword">done</span>
	  compile_var=<span class="enscript-string">&quot;$runpath_var=\&quot;$rpath\$$runpath_var\&quot; &quot;</span>
	<span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$finalize_perm_rpath&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-comment"># We should set the runpath_var.
</span>	  rpath=
	  <span class="enscript-keyword">for</span> dir <span class="enscript-keyword">in</span> $finalize_perm_rpath; <span class="enscript-keyword">do</span>
	    rpath=<span class="enscript-string">&quot;$rpath$dir:&quot;</span>
	  <span class="enscript-keyword">done</span>
	  finalize_var=<span class="enscript-string">&quot;$runpath_var=\&quot;$rpath\$$runpath_var\&quot; &quot;</span>
	<span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$no_install&quot;</span> = yes; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># We don't need to create a wrapper script.
</span>	link_command=<span class="enscript-string">&quot;$compile_var$compile_command$compile_rpath&quot;</span>
	<span class="enscript-comment"># Replace the output file specification.
</span>	link_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$link_command&quot;</span> | $Xsed -e 's%@OUTPUT@%'<span class="enscript-string">&quot;$output&quot;</span>'%g'`
	<span class="enscript-comment"># Delete the old output file.
</span>	$run $rm $output
	<span class="enscript-comment"># Link the executable and exit
</span>	$show <span class="enscript-string">&quot;$link_command&quot;</span>
	$run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$link_command&quot;</span> || <span class="enscript-keyword">exit</span> $?
	<span class="enscript-keyword">exit</span> $EXIT_SUCCESS
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$hardcode_action&quot;</span> = relink; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># Fast installation is not supported
</span>	link_command=<span class="enscript-string">&quot;$compile_var$compile_command$compile_rpath&quot;</span>
	relink_command=<span class="enscript-string">&quot;$finalize_var$finalize_command$finalize_rpath&quot;</span>

	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: this platform does not like uninstalled shared libraries&quot;</span> 1&gt;&amp;2
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$output' will be relinked during installation&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">else</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$fast_install&quot;</span> != no; <span class="enscript-keyword">then</span>
	  link_command=<span class="enscript-string">&quot;$finalize_var$compile_command$finalize_rpath&quot;</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$fast_install&quot;</span> = yes; <span class="enscript-keyword">then</span>
	    relink_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$compile_var$compile_command$compile_rpath&quot;</span> | $Xsed -e 's%@OUTPUT@%\$progdir/\$file%g'`
	  <span class="enscript-keyword">else</span>
	    <span class="enscript-comment"># fast_install is set to needless
</span>	    relink_command=
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">else</span>
	  link_command=<span class="enscript-string">&quot;$compile_var$compile_command$compile_rpath&quot;</span>
	  relink_command=<span class="enscript-string">&quot;$finalize_var$finalize_command$finalize_rpath&quot;</span>
	<span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Replace the output file specification.
</span>      link_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$link_command&quot;</span> | $Xsed -e 's%@OUTPUT@%'<span class="enscript-string">&quot;$output_objdir/$outputname&quot;</span>'%g'`

      <span class="enscript-comment"># Delete the old output files.
</span>      $run $rm $output $output_objdir/$outputname $output_objdir/lt-$outputname

      $show <span class="enscript-string">&quot;$link_command&quot;</span>
      $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$link_command&quot;</span> || <span class="enscript-keyword">exit</span> $?

      <span class="enscript-comment"># Now create the wrapper script.
</span>      $show <span class="enscript-string">&quot;creating $output&quot;</span>

      <span class="enscript-comment"># Quote the relink command for shipping.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$relink_command&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># Preserve any variables that may affect compiler behavior
</span>	<span class="enscript-keyword">for</span> var <span class="enscript-keyword">in</span> $variables_saved_for_relink; <span class="enscript-keyword">do</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">eval</span> <span class="enscript-keyword">test</span> -z \<span class="enscript-string">&quot;\${$var+set}\&quot;; then
	    relink_command=&quot;</span>{ <span class="enscript-keyword">test</span> -z \<span class="enscript-string">&quot;\${$var+set}\&quot; || unset $var || { $var=; export $var; }; }; $relink_command&quot;</span>
	  elif <span class="enscript-keyword">eval</span> var_value=\$$var; <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$var_value&quot;</span>; <span class="enscript-keyword">then</span>
	    relink_command=<span class="enscript-string">&quot;$var=; export $var; $relink_command&quot;</span>
	  <span class="enscript-keyword">else</span>
	    var_value=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$var_value&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
	    relink_command=<span class="enscript-string">&quot;$var=\&quot;$var_value\&quot;; export $var; $relink_command&quot;</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">done</span>
	relink_command=<span class="enscript-string">&quot;(cd `pwd`; $relink_command)&quot;</span>
	relink_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$relink_command&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Quote $echo for shipping.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$echo&quot;</span> = <span class="enscript-string">&quot;X$SHELL $progpath --fallback-echo&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">case</span> $progpath <span class="enscript-keyword">in</span>
	[\\/]* | [A-Za-z]:[\\/]*) qecho=<span class="enscript-string">&quot;$SHELL $progpath --fallback-echo&quot;</span>;;
	*) qecho=<span class="enscript-string">&quot;$SHELL `pwd`/$progpath --fallback-echo&quot;</span>;;
	<span class="enscript-keyword">esac</span>
	qecho=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$qecho&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
      <span class="enscript-keyword">else</span>
	qecho=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$echo&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Only actually do things if our run command is non-null.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># win32 will think the script is a binary if it has
</span>	<span class="enscript-comment"># a .exe suffix, so we strip it off here.
</span>	<span class="enscript-keyword">case</span> $output <span class="enscript-keyword">in</span>
	  *.exe) output=`$<span class="enscript-keyword">echo</span> $output|${SED} 's,.exe$,,'` ;;
	<span class="enscript-keyword">esac</span>
	<span class="enscript-comment"># test for cygwin because mv fails w/o .exe extensions
</span>	<span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
	  *cygwin*)
	    exeext=.exe
	    outputname=`$<span class="enscript-keyword">echo</span> $outputname|${SED} 's,.exe$,,'` ;;
	  *) exeext= ;;
	<span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
	  *cygwin* | *mingw* )
            output_name=`basename $output`
            output_path=`dirname $output`
            cwrappersource=<span class="enscript-string">&quot;$output_path/$objdir/lt-$output_name.c&quot;</span>
            cwrapper=<span class="enscript-string">&quot;$output_path/$output_name.exe&quot;</span>
            $rm $cwrappersource $cwrapper
            <span class="enscript-keyword">trap</span> <span class="enscript-string">&quot;$rm $cwrappersource $cwrapper; exit $EXIT_FAILURE&quot;</span> 1 2 15

	    cat &gt; $cwrappersource &lt;&lt;EOF

/* $cwrappersource - temporary wrapper executable <span class="enscript-keyword">for</span> $objdir/$outputname
   Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP

   The $output program cannot be directly executed until all the libtool
   libraries that it depends on are installed.

   This wrapper executable should never be moved out of the build directory.
   If it is, it will not operate correctly.

   Currently, it simply execs the wrapper *script* <span class="enscript-string">&quot;/bin/sh $output&quot;</span>,
   but could eventually absorb all of the scripts functionality and
   <span class="enscript-keyword">exec</span> $objdir/$outputname directly.
*/
EOF
	    cat &gt;&gt; $cwrappersource&lt;&lt;<span class="enscript-string">&quot;EOF&quot;</span>
<span class="enscript-comment">#include &lt;stdio.h&gt;
</span><span class="enscript-comment">#include &lt;stdlib.h&gt;
</span><span class="enscript-comment">#include &lt;unistd.h&gt;
</span><span class="enscript-comment">#include &lt;malloc.h&gt;
</span><span class="enscript-comment">#include &lt;stdarg.h&gt;
</span><span class="enscript-comment">#include &lt;assert.h&gt;
</span><span class="enscript-comment">#include &lt;string.h&gt;
</span><span class="enscript-comment">#include &lt;ctype.h&gt;
</span><span class="enscript-comment">#include &lt;sys/stat.h&gt;
</span>
<span class="enscript-comment">#if defined(PATH_MAX)
</span><span class="enscript-comment"># define LT_PATHMAX PATH_MAX
</span><span class="enscript-comment">#elif defined(MAXPATHLEN)
</span><span class="enscript-comment"># define LT_PATHMAX MAXPATHLEN
</span><span class="enscript-comment">#else
</span><span class="enscript-comment"># define LT_PATHMAX 1024
</span><span class="enscript-comment">#endif
</span>
<span class="enscript-comment">#ifndef DIR_SEPARATOR
</span><span class="enscript-comment"># define DIR_SEPARATOR '/'
</span><span class="enscript-comment"># define PATH_SEPARATOR ':'
</span><span class="enscript-comment">#endif
</span>
<span class="enscript-comment">#if defined (_WIN32) || defined (__MSDOS__) || defined (__DJGPP__) || \
</span>  defined (__OS2__)
<span class="enscript-comment"># define HAVE_DOS_BASED_FILE_SYSTEM
</span><span class="enscript-comment"># ifndef DIR_SEPARATOR_2
</span><span class="enscript-comment">#  define DIR_SEPARATOR_2 '\\'
</span><span class="enscript-comment"># endif
</span><span class="enscript-comment"># ifndef PATH_SEPARATOR_2
</span><span class="enscript-comment">#  define PATH_SEPARATOR_2 ';'
</span><span class="enscript-comment"># endif
</span><span class="enscript-comment">#endif
</span>
<span class="enscript-comment">#ifndef DIR_SEPARATOR_2
</span><span class="enscript-comment"># define IS_DIR_SEPARATOR(ch) ((ch) == DIR_SEPARATOR)
</span><span class="enscript-comment">#else /* DIR_SEPARATOR_2 */
</span><span class="enscript-comment"># define IS_DIR_SEPARATOR(ch) \
</span>        (((ch) == DIR_SEPARATOR) || ((ch) == DIR_SEPARATOR_2))
<span class="enscript-comment">#endif /* DIR_SEPARATOR_2 */
</span>
<span class="enscript-comment">#ifndef PATH_SEPARATOR_2
</span><span class="enscript-comment"># define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR)
</span><span class="enscript-comment">#else /* PATH_SEPARATOR_2 */
</span><span class="enscript-comment"># define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR_2)
</span><span class="enscript-comment">#endif /* PATH_SEPARATOR_2 */
</span>
<span class="enscript-comment">#define XMALLOC(type, num)      ((type *) xmalloc ((num) * sizeof(type)))
</span><span class="enscript-comment">#define XFREE(stale) do { \
</span>  <span class="enscript-keyword">if</span> (stale) { free ((void *) stale); stale = 0; } \
} <span class="enscript-keyword">while</span> (0)

/* -DDEBUG is fairly common <span class="enscript-keyword">in</span> CFLAGS.  */
<span class="enscript-comment">#undef DEBUG
</span><span class="enscript-comment">#if defined DEBUGWRAPPER
</span><span class="enscript-comment"># define DEBUG(format, ...) fprintf(stderr, format, __VA_ARGS__)
</span><span class="enscript-comment">#else
</span><span class="enscript-comment"># define DEBUG(format, ...)
</span><span class="enscript-comment">#endif
</span>
const char *program_name = NULL;

void * xmalloc (size_t num);
char * xstrdup (const char *string);
const char * base_name (const char *name);
char * find_executable(const char *wrapper);
int    check_executable(const char *path);
char * strendzap(char *str, const char *pat);
void lt_fatal (const char *message, ...);

int
main (int argc, char *argv[])
{
  char **newargz;
  int i;

  program_name = (char *) xstrdup (base_name (argv[0]));
  DEBUG(<span class="enscript-string">&quot;(main) argv[0]      : %s\n&quot;</span>,argv[0]);
  DEBUG(<span class="enscript-string">&quot;(main) program_name : %s\n&quot;</span>,program_name);
  newargz = XMALLOC(char *, argc+2);
EOF

            cat &gt;&gt; $cwrappersource &lt;&lt;EOF
  newargz[0] = (char *) xstrdup(<span class="enscript-string">&quot;$SHELL&quot;</span>);
EOF

            cat &gt;&gt; $cwrappersource &lt;&lt;<span class="enscript-string">&quot;EOF&quot;</span>
  newargz[1] = find_executable(argv[0]);
  <span class="enscript-keyword">if</span> (newargz[1] == NULL)
    lt_fatal(<span class="enscript-string">&quot;Couldn't find %s&quot;</span>, argv[0]);
  DEBUG(<span class="enscript-string">&quot;(main) found exe at : %s\n&quot;</span>,newargz[1]);
  /* we know the script has the same name, without the .exe */
  /* so make sure newargz[1] doesn't end <span class="enscript-keyword">in</span> .exe */
  strendzap(newargz[1],<span class="enscript-string">&quot;.exe&quot;</span>);
  <span class="enscript-keyword">for</span> (i = 1; i &lt; argc; i++)
    newargz[i+1] = xstrdup(argv[i]);
  newargz[argc+1] = NULL;

  <span class="enscript-keyword">for</span> (i=0; i&lt;argc+1; i++)
  {
    DEBUG(<span class="enscript-string">&quot;(main) newargz[%d]   : %s\n&quot;</span>,i,newargz[i]);
    ;
  }

EOF

            <span class="enscript-keyword">case</span> $host_os <span class="enscript-keyword">in</span>
              mingw*)
                cat &gt;&gt; $cwrappersource &lt;&lt;EOF
  execv(<span class="enscript-string">&quot;$SHELL&quot;</span>,(char const **)newargz);
EOF
              ;;
              *)
                cat &gt;&gt; $cwrappersource &lt;&lt;EOF
  execv(<span class="enscript-string">&quot;$SHELL&quot;</span>,newargz);
EOF
              ;;
            <span class="enscript-keyword">esac</span>

            cat &gt;&gt; $cwrappersource &lt;&lt;<span class="enscript-string">&quot;EOF&quot;</span>
  <span class="enscript-keyword">return</span> 127;
}

void *
xmalloc (size_t num)
{
  void * p = (void *) malloc (num);
  <span class="enscript-keyword">if</span> (!p)
    lt_fatal (<span class="enscript-string">&quot;Memory exhausted&quot;</span>);

  <span class="enscript-keyword">return</span> p;
}

char *
xstrdup (const char *string)
{
  <span class="enscript-keyword">return</span> string ? strcpy ((char *) xmalloc (strlen (string) + 1), string) : NULL
;
}

const char *
base_name (const char *name)
{
  const char *base;

<span class="enscript-comment">#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
</span>  /* Skip over the disk name <span class="enscript-keyword">in</span> MSDOS pathnames. */
  <span class="enscript-keyword">if</span> (isalpha ((unsigned char)name[0]) &amp;&amp; name[1] == ':')
    name += 2;
<span class="enscript-comment">#endif
</span>
  <span class="enscript-keyword">for</span> (base = name; *name; name++)
    <span class="enscript-keyword">if</span> (IS_DIR_SEPARATOR (*name))
      base = name + 1;
  <span class="enscript-keyword">return</span> base;
}

int
check_executable(const char * path)
{
  struct stat st;

  DEBUG(<span class="enscript-string">&quot;(check_executable)  : %s\n&quot;</span>, path ? (*path ? path : <span class="enscript-string">&quot;EMPTY!&quot;</span>) : <span class="enscript-string">&quot;NULL!&quot;</span>);
  <span class="enscript-keyword">if</span> ((!path) || (!*path))
    <span class="enscript-keyword">return</span> 0;

  <span class="enscript-keyword">if</span> ((stat (path, &amp;st) &gt;= 0) &amp;&amp;
      (
        /* MinGW &amp; native WIN32 <span class="enscript-keyword">do</span> not support S_IXOTH or S_IXGRP */
<span class="enscript-comment">#if defined (S_IXOTH)
</span>       ((st.st_mode &amp; S_IXOTH) == S_IXOTH) ||
<span class="enscript-comment">#endif
</span><span class="enscript-comment">#if defined (S_IXGRP)
</span>       ((st.st_mode &amp; S_IXGRP) == S_IXGRP) ||
<span class="enscript-comment">#endif
</span>       ((st.st_mode &amp; S_IXUSR) == S_IXUSR))
      )
    <span class="enscript-keyword">return</span> 1;
  <span class="enscript-keyword">else</span>
    <span class="enscript-keyword">return</span> 0;
}

/* Searches <span class="enscript-keyword">for</span> the full path of the wrapper.  Returns
   newly allocated full path name <span class="enscript-keyword">if</span> found, NULL otherwise */
char *
find_executable (const char* wrapper)
{
  int has_slash = 0;
  const char* p;
  const char* p_next;
  /* static buffer <span class="enscript-keyword">for</span> getcwd */
  char tmp[LT_PATHMAX + 1];
  int tmp_len;
  char* concat_name;

  DEBUG(<span class="enscript-string">&quot;(find_executable)  : %s\n&quot;</span>, wrapper ? (*wrapper ? wrapper : <span class="enscript-string">&quot;EMPTY!&quot;</span>) : <span class="enscript-string">&quot;NULL!&quot;</span>);

  <span class="enscript-keyword">if</span> ((wrapper == NULL) || (*wrapper == '\0'))
    <span class="enscript-keyword">return</span> NULL;

  /* Absolute path? */
<span class="enscript-comment">#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
</span>  <span class="enscript-keyword">if</span> (isalpha ((unsigned char)wrapper[0]) &amp;&amp; wrapper[1] == ':')
  {
    concat_name = xstrdup (wrapper);
    <span class="enscript-keyword">if</span> (check_executable(concat_name))
      <span class="enscript-keyword">return</span> concat_name;
    XFREE(concat_name);
  }
  <span class="enscript-keyword">else</span>
  {
<span class="enscript-comment">#endif
</span>    <span class="enscript-keyword">if</span> (IS_DIR_SEPARATOR (wrapper[0]))
    {
      concat_name = xstrdup (wrapper);
      <span class="enscript-keyword">if</span> (check_executable(concat_name))
        <span class="enscript-keyword">return</span> concat_name;
      XFREE(concat_name);
    }
<span class="enscript-comment">#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
</span>  }
<span class="enscript-comment">#endif
</span>
  <span class="enscript-keyword">for</span> (p = wrapper; *p; p++)
    <span class="enscript-keyword">if</span> (*p == '/')
    {
      has_slash = 1;
      <span class="enscript-keyword">break</span>;
    }
  <span class="enscript-keyword">if</span> (!has_slash)
  {
    /* no slashes; search <span class="enscript-keyword">PATH</span> */
    const char* path = getenv (<span class="enscript-string">&quot;PATH&quot;</span>);
    <span class="enscript-keyword">if</span> (path != NULL)
    {
      <span class="enscript-keyword">for</span> (p = path; *p; p = p_next)
      {
        const char* q;
        size_t p_len;
        <span class="enscript-keyword">for</span> (q = p; *q; q++)
          <span class="enscript-keyword">if</span> (IS_PATH_SEPARATOR(*q))
            <span class="enscript-keyword">break</span>;
        p_len = q - p;
        p_next = (*q == '\0' ? q : q + 1);
        <span class="enscript-keyword">if</span> (p_len == 0)
        {
          /* empty path: current directory */
          <span class="enscript-keyword">if</span> (getcwd (tmp, LT_PATHMAX) == NULL)
            lt_fatal (<span class="enscript-string">&quot;getcwd failed&quot;</span>);
          tmp_len = strlen(tmp);
          concat_name = XMALLOC(char, tmp_len + 1 + strlen(wrapper) + 1);
          memcpy (concat_name, tmp, tmp_len);
          concat_name[tmp_len] = '/';
          strcpy (concat_name + tmp_len + 1, wrapper);
        }
        <span class="enscript-keyword">else</span>
        {
          concat_name = XMALLOC(char, p_len + 1 + strlen(wrapper) + 1);
          memcpy (concat_name, p, p_len);
          concat_name[p_len] = '/';
          strcpy (concat_name + p_len + 1, wrapper);
        }
        <span class="enscript-keyword">if</span> (check_executable(concat_name))
          <span class="enscript-keyword">return</span> concat_name;
        XFREE(concat_name);
      }
    }
    /* not found <span class="enscript-keyword">in</span> <span class="enscript-keyword">PATH</span>; assume curdir */
  }
  /* Relative path | not found <span class="enscript-keyword">in</span> path: prepend cwd */
  <span class="enscript-keyword">if</span> (getcwd (tmp, LT_PATHMAX) == NULL)
    lt_fatal (<span class="enscript-string">&quot;getcwd failed&quot;</span>);
  tmp_len = strlen(tmp);
  concat_name = XMALLOC(char, tmp_len + 1 + strlen(wrapper) + 1);
  memcpy (concat_name, tmp, tmp_len);
  concat_name[tmp_len] = '/';
  strcpy (concat_name + tmp_len + 1, wrapper);

  <span class="enscript-keyword">if</span> (check_executable(concat_name))
    <span class="enscript-keyword">return</span> concat_name;
  XFREE(concat_name);
  <span class="enscript-keyword">return</span> NULL;
}

char *
strendzap(char *str, const char *pat)
{
  size_t len, patlen;

  assert(str != NULL);
  assert(pat != NULL);

  len = strlen(str);
  patlen = strlen(pat);

  <span class="enscript-keyword">if</span> (patlen &lt;= len)
  {
    str += len - patlen;
    <span class="enscript-keyword">if</span> (strcmp(str, pat) == 0)
      *str = '\0';
  }
  <span class="enscript-keyword">return</span> str;
}

static void
lt_error_core (int exit_status, const char * mode,
          const char * message, va_list ap)
{
  fprintf (stderr, <span class="enscript-string">&quot;%s: %s: &quot;</span>, program_name, mode);
  vfprintf (stderr, message, ap);
  fprintf (stderr, <span class="enscript-string">&quot;.\n&quot;</span>);

  <span class="enscript-keyword">if</span> (exit_status &gt;= 0)
    <span class="enscript-keyword">exit</span> (exit_status);
}

void
lt_fatal (const char *message, ...)
{
  va_list ap;
  va_start (ap, message);
  lt_error_core (EXIT_FAILURE, <span class="enscript-string">&quot;FATAL&quot;</span>, message, ap);
  va_end (ap);
}
EOF
          <span class="enscript-comment"># we should really use a build-platform specific compiler
</span>          <span class="enscript-comment"># here, but OTOH, the wrappers (shell script and this C one)
</span>          <span class="enscript-comment"># are only useful if you want to execute the &quot;real&quot; binary.
</span>          <span class="enscript-comment"># Since the &quot;real&quot; binary is built for $host, then this
</span>          <span class="enscript-comment"># wrapper might as well be built for $host, too.
</span>          $run $LTCC $LTCFLAGS -s -o $cwrapper $cwrappersource
          ;;
        <span class="enscript-keyword">esac</span>
        $rm $output
        <span class="enscript-keyword">trap</span> <span class="enscript-string">&quot;$rm $output; exit $EXIT_FAILURE&quot;</span> 1 2 15

	$<span class="enscript-keyword">echo</span> &gt; $output <span class="enscript-string">&quot;\
#! $SHELL

# $output - temporary wrapper script for $objdir/$outputname
# Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP
#
# The $output program cannot be directly executed until all the libtool
# libraries that it depends on are installed.
#
# This wrapper script should never be moved out of the build directory.
# If it is, it will not operate correctly.

# Sed substitution that helps us do robust quoting.  It backslashifies
# metacharacters that are still active within double-quoted strings.
Xsed='${SED} -e 1s/^X//'
sed_quote_subst='$sed_quote_subst'

# The HP-UX ksh and POSIX shell print the target directory to stdout
# if CDPATH is set.
(unset CDPATH) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; unset CDPATH

relink_command=\&quot;$relink_command\&quot;

# This environment variable determines our operation mode.
if test \&quot;\$libtool_install_magic\&quot; = \&quot;$magic\&quot;; then
  # install mode needs the following variable:
  notinst_deplibs='$notinst_deplibs'
else
  # When we are sourced in execute mode, \$file and \$echo are already set.
  if test \&quot;\$libtool_execute_magic\&quot; != \&quot;$magic\&quot;; then
    echo=\&quot;$qecho\&quot;
    file=\&quot;\$0\&quot;
    # Make sure echo works.
    if test \&quot;X\$1\&quot; = X--no-reexec; then
      # Discard the --no-reexec flag, and continue.
      shift
    elif test \&quot;X\`(\$echo '\t') 2&gt;/dev/null\`\&quot; = 'X\t'; then
      # Yippee, \$echo works!
      :
    else
      # Restart under the correct shell, and then maybe \$echo will work.
      exec $SHELL \&quot;\$0\&quot; --no-reexec \${1+\&quot;\$@\&quot;}
    fi
  fi\
&quot;</span>
	$<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\

  # Find the directory that this script lives in.
  thisdir=\`\$echo \&quot;X\$file\&quot; | \$Xsed -e 's%/[^/]*$%%'\`
  test \&quot;x\$thisdir\&quot; = \&quot;x\$file\&quot; &amp;&amp; thisdir=.

  # Follow symbolic links until we get to the real thisdir.
  file=\`ls -ld \&quot;\$file\&quot; | ${SED} -n 's/.*-&gt; //p'\`
  while test -n \&quot;\$file\&quot;; do
    destdir=\`\$echo \&quot;X\$file\&quot; | \$Xsed -e 's%/[^/]*\$%%'\`

    # If there was a directory component, then change thisdir.
    if test \&quot;x\$destdir\&quot; != \&quot;x\$file\&quot;; then
      case \&quot;\$destdir\&quot; in
      [\\\\/]* | [A-Za-z]:[\\\\/]*) thisdir=\&quot;\$destdir\&quot; ;;
      *) thisdir=\&quot;\$thisdir/\$destdir\&quot; ;;
      esac
    fi

    file=\`\$echo \&quot;X\$file\&quot; | \$Xsed -e 's%^.*/%%'\`
    file=\`ls -ld \&quot;\$thisdir/\$file\&quot; | ${SED} -n 's/.*-&gt; //p'\`
  done

  # Try to get the absolute directory name.
  absdir=\`cd \&quot;\$thisdir\&quot; &amp;&amp; pwd\`
  test -n \&quot;\$absdir\&quot; &amp;&amp; thisdir=\&quot;\$absdir\&quot;
&quot;</span>

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$fast_install&quot;</span> = yes; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\
  program=lt-'$outputname'$exeext
  progdir=\&quot;\$thisdir/$objdir\&quot;

  if test ! -f \&quot;\$progdir/\$program\&quot; || \\
     { file=\`ls -1dt \&quot;\$progdir/\$program\&quot; \&quot;\$progdir/../\$program\&quot; 2&gt;/dev/null | ${SED} 1q\`; \\
       test \&quot;X\$file\&quot; != \&quot;X\$progdir/\$program\&quot;; }; then

    file=\&quot;\$\$-\$program\&quot;

    if test ! -d \&quot;\$progdir\&quot;; then
      $mkdir \&quot;\$progdir\&quot;
    else
      $rm \&quot;\$progdir/\$file\&quot;
    fi&quot;</span>

	  $<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\

    # relink executable if necessary
    if test -n \&quot;\$relink_command\&quot;; then
      if relink_command_output=\`eval \$relink_command 2&gt;&amp;1\`; then :
      else
	$echo \&quot;\$relink_command_output\&quot; &gt;&amp;2
	$rm \&quot;\$progdir/\$file\&quot;
	exit $EXIT_FAILURE
      fi
    fi

    $mv \&quot;\$progdir/\$file\&quot; \&quot;\$progdir/\$program\&quot; 2&gt;/dev/null ||
    { $rm \&quot;\$progdir/\$program\&quot;;
      $mv \&quot;\$progdir/\$file\&quot; \&quot;\$progdir/\$program\&quot;; }
    $rm \&quot;\$progdir/\$file\&quot;
  fi&quot;</span>
	<span class="enscript-keyword">else</span>
	  $<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\
  program='$outputname'
  progdir=\&quot;\$thisdir/$objdir\&quot;
&quot;</span>
	<span class="enscript-keyword">fi</span>

	$<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\

  if test -f \&quot;\$progdir/\$program\&quot;; then&quot;</span>

	<span class="enscript-comment"># Export our shlibpath_var if we have one.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$shlibpath_overrides_runpath&quot;</span> = yes &amp;&amp; <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$shlibpath_var&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$temp_rpath&quot;</span>; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\
    # Add our own library path to $shlibpath_var
    $shlibpath_var=\&quot;$temp_rpath\$$shlibpath_var\&quot;

    # Some systems cannot cope with colon-terminated $shlibpath_var
    # The second colon is a workaround for a bug in BeOS R4 sed
    $shlibpath_var=\`\$echo \&quot;X\$$shlibpath_var\&quot; | \$Xsed -e 's/::*\$//'\`

    export $shlibpath_var
&quot;</span>
	<span class="enscript-keyword">fi</span>

	<span class="enscript-comment"># fixup the dll searchpath if we need to.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$dllsearchpath&quot;</span>; <span class="enscript-keyword">then</span>
	  $<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\
    # Add the dll search path components to the executable PATH
    PATH=$dllsearchpath:\$PATH
&quot;</span>
	<span class="enscript-keyword">fi</span>

	$<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\
    if test \&quot;\$libtool_execute_magic\&quot; != \&quot;$magic\&quot;; then
      # Run the actual program with our arguments.
&quot;</span>
	<span class="enscript-keyword">case</span> $host <span class="enscript-keyword">in</span>
	<span class="enscript-comment"># Backslashes separate directories on plain windows
</span>	*-*-mingw | *-*-os2*)
	  $<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\
      exec \&quot;\$progdir\\\\\$program\&quot; \${1+\&quot;\$@\&quot;}
&quot;</span>
	  ;;

	*)
	  $<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\
      exec \&quot;\$progdir/\$program\&quot; \${1+\&quot;\$@\&quot;}
&quot;</span>
	  ;;
	<span class="enscript-keyword">esac</span>
	$<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\
      \$echo \&quot;\$0: cannot exec \$program \${1+\&quot;\$@\&quot;}\&quot;
      exit $EXIT_FAILURE
    fi
  else
    # The program doesn't exist.
    \$echo \&quot;\$0: error: \\\`\$progdir/\$program' does not exist\&quot; 1&gt;&amp;2
    \$echo \&quot;This script is just a wrapper for \$program.\&quot; 1&gt;&amp;2
    $echo \&quot;See the $PACKAGE documentation for more information.\&quot; 1&gt;&amp;2
    exit $EXIT_FAILURE
  fi
fi\
&quot;</span>
	chmod +x $output
      <span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">exit</span> $EXIT_SUCCESS
      ;;
    <span class="enscript-keyword">esac</span>

    <span class="enscript-comment"># See if we need to build an old-fashioned archive.
</span>    <span class="enscript-keyword">for</span> oldlib <span class="enscript-keyword">in</span> $oldlibs; <span class="enscript-keyword">do</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = convenience; <span class="enscript-keyword">then</span>
	oldobjs=<span class="enscript-string">&quot;$libobjs_save&quot;</span>
	addlibs=<span class="enscript-string">&quot;$convenience&quot;</span>
	build_libtool_libs=no
      <span class="enscript-keyword">else</span>
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = module; <span class="enscript-keyword">then</span>
	  oldobjs=<span class="enscript-string">&quot;$libobjs_save&quot;</span>
	  build_libtool_libs=no
	<span class="enscript-keyword">else</span>
	  oldobjs=<span class="enscript-string">&quot;$old_deplibs $non_pic_objects&quot;</span>
	<span class="enscript-keyword">fi</span>
	addlibs=<span class="enscript-string">&quot;$old_convenience&quot;</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$addlibs&quot;</span>; <span class="enscript-keyword">then</span>
	gentop=<span class="enscript-string">&quot;$output_objdir/${outputname}x&quot;</span>
	generated=<span class="enscript-string">&quot;$generated $gentop&quot;</span>

	func_extract_archives $gentop $addlibs
	oldobjs=<span class="enscript-string">&quot;$oldobjs $func_extract_archives_result&quot;</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Do each command in the archive commands.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$old_archive_from_new_cmds&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$build_libtool_libs&quot;</span> = yes; <span class="enscript-keyword">then</span>
       cmds=$old_archive_from_new_cmds
      <span class="enscript-keyword">else</span>
	<span class="enscript-comment"># POSIX demands no paths to be encoded in archives.  We have
</span>	<span class="enscript-comment"># to avoid creating archives with duplicate basenames if we
</span>	<span class="enscript-comment"># might have to extract them afterwards, e.g., when creating a
</span>	<span class="enscript-comment"># static archive out of a convenience library, or when linking
</span>	<span class="enscript-comment"># the entirety of a libtool archive into another (currently
</span>	<span class="enscript-comment"># not supported by libtool).
</span>	<span class="enscript-keyword">if</span> (<span class="enscript-keyword">for</span> obj <span class="enscript-keyword">in</span> $oldobjs
	    <span class="enscript-keyword">do</span>
	      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$obj&quot;</span> | $Xsed -e 's%^.*/%%'
	    <span class="enscript-keyword">done</span> | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); <span class="enscript-keyword">then</span>
	  :
	<span class="enscript-keyword">else</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;copying selected object files to avoid basename conflicts...&quot;</span>

	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$gentop&quot;</span>; <span class="enscript-keyword">then</span>
	    gentop=<span class="enscript-string">&quot;$output_objdir/${outputname}x&quot;</span>
	    generated=<span class="enscript-string">&quot;$generated $gentop&quot;</span>

	    $show <span class="enscript-string">&quot;${rm}r $gentop&quot;</span>
	    $run ${rm}r <span class="enscript-string">&quot;$gentop&quot;</span>
	    $show <span class="enscript-string">&quot;$mkdir $gentop&quot;</span>
	    $run $mkdir <span class="enscript-string">&quot;$gentop&quot;</span>
	    exit_status=$?
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$exit_status&quot;</span> -ne 0 &amp;&amp; <span class="enscript-keyword">test</span> ! -d <span class="enscript-string">&quot;$gentop&quot;</span>; <span class="enscript-keyword">then</span>
	      <span class="enscript-keyword">exit</span> $exit_status
	    <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">fi</span>

	  save_oldobjs=$oldobjs
	  oldobjs=
	  counter=1
	  <span class="enscript-keyword">for</span> obj <span class="enscript-keyword">in</span> $save_oldobjs
	  <span class="enscript-keyword">do</span>
	    objbase=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$obj&quot;</span> | $Xsed -e 's%^.*/%%'`
	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $oldobjs &quot;</span> <span class="enscript-keyword">in</span>
	    <span class="enscript-string">&quot; &quot;</span>) oldobjs=$obj ;;
	    *[\ /]<span class="enscript-string">&quot;$objbase &quot;</span>*)
	      <span class="enscript-keyword">while</span> :; <span class="enscript-keyword">do</span>
		<span class="enscript-comment"># Make sure we don't pick an alternate name that also
</span>		<span class="enscript-comment"># overlaps.
</span>		newobj=lt$counter-$objbase
		counter=`expr $counter + 1`
		<span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $oldobjs &quot;</span> <span class="enscript-keyword">in</span>
		*[\ /]<span class="enscript-string">&quot;$newobj &quot;</span>*) ;;
		*) <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> ! -f <span class="enscript-string">&quot;$gentop/$newobj&quot;</span>; <span class="enscript-keyword">then</span> <span class="enscript-keyword">break</span>; <span class="enscript-keyword">fi</span> ;;
		<span class="enscript-keyword">esac</span>
	      <span class="enscript-keyword">done</span>
	      $show <span class="enscript-string">&quot;ln $obj $gentop/$newobj || cp $obj $gentop/$newobj&quot;</span>
	      $run ln <span class="enscript-string">&quot;$obj&quot;</span> <span class="enscript-string">&quot;$gentop/$newobj&quot;</span> ||
	      $run cp <span class="enscript-string">&quot;$obj&quot;</span> <span class="enscript-string">&quot;$gentop/$newobj&quot;</span>
	      oldobjs=<span class="enscript-string">&quot;$oldobjs $gentop/$newobj&quot;</span>
	      ;;
	    *) oldobjs=<span class="enscript-string">&quot;$oldobjs $obj&quot;</span> ;;
	    <span class="enscript-keyword">esac</span>
	  <span class="enscript-keyword">done</span>
	<span class="enscript-keyword">fi</span>

	<span class="enscript-keyword">eval</span> cmds=\<span class="enscript-string">&quot;$old_archive_cmds\&quot;

	if len=`expr &quot;</span>X$cmds<span class="enscript-string">&quot; : &quot;</span>.*<span class="enscript-string">&quot;` &amp;&amp;
	     test &quot;</span>$len<span class="enscript-string">&quot; -le &quot;</span>$max_cmd_len<span class="enscript-string">&quot; || test &quot;</span>$max_cmd_len<span class="enscript-string">&quot; -le -1; then
	  cmds=$old_archive_cmds
	else
	  # the command line is too long to link in one step, link in parts
	  $echo &quot;</span>using piecewise archive linking...<span class="enscript-string">&quot;
	  save_RANLIB=$RANLIB
	  RANLIB=:
	  objlist=
	  concat_cmds=
	  save_oldobjs=$oldobjs

	  # Is there a better way of finding the last object in the list?
	  for obj in $save_oldobjs
	  do
	    last_oldobj=$obj
	  done
	  for obj in $save_oldobjs
	  do
	    oldobjs=&quot;</span>$objlist $obj<span class="enscript-string">&quot;
	    objlist=&quot;</span>$objlist $obj<span class="enscript-string">&quot;
	    eval test_cmds=\&quot;$old_archive_cmds\&quot;
	    if len=`expr &quot;</span>X$test_cmds<span class="enscript-string">&quot; : &quot;</span>.*<span class="enscript-string">&quot; 2&gt;/dev/null` &amp;&amp;
	       test &quot;</span>$len<span class="enscript-string">&quot; -le &quot;</span>$max_cmd_len<span class="enscript-string">&quot;; then
	      :
	    else
	      # the above command should be used before it gets too long
	      oldobjs=$objlist
	      if test &quot;</span>$obj<span class="enscript-string">&quot; = &quot;</span>$last_oldobj<span class="enscript-string">&quot; ; then
	        RANLIB=$save_RANLIB
	      fi
	      test -z &quot;</span>$concat_cmds<span class="enscript-string">&quot; || concat_cmds=$concat_cmds~
	      eval concat_cmds=\&quot;\${concat_cmds}$old_archive_cmds\&quot;
	      objlist=
	    fi
	  done
	  RANLIB=$save_RANLIB
	  oldobjs=$objlist
	  if test &quot;</span>X$oldobjs<span class="enscript-string">&quot; = &quot;</span>X<span class="enscript-string">&quot; ; then
	    eval cmds=\&quot;\$concat_cmds\&quot;
	  else
	    eval cmds=\&quot;\$concat_cmds~\$old_archive_cmds\&quot;
	  fi
	fi
      fi
      save_ifs=&quot;</span>$<span class="enscript-keyword">IFS</span><span class="enscript-string">&quot;; IFS='~'
      for cmd in $cmds; do
        eval cmd=\&quot;$cmd\&quot;
	IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	$show &quot;</span>$cmd<span class="enscript-string">&quot;
	$run eval &quot;</span>$cmd<span class="enscript-string">&quot; || exit $?
      done
      IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
    done

    if test -n &quot;</span>$generated<span class="enscript-string">&quot;; then
      $show &quot;</span>${rm}r$generated<span class="enscript-string">&quot;
      $run ${rm}r$generated
    fi

    # Now create the libtool archive.
    case $output in
    *.la)
      old_library=
      test &quot;</span>$build_old_libs<span class="enscript-string">&quot; = yes &amp;&amp; old_library=&quot;</span>$libname.$libext<span class="enscript-string">&quot;
      $show &quot;</span>creating $output<span class="enscript-string">&quot;

      # Preserve any variables that may affect compiler behavior
      for var in $variables_saved_for_relink; do
	if eval test -z \&quot;\${$var+set}\&quot;; then
	  relink_command=&quot;</span>{ <span class="enscript-keyword">test</span> -z \<span class="enscript-string">&quot;\${$var+set}\&quot; || unset $var || { $var=; export $var; }; }; $relink_command&quot;</span>
	elif <span class="enscript-keyword">eval</span> var_value=\$$var; <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$var_value&quot;</span>; <span class="enscript-keyword">then</span>
	  relink_command=<span class="enscript-string">&quot;$var=; export $var; $relink_command&quot;</span>
	<span class="enscript-keyword">else</span>
	  var_value=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$var_value&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
	  relink_command=<span class="enscript-string">&quot;$var=\&quot;$var_value\&quot;; export $var; $relink_command&quot;</span>
	<span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">done</span>
      <span class="enscript-comment"># Quote the link command for shipping.
</span>      relink_command=<span class="enscript-string">&quot;(cd `pwd`; $SHELL $progpath $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)&quot;</span>
      relink_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$relink_command&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$hardcode_automatic&quot;</span> = yes ; <span class="enscript-keyword">then</span>
	relink_command=
      <span class="enscript-keyword">fi</span>


      <span class="enscript-comment"># Only create the output if not a dry run.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">for</span> installed <span class="enscript-keyword">in</span> no yes; <span class="enscript-keyword">do</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$installed&quot;</span> = yes; <span class="enscript-keyword">then</span>
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$install_libdir&quot;</span>; <span class="enscript-keyword">then</span>
	      <span class="enscript-keyword">break</span>
	    <span class="enscript-keyword">fi</span>
	    output=<span class="enscript-string">&quot;$output_objdir/$outputname&quot;</span>i
	    <span class="enscript-comment"># Replace all uninstalled libtool libraries with the installed ones
</span>	    newdependency_libs=
	    <span class="enscript-keyword">for</span> deplib <span class="enscript-keyword">in</span> $dependency_libs; <span class="enscript-keyword">do</span>
	      <span class="enscript-keyword">case</span> $deplib <span class="enscript-keyword">in</span>
	      *.la)
		name=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$deplib&quot;</span> | $Xsed -e 's%^.*/%%'`
		<span class="enscript-keyword">eval</span> libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
		<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$libdir&quot;</span>; <span class="enscript-keyword">then</span>
		  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$deplib' is not a valid libtool archive&quot;</span> 1&gt;&amp;2
		  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
		<span class="enscript-keyword">fi</span>
		newdependency_libs=<span class="enscript-string">&quot;$newdependency_libs $libdir/$name&quot;</span>
		;;
	      *) newdependency_libs=<span class="enscript-string">&quot;$newdependency_libs $deplib&quot;</span> ;;
	      <span class="enscript-keyword">esac</span>
	    <span class="enscript-keyword">done</span>
	    dependency_libs=<span class="enscript-string">&quot;$newdependency_libs&quot;</span>
	    newdlfiles=
	    <span class="enscript-keyword">for</span> lib <span class="enscript-keyword">in</span> $dlfiles; <span class="enscript-keyword">do</span>
	      name=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$lib&quot;</span> | $Xsed -e 's%^.*/%%'`
	      <span class="enscript-keyword">eval</span> libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
	      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$libdir&quot;</span>; <span class="enscript-keyword">then</span>
		$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$lib' is not a valid libtool archive&quot;</span> 1&gt;&amp;2
		<span class="enscript-keyword">exit</span> $EXIT_FAILURE
	      <span class="enscript-keyword">fi</span>
	      newdlfiles=<span class="enscript-string">&quot;$newdlfiles $libdir/$name&quot;</span>
	    <span class="enscript-keyword">done</span>
	    dlfiles=<span class="enscript-string">&quot;$newdlfiles&quot;</span>
	    newdlprefiles=
	    <span class="enscript-keyword">for</span> lib <span class="enscript-keyword">in</span> $dlprefiles; <span class="enscript-keyword">do</span>
	      name=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$lib&quot;</span> | $Xsed -e 's%^.*/%%'`
	      <span class="enscript-keyword">eval</span> libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
	      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$libdir&quot;</span>; <span class="enscript-keyword">then</span>
		$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$lib' is not a valid libtool archive&quot;</span> 1&gt;&amp;2
		<span class="enscript-keyword">exit</span> $EXIT_FAILURE
	      <span class="enscript-keyword">fi</span>
	      newdlprefiles=<span class="enscript-string">&quot;$newdlprefiles $libdir/$name&quot;</span>
	    <span class="enscript-keyword">done</span>
	    dlprefiles=<span class="enscript-string">&quot;$newdlprefiles&quot;</span>
	  <span class="enscript-keyword">else</span>
	    newdlfiles=
	    <span class="enscript-keyword">for</span> lib <span class="enscript-keyword">in</span> $dlfiles; <span class="enscript-keyword">do</span>
	      <span class="enscript-keyword">case</span> $lib <span class="enscript-keyword">in</span>
		[\\/]* | [A-Za-z]:[\\/]*) abs=<span class="enscript-string">&quot;$lib&quot;</span> ;;
		*) abs=`<span class="enscript-keyword">pwd</span>`<span class="enscript-string">&quot;/$lib&quot;</span> ;;
	      <span class="enscript-keyword">esac</span>
	      newdlfiles=<span class="enscript-string">&quot;$newdlfiles $abs&quot;</span>
	    <span class="enscript-keyword">done</span>
	    dlfiles=<span class="enscript-string">&quot;$newdlfiles&quot;</span>
	    newdlprefiles=
	    <span class="enscript-keyword">for</span> lib <span class="enscript-keyword">in</span> $dlprefiles; <span class="enscript-keyword">do</span>
	      <span class="enscript-keyword">case</span> $lib <span class="enscript-keyword">in</span>
		[\\/]* | [A-Za-z]:[\\/]*) abs=<span class="enscript-string">&quot;$lib&quot;</span> ;;
		*) abs=`<span class="enscript-keyword">pwd</span>`<span class="enscript-string">&quot;/$lib&quot;</span> ;;
	      <span class="enscript-keyword">esac</span>
	      newdlprefiles=<span class="enscript-string">&quot;$newdlprefiles $abs&quot;</span>
	    <span class="enscript-keyword">done</span>
	    dlprefiles=<span class="enscript-string">&quot;$newdlprefiles&quot;</span>
	  <span class="enscript-keyword">fi</span>
	  $rm $output
	  <span class="enscript-comment"># place dlname in correct position for cygwin
</span>	  tdlname=$dlname
	  <span class="enscript-keyword">case</span> $host,$output,$installed,$module,$dlname <span class="enscript-keyword">in</span>
	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;
	  <span class="enscript-keyword">esac</span>
	  $<span class="enscript-keyword">echo</span> &gt; $output <span class="enscript-string">&quot;\
# $outputname - a libtool library file
# Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP
#
# Please DO NOT delete this file!
# It is necessary for linking the library.

# The name that we can dlopen(3).
dlname='$tdlname'

# Names of this library.
library_names='$library_names'

# The name of the static archive.
old_library='$old_library'

# Libraries that this one depends upon.
dependency_libs='$dependency_libs'

# Version information for $libname.
current=$current
age=$age
revision=$revision

# Is this an already installed library?
installed=$installed

# Should we warn about portability when linking against -modules?
shouldnotlink=$module

# Files to dlopen/dlpreopen
dlopen='$dlfiles'
dlpreopen='$dlprefiles'

# Directory that this library needs to be installed in:
libdir='$install_libdir'&quot;</span>
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$installed&quot;</span> = no &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$need_relink&quot;</span> = yes; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> &gt;&gt; $output <span class="enscript-string">&quot;\
relink_command=\&quot;$relink_command\&quot;&quot;</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">done</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Do a symbolic link so that the libtool archive can be found in
</span>      <span class="enscript-comment"># LD_LIBRARY_PATH before the program is installed.
</span>      $show <span class="enscript-string">&quot;(cd $output_objdir &amp;&amp; $rm $outputname &amp;&amp; $LN_S ../$outputname $outputname)&quot;</span>
      $run <span class="enscript-keyword">eval</span> '(<span class="enscript-keyword">cd</span> $output_objdir &amp;&amp; $rm $outputname &amp;&amp; $LN_S ../$outputname $outputname)' || <span class="enscript-keyword">exit</span> $?
      ;;
    <span class="enscript-keyword">esac</span>
    <span class="enscript-keyword">exit</span> $EXIT_SUCCESS
    ;;

  <span class="enscript-comment"># libtool install mode
</span>  install)
    modename=<span class="enscript-string">&quot;$modename: install&quot;</span>

    <span class="enscript-comment"># There may be an optional sh(1) argument at the beginning of
</span>    <span class="enscript-comment"># install_prog (especially on Windows NT).
</span>    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$nonopt&quot;</span> = <span class="enscript-string">&quot;$SHELL&quot;</span> || <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$nonopt&quot;</span> = /bin/sh ||
       <span class="enscript-comment"># Allow the use of GNU shtool's install command.
</span>       $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$nonopt&quot;</span> | grep shtool &gt; /dev/null; <span class="enscript-keyword">then</span>
      <span class="enscript-comment"># Aesthetically quote it.
</span>      arg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$nonopt&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
      <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
      *[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	arg=<span class="enscript-string">&quot;\&quot;$arg\&quot;&quot;</span>
	;;
      <span class="enscript-keyword">esac</span>
      install_prog=<span class="enscript-string">&quot;$arg &quot;</span>
      arg=<span class="enscript-string">&quot;$1&quot;</span>
      <span class="enscript-keyword">shift</span>
    <span class="enscript-keyword">else</span>
      install_prog=
      arg=$nonopt
    <span class="enscript-keyword">fi</span>

    <span class="enscript-comment"># The real first argument should be the name of the installation program.
</span>    <span class="enscript-comment"># Aesthetically quote it.
</span>    arg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
    <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
    *[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>      arg=<span class="enscript-string">&quot;\&quot;$arg\&quot;&quot;</span>
      ;;
    <span class="enscript-keyword">esac</span>
    install_prog=<span class="enscript-string">&quot;$install_prog$arg&quot;</span>

    <span class="enscript-comment"># We need to accept at least all the BSD install flags.
</span>    dest=
    files=
    opts=
    prev=
    install_type=
    isdir=no
    stripme=
    <span class="enscript-keyword">for</span> arg
    <span class="enscript-keyword">do</span>
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$dest&quot;</span>; <span class="enscript-keyword">then</span>
	files=<span class="enscript-string">&quot;$files $dest&quot;</span>
	dest=$arg
	<span class="enscript-keyword">continue</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
      -d) isdir=yes ;;
      -f) 
      	<span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $install_prog &quot;</span> <span class="enscript-keyword">in</span>
	*[\\\ /]cp\ *) ;;
	*) prev=$arg ;;
	<span class="enscript-keyword">esac</span>
	;;
      -g | -m | -o) prev=$arg ;;
      -s)
	stripme=<span class="enscript-string">&quot; -s&quot;</span>
	<span class="enscript-keyword">continue</span>
	;;
      -*)
	;;
      *)
	<span class="enscript-comment"># If the previous option needed an argument, then skip it.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$prev&quot;</span>; <span class="enscript-keyword">then</span>
	  prev=
	<span class="enscript-keyword">else</span>
	  dest=$arg
	  <span class="enscript-keyword">continue</span>
	<span class="enscript-keyword">fi</span>
	;;
      <span class="enscript-keyword">esac</span>

      <span class="enscript-comment"># Aesthetically quote the argument.
</span>      arg=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$arg&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
      <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
      *[\[\~\<span class="enscript-comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
</span>	arg=<span class="enscript-string">&quot;\&quot;$arg\&quot;&quot;</span>
	;;
      <span class="enscript-keyword">esac</span>
      install_prog=<span class="enscript-string">&quot;$install_prog $arg&quot;</span>
    <span class="enscript-keyword">done</span>

    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$install_prog&quot;</span>; <span class="enscript-keyword">then</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: you must specify an install program&quot;</span> 1&gt;&amp;2
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
    <span class="enscript-keyword">fi</span>

    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$prev&quot;</span>; <span class="enscript-keyword">then</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: the \`$prev' option requires an argument&quot;</span> 1&gt;&amp;2
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
    <span class="enscript-keyword">fi</span>

    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$files&quot;</span>; <span class="enscript-keyword">then</span>
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$dest&quot;</span>; <span class="enscript-keyword">then</span>
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: no file or destination specified&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">else</span>
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: you must specify a destination&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">fi</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
    <span class="enscript-keyword">fi</span>

    <span class="enscript-comment"># Strip any trailing slash from the destination.
</span>    dest=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$dest&quot;</span> | $Xsed -e 's%/$%%'`

    <span class="enscript-comment"># Check to see that the destination is a directory.
</span>    <span class="enscript-keyword">test</span> -d <span class="enscript-string">&quot;$dest&quot;</span> &amp;&amp; isdir=yes
    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$isdir&quot;</span> = yes; <span class="enscript-keyword">then</span>
      destdir=<span class="enscript-string">&quot;$dest&quot;</span>
      destname=
    <span class="enscript-keyword">else</span>
      destdir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$dest&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
      <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$destdir&quot;</span> = <span class="enscript-string">&quot;X$dest&quot;</span> &amp;&amp; destdir=.
      destname=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$dest&quot;</span> | $Xsed -e 's%^.*/%%'`

      <span class="enscript-comment"># Not a directory, so check to see that there is only one file specified.
</span>      <span class="enscript-keyword">set</span> dummy $files
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$#&quot;</span> -gt 2; <span class="enscript-keyword">then</span>
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$dest' is not a directory&quot;</span> 1&gt;&amp;2
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
	<span class="enscript-keyword">exit</span> $EXIT_FAILURE
      <span class="enscript-keyword">fi</span>
    <span class="enscript-keyword">fi</span>
    <span class="enscript-keyword">case</span> $destdir <span class="enscript-keyword">in</span>
    [\\/]* | [A-Za-z]:[\\/]*) ;;
    *)
      <span class="enscript-keyword">for</span> file <span class="enscript-keyword">in</span> $files; <span class="enscript-keyword">do</span>
	<span class="enscript-keyword">case</span> $file <span class="enscript-keyword">in</span>
	*.lo) ;;
	*)
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$destdir' must be an absolute directory name&quot;</span> 1&gt;&amp;2
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  ;;
	<span class="enscript-keyword">esac</span>
      <span class="enscript-keyword">done</span>
      ;;
    <span class="enscript-keyword">esac</span>

    <span class="enscript-comment"># This variable tells wrapper scripts just to set variables rather
</span>    <span class="enscript-comment"># than running their programs.
</span>    libtool_install_magic=<span class="enscript-string">&quot;$magic&quot;</span>

    staticlibs=
    future_libdirs=
    current_libdirs=
    <span class="enscript-keyword">for</span> file <span class="enscript-keyword">in</span> $files; <span class="enscript-keyword">do</span>

      <span class="enscript-comment"># Do each installation.
</span>      <span class="enscript-keyword">case</span> $file <span class="enscript-keyword">in</span>
      *.$libext)
	<span class="enscript-comment"># Do the static libraries later.
</span>	staticlibs=<span class="enscript-string">&quot;$staticlibs $file&quot;</span>
	;;

      *.la)
	<span class="enscript-comment"># Check to see that this really is a libtool archive.
</span>	<span class="enscript-keyword">if</span> (${SED} -e '2q' $file | grep <span class="enscript-string">&quot;^# Generated by .*$PACKAGE&quot;</span>) &gt;/dev/null 2&gt;&amp;1; <span class="enscript-keyword">then</span> :
	<span class="enscript-keyword">else</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$file' is not a valid libtool archive&quot;</span> 1&gt;&amp;2
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	<span class="enscript-keyword">fi</span>

	library_names=
	old_library=
	relink_command=
	<span class="enscript-comment"># If there is no directory component, then add one.
</span>	<span class="enscript-keyword">case</span> $file <span class="enscript-keyword">in</span>
	*/* | *\\*) . $file ;;
	*) . ./$file ;;
	<span class="enscript-keyword">esac</span>

	<span class="enscript-comment"># Add the libdir to current_libdirs if it is the destination.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$destdir&quot;</span> = <span class="enscript-string">&quot;X$libdir&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$current_libdirs &quot;</span> <span class="enscript-keyword">in</span>
	  *<span class="enscript-string">&quot; $libdir &quot;</span>*) ;;
	  *) current_libdirs=<span class="enscript-string">&quot;$current_libdirs $libdir&quot;</span> ;;
	  <span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">else</span>
	  <span class="enscript-comment"># Note the libdir as a future libdir.
</span>	  <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$future_libdirs &quot;</span> <span class="enscript-keyword">in</span>
	  *<span class="enscript-string">&quot; $libdir &quot;</span>*) ;;
	  *) future_libdirs=<span class="enscript-string">&quot;$future_libdirs $libdir&quot;</span> ;;
	  <span class="enscript-keyword">esac</span>
	<span class="enscript-keyword">fi</span>

	dir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$file&quot;</span> | $Xsed -e 's%/[^/]*$%%'`/
	<span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$dir&quot;</span> = <span class="enscript-string">&quot;X$file/&quot;</span> &amp;&amp; dir=
	dir=<span class="enscript-string">&quot;$dir$objdir&quot;</span>

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$relink_command&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-comment"># Determine the prefix the user has applied to our future dir.
</span>	  inst_prefix_dir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$destdir&quot;</span> | $SED <span class="enscript-string">&quot;s%$libdir\$%%&quot;</span>`

	  <span class="enscript-comment"># Don't allow the user to place us outside of our expected
</span>	  <span class="enscript-comment"># location b/c this prevents finding dependent libraries that
</span>	  <span class="enscript-comment"># are installed to the same prefix.
</span>	  <span class="enscript-comment"># At present, this check doesn't affect windows .dll's that
</span>	  <span class="enscript-comment"># are installed into $libdir/../bin (currently, that works fine)
</span>	  <span class="enscript-comment"># but it's something to keep an eye on.
</span>	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$inst_prefix_dir&quot;</span> = <span class="enscript-string">&quot;$destdir&quot;</span>; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: error: cannot install \`$file' to a directory not ending in $libdir&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  <span class="enscript-keyword">fi</span>

	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$inst_prefix_dir&quot;</span>; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># Stick the inst_prefix_dir data into the link command.
</span>	    relink_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$relink_command&quot;</span> | $SED <span class="enscript-string">&quot;s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%&quot;</span>`
	  <span class="enscript-keyword">else</span>
	    relink_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$relink_command&quot;</span> | $SED <span class="enscript-string">&quot;s%@inst_prefix_dir@%%&quot;</span>`
	  <span class="enscript-keyword">fi</span>

	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: relinking \`$file'&quot;</span> 1&gt;&amp;2
	  $show <span class="enscript-string">&quot;$relink_command&quot;</span>
	  <span class="enscript-keyword">if</span> $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$relink_command&quot;</span>; <span class="enscript-keyword">then</span> :
	  <span class="enscript-keyword">else</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: error: relink \`$file' with the above command before installing it&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">fi</span>

	<span class="enscript-comment"># See the names of the shared library.
</span>	<span class="enscript-keyword">set</span> dummy $library_names
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$2&quot;</span>; <span class="enscript-keyword">then</span>
	  realname=<span class="enscript-string">&quot;$2&quot;</span>
	  <span class="enscript-keyword">shift</span>
	  <span class="enscript-keyword">shift</span>

	  srcname=<span class="enscript-string">&quot;$realname&quot;</span>
	  <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$relink_command&quot;</span> &amp;&amp; srcname=<span class="enscript-string">&quot;$realname&quot;</span>T

	  <span class="enscript-comment"># Install the shared library and build the symlinks.
</span>	  $show <span class="enscript-string">&quot;$install_prog $dir/$srcname $destdir/$realname&quot;</span>
	  $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$install_prog $dir/$srcname $destdir/$realname&quot;</span> || <span class="enscript-keyword">exit</span> $?
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$stripme&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$striplib&quot;</span>; <span class="enscript-keyword">then</span>
	    $show <span class="enscript-string">&quot;$striplib $destdir/$realname&quot;</span>
	    $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$striplib $destdir/$realname&quot;</span> || <span class="enscript-keyword">exit</span> $?
	  <span class="enscript-keyword">fi</span>

	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$#&quot;</span> -gt 0; <span class="enscript-keyword">then</span>
	    <span class="enscript-comment"># Delete the old symlinks, and create new ones.
</span>	    <span class="enscript-comment"># Try `ln -sf' first, because the `ln' binary might depend on
</span>	    <span class="enscript-comment"># the symlink we replace!  Solaris /bin/ln does not understand -f,
</span>	    <span class="enscript-comment"># so we also need to try rm &amp;&amp; ln -s.
</span>	    <span class="enscript-keyword">for</span> linkname
	    <span class="enscript-keyword">do</span>
	      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$linkname&quot;</span> != <span class="enscript-string">&quot;$realname&quot;</span>; <span class="enscript-keyword">then</span>
                $show <span class="enscript-string">&quot;(cd $destdir &amp;&amp; { $LN_S -f $realname $linkname || { $rm $linkname &amp;&amp; $LN_S $realname $linkname; }; })&quot;</span>
                $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;(cd $destdir &amp;&amp; { $LN_S -f $realname $linkname || { $rm $linkname &amp;&amp; $LN_S $realname $linkname; }; })&quot;</span>
	      <span class="enscript-keyword">fi</span>
	    <span class="enscript-keyword">done</span>
	  <span class="enscript-keyword">fi</span>

	  <span class="enscript-comment"># Do each command in the postinstall commands.
</span>	  lib=<span class="enscript-string">&quot;$destdir/$realname&quot;</span>
	  cmds=$postinstall_cmds
	  save_ifs=<span class="enscript-string">&quot;$IFS&quot;</span>; <span class="enscript-keyword">IFS</span>='~'
	  <span class="enscript-keyword">for</span> cmd <span class="enscript-keyword">in</span> $cmds; <span class="enscript-keyword">do</span>
	    <span class="enscript-keyword">IFS</span>=<span class="enscript-string">&quot;$save_ifs&quot;</span>
	    <span class="enscript-keyword">eval</span> cmd=\<span class="enscript-string">&quot;$cmd\&quot;
	    $show &quot;</span>$cmd<span class="enscript-string">&quot;
	    $run eval &quot;</span>$cmd<span class="enscript-string">&quot; || {
	      lt_exit=$?

	      # Restore the uninstalled library and exit
	      if test &quot;</span>$mode<span class="enscript-string">&quot; = relink; then
		$run eval '(cd $output_objdir &amp;&amp; $rm ${realname}T &amp;&amp; $mv ${realname}U $realname)'
	      fi

	      exit $lt_exit
	    }
	  done
	  IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	fi

	# Install the pseudo-library for information purposes.
	name=`$echo &quot;</span>X$file<span class="enscript-string">&quot; | $Xsed -e 's%^.*/%%'`
	instname=&quot;</span>$dir/$name<span class="enscript-string">&quot;i
	$show &quot;</span>$install_prog $instname $destdir/$name<span class="enscript-string">&quot;
	$run eval &quot;</span>$install_prog $instname $destdir/$name<span class="enscript-string">&quot; || exit $?

	# Maybe install the static library, too.
	test -n &quot;</span>$old_library<span class="enscript-string">&quot; &amp;&amp; staticlibs=&quot;</span>$staticlibs $dir/$old_library<span class="enscript-string">&quot;
	;;

      *.lo)
	# Install (i.e. copy) a libtool object.

	# Figure out destination file name, if it wasn't already specified.
	if test -n &quot;</span>$destname<span class="enscript-string">&quot;; then
	  destfile=&quot;</span>$destdir/$destname<span class="enscript-string">&quot;
	else
	  destfile=`$echo &quot;</span>X$file<span class="enscript-string">&quot; | $Xsed -e 's%^.*/%%'`
	  destfile=&quot;</span>$destdir/$destfile<span class="enscript-string">&quot;
	fi

	# Deduce the name of the destination old-style object file.
	case $destfile in
	*.lo)
	  staticdest=`$echo &quot;</span>X$destfile<span class="enscript-string">&quot; | $Xsed -e &quot;</span>$lo2o<span class="enscript-string">&quot;`
	  ;;
	*.$objext)
	  staticdest=&quot;</span>$destfile<span class="enscript-string">&quot;
	  destfile=
	  ;;
	*)
	  $echo &quot;</span>$modename: cannot copy a libtool object to \`$destfile'<span class="enscript-string">&quot; 1&gt;&amp;2
	  $echo &quot;</span>$help<span class="enscript-string">&quot; 1&gt;&amp;2
	  exit $EXIT_FAILURE
	  ;;
	esac

	# Install the libtool object if requested.
	if test -n &quot;</span>$destfile<span class="enscript-string">&quot;; then
	  $show &quot;</span>$install_prog $file $destfile<span class="enscript-string">&quot;
	  $run eval &quot;</span>$install_prog $file $destfile<span class="enscript-string">&quot; || exit $?
	fi

	# Install the old object if enabled.
	if test &quot;</span>$build_old_libs<span class="enscript-string">&quot; = yes; then
	  # Deduce the name of the old-style object file.
	  staticobj=`$echo &quot;</span>X$file<span class="enscript-string">&quot; | $Xsed -e &quot;</span>$lo2o<span class="enscript-string">&quot;`

	  $show &quot;</span>$install_prog $staticobj $staticdest<span class="enscript-string">&quot;
	  $run eval &quot;</span>$install_prog \$staticobj \$staticdest<span class="enscript-string">&quot; || exit $?
	fi
	exit $EXIT_SUCCESS
	;;

      *)
	# Figure out destination file name, if it wasn't already specified.
	if test -n &quot;</span>$destname<span class="enscript-string">&quot;; then
	  destfile=&quot;</span>$destdir/$destname<span class="enscript-string">&quot;
	else
	  destfile=`$echo &quot;</span>X$file<span class="enscript-string">&quot; | $Xsed -e 's%^.*/%%'`
	  destfile=&quot;</span>$destdir/$destfile<span class="enscript-string">&quot;
	fi

	# If the file is missing, and there is a .exe on the end, strip it
	# because it is most likely a libtool script we actually want to
	# install
	stripped_ext=&quot;</span><span class="enscript-string">&quot;
	case $file in
	  *.exe)
	    if test ! -f &quot;</span>$file<span class="enscript-string">&quot;; then
	      file=`$echo $file|${SED} 's,.exe$,,'`
	      stripped_ext=&quot;</span>.exe<span class="enscript-string">&quot;
	    fi
	    ;;
	esac

	# Do a test to see if this is really a libtool program.
	case $host in
	*cygwin*|*mingw*)
	    wrapper=`$echo $file | ${SED} -e 's,.exe$,,'`
	    ;;
	*)
	    wrapper=$file
	    ;;
	esac
	if (${SED} -e '4q' $wrapper | grep &quot;</span>^<span class="enscript-comment"># Generated by .*$PACKAGE&quot;)&gt;/dev/null 2&gt;&amp;1; then
</span>	  notinst_deplibs=
	  relink_command=

	  <span class="enscript-comment"># Note that it is not necessary on cygwin/mingw to append a dot to
</span>	  <span class="enscript-comment"># foo even if both foo and FILE.exe exist: automatic-append-.exe
</span>	  <span class="enscript-comment"># behavior happens only for exec(3), not for open(2)!  Also, sourcing
</span>	  <span class="enscript-comment"># `FILE.' does not work on cygwin managed mounts.
</span>	  <span class="enscript-comment">#
</span>	  <span class="enscript-comment"># If there is no directory component, then add one.
</span>	  <span class="enscript-keyword">case</span> $wrapper <span class="enscript-keyword">in</span>
	  */* | *\\*) . ${wrapper} ;;
	  *) . ./${wrapper} ;;
	  <span class="enscript-keyword">esac</span>

	  <span class="enscript-comment"># Check the variables that should have been set.
</span>	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$notinst_deplibs&quot;</span>; <span class="enscript-keyword">then</span>
	    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: invalid libtool wrapper script \`$wrapper'&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	  <span class="enscript-keyword">fi</span>

	  finalize=yes
	  <span class="enscript-keyword">for</span> lib <span class="enscript-keyword">in</span> $notinst_deplibs; <span class="enscript-keyword">do</span>
	    <span class="enscript-comment"># Check to see that each library is installed.
</span>	    libdir=
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -f <span class="enscript-string">&quot;$lib&quot;</span>; <span class="enscript-keyword">then</span>
	      <span class="enscript-comment"># If there is no directory component, then add one.
</span>	      <span class="enscript-keyword">case</span> $lib <span class="enscript-keyword">in</span>
	      */* | *\\*) . $lib ;;
	      *) . ./$lib ;;
	      <span class="enscript-keyword">esac</span>
	    <span class="enscript-keyword">fi</span>
	    libfile=<span class="enscript-string">&quot;$libdir/&quot;</span>`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$lib&quot;</span> | $Xsed -e 's%^.*/%%g'` <span class="enscript-comment">### testsuite: skip nested quoting test
</span>	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$libdir&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> ! -f <span class="enscript-string">&quot;$libfile&quot;</span>; <span class="enscript-keyword">then</span>
	      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: \`$lib' has not been installed in \`$libdir'&quot;</span> 1&gt;&amp;2
	      finalize=no
	    <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">done</span>

	  relink_command=
	  <span class="enscript-comment"># Note that it is not necessary on cygwin/mingw to append a dot to
</span>	  <span class="enscript-comment"># foo even if both foo and FILE.exe exist: automatic-append-.exe
</span>	  <span class="enscript-comment"># behavior happens only for exec(3), not for open(2)!  Also, sourcing
</span>	  <span class="enscript-comment"># `FILE.' does not work on cygwin managed mounts.
</span>	  <span class="enscript-comment">#
</span>	  <span class="enscript-comment"># If there is no directory component, then add one.
</span>	  <span class="enscript-keyword">case</span> $wrapper <span class="enscript-keyword">in</span>
	  */* | *\\*) . ${wrapper} ;;
	  *) . ./${wrapper} ;;
	  <span class="enscript-keyword">esac</span>

	  outputname=
	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$fast_install&quot;</span> = no &amp;&amp; <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$relink_command&quot;</span>; <span class="enscript-keyword">then</span>
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$finalize&quot;</span> = yes &amp;&amp; <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span>; <span class="enscript-keyword">then</span>
	      tmpdir=`func_mktempdir`
	      file=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$file$stripped_ext&quot;</span> | $Xsed -e 's%^.*/%%'`
	      outputname=<span class="enscript-string">&quot;$tmpdir/$file&quot;</span>
	      <span class="enscript-comment"># Replace the output file specification.
</span>	      relink_command=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$relink_command&quot;</span> | $Xsed -e 's%@OUTPUT@%'<span class="enscript-string">&quot;$outputname&quot;</span>'%g'`

	      $show <span class="enscript-string">&quot;$relink_command&quot;</span>
	      <span class="enscript-keyword">if</span> $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$relink_command&quot;</span>; <span class="enscript-keyword">then</span> :
	      <span class="enscript-keyword">else</span>
		$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: error: relink \`$file' with the above command before installing it&quot;</span> 1&gt;&amp;2
		${rm}r <span class="enscript-string">&quot;$tmpdir&quot;</span>
		<span class="enscript-keyword">continue</span>
	      <span class="enscript-keyword">fi</span>
	      file=<span class="enscript-string">&quot;$outputname&quot;</span>
	    <span class="enscript-keyword">else</span>
	      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: cannot relink \`$file'&quot;</span> 1&gt;&amp;2
	    <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">else</span>
	    <span class="enscript-comment"># Install the binary that we compiled earlier.
</span>	    file=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$file$stripped_ext&quot;</span> | $Xsed -e <span class="enscript-string">&quot;s%\([^/]*\)$%$objdir/\1%&quot;</span>`
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">fi</span>

	<span class="enscript-comment"># remove .exe since cygwin /usr/bin/install will append another
</span>	<span class="enscript-comment"># one anyway 
</span>	<span class="enscript-keyword">case</span> $install_prog,$host <span class="enscript-keyword">in</span>
	*/usr/bin/install*,*cygwin*)
	  <span class="enscript-keyword">case</span> $file:$destfile <span class="enscript-keyword">in</span>
	  *.exe:*.exe)
	    <span class="enscript-comment"># this is ok
</span>	    ;;
	  *.exe:*)
	    destfile=$destfile.exe
	    ;;
	  *:*.exe)
	    destfile=`$<span class="enscript-keyword">echo</span> $destfile | ${SED} -e 's,.exe$,,'`
	    ;;
	  <span class="enscript-keyword">esac</span>
	  ;;
	<span class="enscript-keyword">esac</span>
	$show <span class="enscript-string">&quot;$install_prog$stripme $file $destfile&quot;</span>
	$run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$install_prog\$stripme \$file \$destfile&quot;</span> || <span class="enscript-keyword">exit</span> $?
	<span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$outputname&quot;</span> &amp;&amp; ${rm}r <span class="enscript-string">&quot;$tmpdir&quot;</span>
	;;
      <span class="enscript-keyword">esac</span>
    <span class="enscript-keyword">done</span>

    <span class="enscript-keyword">for</span> file <span class="enscript-keyword">in</span> $staticlibs; <span class="enscript-keyword">do</span>
      name=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$file&quot;</span> | $Xsed -e 's%^.*/%%'`

      <span class="enscript-comment"># Set up the ranlib parameters.
</span>      oldlib=<span class="enscript-string">&quot;$destdir/$name&quot;</span>

      $show <span class="enscript-string">&quot;$install_prog $file $oldlib&quot;</span>
      $run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$install_prog \$file \$oldlib&quot;</span> || <span class="enscript-keyword">exit</span> $?

      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$stripme&quot;</span> &amp;&amp; <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$old_striplib&quot;</span>; <span class="enscript-keyword">then</span>
	$show <span class="enscript-string">&quot;$old_striplib $oldlib&quot;</span>
	$run <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$old_striplib $oldlib&quot;</span> || <span class="enscript-keyword">exit</span> $?
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Do each command in the postinstall commands.
</span>      cmds=$old_postinstall_cmds
      save_ifs=<span class="enscript-string">&quot;$IFS&quot;</span>; <span class="enscript-keyword">IFS</span>='~'
      <span class="enscript-keyword">for</span> cmd <span class="enscript-keyword">in</span> $cmds; <span class="enscript-keyword">do</span>
	<span class="enscript-keyword">IFS</span>=<span class="enscript-string">&quot;$save_ifs&quot;</span>
	<span class="enscript-keyword">eval</span> cmd=\<span class="enscript-string">&quot;$cmd\&quot;
	$show &quot;</span>$cmd<span class="enscript-string">&quot;
	$run eval &quot;</span>$cmd<span class="enscript-string">&quot; || exit $?
      done
      IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
    done

    if test -n &quot;</span>$future_libdirs<span class="enscript-string">&quot;; then
      $echo &quot;</span>$modename: warning: remember to run \`$progname --finish$future_libdirs'<span class="enscript-string">&quot; 1&gt;&amp;2
    fi

    if test -n &quot;</span>$current_libdirs<span class="enscript-string">&quot;; then
      # Maybe just do a dry run.
      test -n &quot;</span>$run<span class="enscript-string">&quot; &amp;&amp; current_libdirs=&quot;</span> -n$current_libdirs<span class="enscript-string">&quot;
      exec_cmd='$SHELL $progpath $preserve_args --finish$current_libdirs'
    else
      exit $EXIT_SUCCESS
    fi
    ;;

  # libtool finish mode
  finish)
    modename=&quot;</span>$modename: finish<span class="enscript-string">&quot;
    libdirs=&quot;</span>$nonopt<span class="enscript-string">&quot;
    admincmds=

    if test -n &quot;</span>$finish_cmds$finish_eval<span class="enscript-string">&quot; &amp;&amp; test -n &quot;</span>$libdirs<span class="enscript-string">&quot;; then
      for dir
      do
	libdirs=&quot;</span>$libdirs $dir<span class="enscript-string">&quot;
      done

      for libdir in $libdirs; do
	if test -n &quot;</span>$finish_cmds<span class="enscript-string">&quot;; then
	  # Do each command in the finish commands.
	  cmds=$finish_cmds
	  save_ifs=&quot;</span>$<span class="enscript-keyword">IFS</span><span class="enscript-string">&quot;; IFS='~'
	  for cmd in $cmds; do
	    IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	    eval cmd=\&quot;$cmd\&quot;
	    $show &quot;</span>$cmd<span class="enscript-string">&quot;
	    $run eval &quot;</span>$cmd<span class="enscript-string">&quot; || admincmds=&quot;</span>$admincmds
       $cmd<span class="enscript-string">&quot;
	  done
	  IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	fi
	if test -n &quot;</span>$finish_eval<span class="enscript-string">&quot;; then
	  # Do the single finish_eval.
	  eval cmds=\&quot;$finish_eval\&quot;
	  $run eval &quot;</span>$cmds<span class="enscript-string">&quot; || admincmds=&quot;</span>$admincmds
       $cmds<span class="enscript-string">&quot;
	fi
      done
    fi

    # Exit here if they wanted silent mode.
    test &quot;</span>$show<span class="enscript-string">&quot; = : &amp;&amp; exit $EXIT_SUCCESS

    $echo &quot;</span>X----------------------------------------------------------------------<span class="enscript-string">&quot; | $Xsed
    $echo &quot;</span>Libraries have been installed <span class="enscript-keyword">in</span>:<span class="enscript-string">&quot;
    for libdir in $libdirs; do
      $echo &quot;</span>   $libdir<span class="enscript-string">&quot;
    done
    $echo
    $echo &quot;</span>If you ever happen to want to link against installed libraries<span class="enscript-string">&quot;
    $echo &quot;</span><span class="enscript-keyword">in</span> a given directory, LIBDIR, you must either use libtool, and<span class="enscript-string">&quot;
    $echo &quot;</span>specify the full pathname of the library, or use the \`-LLIBDIR'<span class="enscript-string">&quot;
    $echo &quot;</span>flag during linking and <span class="enscript-keyword">do</span> at least one of the following:<span class="enscript-string">&quot;
    if test -n &quot;</span>$shlibpath_var<span class="enscript-string">&quot;; then
      $echo &quot;</span>   - add LIBDIR to the \`$shlibpath_var' environment variable<span class="enscript-string">&quot;
      $echo &quot;</span>     during execution<span class="enscript-string">&quot;
    fi
    if test -n &quot;</span>$runpath_var<span class="enscript-string">&quot;; then
      $echo &quot;</span>   - add LIBDIR to the \`$runpath_var' environment variable<span class="enscript-string">&quot;
      $echo &quot;</span>     during linking<span class="enscript-string">&quot;
    fi
    if test -n &quot;</span>$hardcode_libdir_flag_spec<span class="enscript-string">&quot;; then
      libdir=LIBDIR
      eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;

      $echo &quot;</span>   - use the \`$flag' linker flag<span class="enscript-string">&quot;
    fi
    if test -n &quot;</span>$admincmds<span class="enscript-string">&quot;; then
      $echo &quot;</span>   - have your system administrator run these commands:$admincmds<span class="enscript-string">&quot;
    fi
    if test -f /etc/ld.so.conf; then
      $echo &quot;</span>   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'<span class="enscript-string">&quot;
    fi
    $echo
    $echo &quot;</span>See any operating system documentation about shared libraries <span class="enscript-keyword">for</span><span class="enscript-string">&quot;
    $echo &quot;</span>more information, such as the ld(1) and ld.so(8) manual pages.<span class="enscript-string">&quot;
    $echo &quot;</span>X----------------------------------------------------------------------<span class="enscript-string">&quot; | $Xsed
    exit $EXIT_SUCCESS
    ;;

  # libtool execute mode
  execute)
    modename=&quot;</span>$modename: execute<span class="enscript-string">&quot;

    # The first argument is the command name.
    cmd=&quot;</span>$nonopt<span class="enscript-string">&quot;
    if test -z &quot;</span>$cmd<span class="enscript-string">&quot;; then
      $echo &quot;</span>$modename: you must specify a COMMAND<span class="enscript-string">&quot; 1&gt;&amp;2
      $echo &quot;</span>$help<span class="enscript-string">&quot;
      exit $EXIT_FAILURE
    fi

    # Handle -dlopen flags immediately.
    for file in $execute_dlfiles; do
      if test ! -f &quot;</span>$file<span class="enscript-string">&quot;; then
	$echo &quot;</span>$modename: \`$file' is not a file<span class="enscript-string">&quot; 1&gt;&amp;2
	$echo &quot;</span>$help<span class="enscript-string">&quot; 1&gt;&amp;2
	exit $EXIT_FAILURE
      fi

      dir=
      case $file in
      *.la)
	# Check to see that this really is a libtool archive.
	if (${SED} -e '2q' $file | grep &quot;</span>^<span class="enscript-comment"># Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
</span>	<span class="enscript-keyword">else</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: \`$lib' is not a valid libtool archive&quot;</span> 1&gt;&amp;2
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	<span class="enscript-keyword">fi</span>

	<span class="enscript-comment"># Read the libtool library.
</span>	dlname=
	library_names=

	<span class="enscript-comment"># If there is no directory component, then add one.
</span>	<span class="enscript-keyword">case</span> $file <span class="enscript-keyword">in</span>
	*/* | *\\*) . $file ;;
	*) . ./$file ;;
	<span class="enscript-keyword">esac</span>

	<span class="enscript-comment"># Skip this library if it cannot be dlopened.
</span>	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$dlname&quot;</span>; <span class="enscript-keyword">then</span>
	  <span class="enscript-comment"># Warn if it was a shared library.
</span>	  <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$library_names&quot;</span> &amp;&amp; $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning: \`$file' was not linked with \`-export-dynamic'&quot;</span>
	  <span class="enscript-keyword">continue</span>
	<span class="enscript-keyword">fi</span>

	dir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$file&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
	<span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$dir&quot;</span> = <span class="enscript-string">&quot;X$file&quot;</span> &amp;&amp; dir=.

	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -f <span class="enscript-string">&quot;$dir/$objdir/$dlname&quot;</span>; <span class="enscript-keyword">then</span>
	  dir=<span class="enscript-string">&quot;$dir/$objdir&quot;</span>
	<span class="enscript-keyword">else</span>
	  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: cannot find \`$dlname' in \`$dir' or \`$dir/$objdir'&quot;</span> 1&gt;&amp;2
	  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
	<span class="enscript-keyword">fi</span>
	;;

      *.lo)
	<span class="enscript-comment"># Just add the directory containing the .lo file.
</span>	dir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$file&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
	<span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$dir&quot;</span> = <span class="enscript-string">&quot;X$file&quot;</span> &amp;&amp; dir=.
	;;

      *)
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: warning \`-dlopen' is ignored for non-libtool libraries and objects&quot;</span> 1&gt;&amp;2
	<span class="enscript-keyword">continue</span>
	;;
      <span class="enscript-keyword">esac</span>

      <span class="enscript-comment"># Get the absolute pathname.
</span>      absdir=`<span class="enscript-keyword">cd</span> <span class="enscript-string">&quot;$dir&quot;</span> &amp;&amp; <span class="enscript-keyword">pwd</span>`
      <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$absdir&quot;</span> &amp;&amp; dir=<span class="enscript-string">&quot;$absdir&quot;</span>

      <span class="enscript-comment"># Now add the directory to shlibpath_var.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;test -z \&quot;\$$shlibpath_var\&quot;&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$shlibpath_var=\&quot;\$dir\&quot;&quot;</span>
      <span class="enscript-keyword">else</span>
	<span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;$shlibpath_var=\&quot;\$dir:\$$shlibpath_var\&quot;&quot;</span>
      <span class="enscript-keyword">fi</span>
    <span class="enscript-keyword">done</span>

    <span class="enscript-comment"># This variable tells wrapper scripts just to set shlibpath_var
</span>    <span class="enscript-comment"># rather than running their programs.
</span>    libtool_execute_magic=<span class="enscript-string">&quot;$magic&quot;</span>

    <span class="enscript-comment"># Check if any of the arguments is a wrapper script.
</span>    args=
    <span class="enscript-keyword">for</span> file
    <span class="enscript-keyword">do</span>
      <span class="enscript-keyword">case</span> $file <span class="enscript-keyword">in</span>
      -*) ;;
      *)
	<span class="enscript-comment"># Do a test to see if this is really a libtool program.
</span>	<span class="enscript-keyword">if</span> (${SED} -e '4q' $file | grep <span class="enscript-string">&quot;^# Generated by .*$PACKAGE&quot;</span>) &gt;/dev/null 2&gt;&amp;1; <span class="enscript-keyword">then</span>
	  <span class="enscript-comment"># If there is no directory component, then add one.
</span>	  <span class="enscript-keyword">case</span> $file <span class="enscript-keyword">in</span>
	  */* | *\\*) . $file ;;
	  *) . ./$file ;;
	  <span class="enscript-keyword">esac</span>

	  <span class="enscript-comment"># Transform arg to wrapped name.
</span>	  file=<span class="enscript-string">&quot;$progdir/$program&quot;</span>
	<span class="enscript-keyword">fi</span>
	;;
      <span class="enscript-keyword">esac</span>
      <span class="enscript-comment"># Quote arguments (to preserve shell metacharacters).
</span>      file=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$file&quot;</span> | $Xsed -e <span class="enscript-string">&quot;$sed_quote_subst&quot;</span>`
      args=<span class="enscript-string">&quot;$args \&quot;$file\&quot;&quot;</span>
    <span class="enscript-keyword">done</span>

    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$run&quot;</span>; <span class="enscript-keyword">then</span>
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$shlibpath_var&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-comment"># Export the shlibpath_var.
</span>	<span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;export $shlibpath_var&quot;</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Restore saved environment variables
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;${save_LC_ALL+set}&quot;</span> = <span class="enscript-keyword">set</span>; <span class="enscript-keyword">then</span>
	LC_ALL=<span class="enscript-string">&quot;$save_LC_ALL&quot;</span>; <span class="enscript-keyword">export</span> LC_ALL
      <span class="enscript-keyword">fi</span>
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;${save_LANG+set}&quot;</span> = <span class="enscript-keyword">set</span>; <span class="enscript-keyword">then</span>
	LANG=<span class="enscript-string">&quot;$save_LANG&quot;</span>; <span class="enscript-keyword">export</span> LANG
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Now prepare to actually exec the command.
</span>      exec_cmd=<span class="enscript-string">&quot;\$cmd$args&quot;</span>
    <span class="enscript-keyword">else</span>
      <span class="enscript-comment"># Display what would be done.
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$shlibpath_var&quot;</span>; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">eval</span> <span class="enscript-string">&quot;\$echo \&quot;\$shlibpath_var=\$$shlibpath_var\&quot;&quot;</span>
	$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;export $shlibpath_var&quot;</span>
      <span class="enscript-keyword">fi</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$cmd$args&quot;</span>
      <span class="enscript-keyword">exit</span> $EXIT_SUCCESS
    <span class="enscript-keyword">fi</span>
    ;;

  <span class="enscript-comment"># libtool clean and uninstall mode
</span>  clean | uninstall)
    modename=<span class="enscript-string">&quot;$modename: $mode&quot;</span>
    rm=<span class="enscript-string">&quot;$nonopt&quot;</span>
    files=
    rmforce=
    exit_status=0

    <span class="enscript-comment"># This variable tells wrapper scripts just to set variables rather
</span>    <span class="enscript-comment"># than running their programs.
</span>    libtool_install_magic=<span class="enscript-string">&quot;$magic&quot;</span>

    <span class="enscript-keyword">for</span> arg
    <span class="enscript-keyword">do</span>
      <span class="enscript-keyword">case</span> $arg <span class="enscript-keyword">in</span>
      -f) rm=<span class="enscript-string">&quot;$rm $arg&quot;</span>; rmforce=yes ;;
      -*) rm=<span class="enscript-string">&quot;$rm $arg&quot;</span> ;;
      *) files=<span class="enscript-string">&quot;$files $arg&quot;</span> ;;
      <span class="enscript-keyword">esac</span>
    <span class="enscript-keyword">done</span>

    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$rm&quot;</span>; <span class="enscript-keyword">then</span>
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: you must specify an RM program&quot;</span> 1&gt;&amp;2
      $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
      <span class="enscript-keyword">exit</span> $EXIT_FAILURE
    <span class="enscript-keyword">fi</span>

    rmdirs=

    origobjdir=<span class="enscript-string">&quot;$objdir&quot;</span>
    <span class="enscript-keyword">for</span> file <span class="enscript-keyword">in</span> $files; <span class="enscript-keyword">do</span>
      dir=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$file&quot;</span> | $Xsed -e 's%/[^/]*$%%'`
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$dir&quot;</span> = <span class="enscript-string">&quot;X$file&quot;</span>; <span class="enscript-keyword">then</span>
	dir=.
	objdir=<span class="enscript-string">&quot;$origobjdir&quot;</span>
      <span class="enscript-keyword">else</span>
	objdir=<span class="enscript-string">&quot;$dir/$origobjdir&quot;</span>
      <span class="enscript-keyword">fi</span>
      name=`$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;X$file&quot;</span> | $Xsed -e 's%^.*/%%'`
      <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$mode&quot;</span> = uninstall &amp;&amp; objdir=<span class="enscript-string">&quot;$dir&quot;</span>

      <span class="enscript-comment"># Remember objdir for removal later, being careful to avoid duplicates
</span>      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$mode&quot;</span> = clean; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">case</span> <span class="enscript-string">&quot; $rmdirs &quot;</span> <span class="enscript-keyword">in</span>
	  *<span class="enscript-string">&quot; $objdir &quot;</span>*) ;;
	  *) rmdirs=<span class="enscript-string">&quot;$rmdirs $objdir&quot;</span> ;;
	<span class="enscript-keyword">esac</span>
      <span class="enscript-keyword">fi</span>

      <span class="enscript-comment"># Don't error if the file doesn't exist and rm -f was used.
</span>      <span class="enscript-keyword">if</span> (<span class="enscript-keyword">test</span> -L <span class="enscript-string">&quot;$file&quot;</span>) &gt;/dev/null 2&gt;&amp;1 \
	|| (<span class="enscript-keyword">test</span> -h <span class="enscript-string">&quot;$file&quot;</span>) &gt;/dev/null 2&gt;&amp;1 \
	|| <span class="enscript-keyword">test</span> -f <span class="enscript-string">&quot;$file&quot;</span>; <span class="enscript-keyword">then</span>
	:
      elif <span class="enscript-keyword">test</span> -d <span class="enscript-string">&quot;$file&quot;</span>; <span class="enscript-keyword">then</span>
	exit_status=1
	<span class="enscript-keyword">continue</span>
      elif <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$rmforce&quot;</span> = yes; <span class="enscript-keyword">then</span>
	<span class="enscript-keyword">continue</span>
      <span class="enscript-keyword">fi</span>

      rmfiles=<span class="enscript-string">&quot;$file&quot;</span>

      <span class="enscript-keyword">case</span> $name <span class="enscript-keyword">in</span>
      *.la)
	<span class="enscript-comment"># Possibly a libtool archive, so verify it.
</span>	<span class="enscript-keyword">if</span> (${SED} -e '2q' $file | grep <span class="enscript-string">&quot;^# Generated by .*$PACKAGE&quot;</span>) &gt;/dev/null 2&gt;&amp;1; <span class="enscript-keyword">then</span>
	  . $dir/$name

	  <span class="enscript-comment"># Delete the libtool libraries and symlinks.
</span>	  <span class="enscript-keyword">for</span> n <span class="enscript-keyword">in</span> $library_names; <span class="enscript-keyword">do</span>
	    rmfiles=<span class="enscript-string">&quot;$rmfiles $objdir/$n&quot;</span>
	  <span class="enscript-keyword">done</span>
	  <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$old_library&quot;</span> &amp;&amp; rmfiles=<span class="enscript-string">&quot;$rmfiles $objdir/$old_library&quot;</span>

	  <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;$mode&quot;</span> <span class="enscript-keyword">in</span>
	  clean)
	    <span class="enscript-keyword">case</span> <span class="enscript-string">&quot;  $library_names &quot;</span> <span class="enscript-keyword">in</span>
	    <span class="enscript-comment"># &quot;  &quot; in the beginning catches empty $dlname
</span>	    *<span class="enscript-string">&quot; $dlname &quot;</span>*) ;;
	    *) rmfiles=<span class="enscript-string">&quot;$rmfiles $objdir/$dlname&quot;</span> ;;
	    <span class="enscript-keyword">esac</span>
	     <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$libdir&quot;</span> &amp;&amp; rmfiles=<span class="enscript-string">&quot;$rmfiles $objdir/$name $objdir/${name}i&quot;</span>
	    ;;
	  uninstall)
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$library_names&quot;</span>; <span class="enscript-keyword">then</span>
	      <span class="enscript-comment"># Do each command in the postuninstall commands.
</span>	      cmds=$postuninstall_cmds
	      save_ifs=<span class="enscript-string">&quot;$IFS&quot;</span>; <span class="enscript-keyword">IFS</span>='~'
	      <span class="enscript-keyword">for</span> cmd <span class="enscript-keyword">in</span> $cmds; <span class="enscript-keyword">do</span>
		<span class="enscript-keyword">IFS</span>=<span class="enscript-string">&quot;$save_ifs&quot;</span>
		<span class="enscript-keyword">eval</span> cmd=\<span class="enscript-string">&quot;$cmd\&quot;
		$show &quot;</span>$cmd<span class="enscript-string">&quot;
		$run eval &quot;</span>$cmd<span class="enscript-string">&quot;
		if test &quot;</span>$?<span class="enscript-string">&quot; -ne 0 &amp;&amp; test &quot;</span>$rmforce<span class="enscript-string">&quot; != yes; then
		  exit_status=1
		fi
	      done
	      IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	    fi

	    if test -n &quot;</span>$old_library<span class="enscript-string">&quot;; then
	      # Do each command in the old_postuninstall commands.
	      cmds=$old_postuninstall_cmds
	      save_ifs=&quot;</span>$<span class="enscript-keyword">IFS</span><span class="enscript-string">&quot;; IFS='~'
	      for cmd in $cmds; do
		IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
		eval cmd=\&quot;$cmd\&quot;
		$show &quot;</span>$cmd<span class="enscript-string">&quot;
		$run eval &quot;</span>$cmd<span class="enscript-string">&quot;
		if test &quot;</span>$?<span class="enscript-string">&quot; -ne 0 &amp;&amp; test &quot;</span>$rmforce<span class="enscript-string">&quot; != yes; then
		  exit_status=1
		fi
	      done
	      IFS=&quot;</span>$save_ifs<span class="enscript-string">&quot;
	    fi
	    # FIXME: should reinstall the best remaining shared library.
	    ;;
	  esac
	fi
	;;

      *.lo)
	# Possibly a libtool object, so verify it.
	if (${SED} -e '2q' $file | grep &quot;</span>^<span class="enscript-comment"># Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
</span>
	  <span class="enscript-comment"># Read the .lo file
</span>	  . $dir/$name

	  <span class="enscript-comment"># Add PIC object to the list of files to remove.
</span>	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$pic_object&quot;</span> \
	     &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$pic_object&quot;</span> != none; <span class="enscript-keyword">then</span>
	    rmfiles=<span class="enscript-string">&quot;$rmfiles $dir/$pic_object&quot;</span>
	  <span class="enscript-keyword">fi</span>

	  <span class="enscript-comment"># Add non-PIC object to the list of files to remove.
</span>	  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$non_pic_object&quot;</span> \
	     &amp;&amp; <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$non_pic_object&quot;</span> != none; <span class="enscript-keyword">then</span>
	    rmfiles=<span class="enscript-string">&quot;$rmfiles $dir/$non_pic_object&quot;</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">fi</span>
	;;

      *)
	<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$mode&quot;</span> = clean ; <span class="enscript-keyword">then</span>
	  noexename=$name
	  <span class="enscript-keyword">case</span> $file <span class="enscript-keyword">in</span>
	  *.exe)
	    file=`$<span class="enscript-keyword">echo</span> $file|${SED} 's,.exe$,,'`
	    noexename=`$<span class="enscript-keyword">echo</span> $name|${SED} 's,.exe$,,'`
	    <span class="enscript-comment"># $file with .exe has already been added to rmfiles,
</span>	    <span class="enscript-comment"># add $file without .exe
</span>	    rmfiles=<span class="enscript-string">&quot;$rmfiles $file&quot;</span>
	    ;;
	  <span class="enscript-keyword">esac</span>
	  <span class="enscript-comment"># Do a test to see if this is a libtool program.
</span>	  <span class="enscript-keyword">if</span> (${SED} -e '4q' $file | grep <span class="enscript-string">&quot;^# Generated by .*$PACKAGE&quot;</span>) &gt;/dev/null 2&gt;&amp;1; <span class="enscript-keyword">then</span>
	    relink_command=
	    . $dir/$noexename

	    <span class="enscript-comment"># note $name still contains .exe if it was in $file originally
</span>	    <span class="enscript-comment"># as does the version of $file that was added into $rmfiles
</span>	    rmfiles=<span class="enscript-string">&quot;$rmfiles $objdir/$name $objdir/${name}S.${objext}&quot;</span>
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;$fast_install&quot;</span> = yes &amp;&amp; <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$relink_command&quot;</span>; <span class="enscript-keyword">then</span>
	      rmfiles=<span class="enscript-string">&quot;$rmfiles $objdir/lt-$name&quot;</span>
	    <span class="enscript-keyword">fi</span>
	    <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> <span class="enscript-string">&quot;X$noexename&quot;</span> != <span class="enscript-string">&quot;X$name&quot;</span> ; <span class="enscript-keyword">then</span>
	      rmfiles=<span class="enscript-string">&quot;$rmfiles $objdir/lt-${noexename}.c&quot;</span>
	    <span class="enscript-keyword">fi</span>
	  <span class="enscript-keyword">fi</span>
	<span class="enscript-keyword">fi</span>
	;;
      <span class="enscript-keyword">esac</span>
      $show <span class="enscript-string">&quot;$rm $rmfiles&quot;</span>
      $run $rm $rmfiles || exit_status=1
    <span class="enscript-keyword">done</span>
    objdir=<span class="enscript-string">&quot;$origobjdir&quot;</span>

    <span class="enscript-comment"># Try to remove the ${objdir}s in the directories where we deleted files
</span>    <span class="enscript-keyword">for</span> dir <span class="enscript-keyword">in</span> $rmdirs; <span class="enscript-keyword">do</span>
      <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -d <span class="enscript-string">&quot;$dir&quot;</span>; <span class="enscript-keyword">then</span>
	$show <span class="enscript-string">&quot;rmdir $dir&quot;</span>
	$run rmdir $dir &gt;/dev/null 2&gt;&amp;1
      <span class="enscript-keyword">fi</span>
    <span class="enscript-keyword">done</span>

    <span class="enscript-keyword">exit</span> $exit_status
    ;;

  <span class="enscript-string">&quot;&quot;</span>)
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: you must specify a MODE&quot;</span> 1&gt;&amp;2
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$generic_help&quot;</span> 1&gt;&amp;2
    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
    ;;
  <span class="enscript-keyword">esac</span>

  <span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -z <span class="enscript-string">&quot;$exec_cmd&quot;</span>; <span class="enscript-keyword">then</span>
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: invalid operation mode \`$mode'&quot;</span> 1&gt;&amp;2
    $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$generic_help&quot;</span> 1&gt;&amp;2
    <span class="enscript-keyword">exit</span> $EXIT_FAILURE
  <span class="enscript-keyword">fi</span>
<span class="enscript-keyword">fi</span> <span class="enscript-comment"># test -z &quot;$show_help&quot;
</span>
<span class="enscript-keyword">if</span> <span class="enscript-keyword">test</span> -n <span class="enscript-string">&quot;$exec_cmd&quot;</span>; <span class="enscript-keyword">then</span>
  <span class="enscript-keyword">eval</span> <span class="enscript-keyword">exec</span> $exec_cmd
  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
<span class="enscript-keyword">fi</span>

<span class="enscript-comment"># We need to display help for each of the modes.
</span><span class="enscript-keyword">case</span> $mode <span class="enscript-keyword">in</span>
<span class="enscript-string">&quot;&quot;</span>) $<span class="enscript-keyword">echo</span> \
<span class="enscript-string">&quot;Usage: $modename [OPTION]... [MODE-ARG]...

Provide generalized library-building support services.

    --config          show all configuration variables
    --debug           enable verbose shell tracing
-n, --dry-run         display commands without modifying any files
    --features        display basic configuration information and exit
    --finish          same as \`--mode=finish'
    --help            display this help message and exit
    --mode=MODE       use operation mode MODE [default=inferred from MODE-ARGS]
    --quiet           same as \`--silent'
    --silent          don't print informational messages
    --tag=TAG         use configuration variables from tag TAG
    --version         print version information

MODE must be one of the following:

      clean           remove files from the build directory
      compile         compile a source file into a libtool object
      execute         automatically set library path, then run a program
      finish          complete the installation of libtool libraries
      install         install libraries or executables
      link            create a library or an executable
      uninstall       remove libraries from an installed directory

MODE-ARGS vary depending on the MODE.  Try \`$modename --help --mode=MODE' for
a more detailed description of MODE.

Report bugs to &lt;<a href="mailto:bug-libtool@gnu.org">bug-libtool@gnu.org</a>&gt;.&quot;</span>
  <span class="enscript-keyword">exit</span> $EXIT_SUCCESS
  ;;

clean)
  $<span class="enscript-keyword">echo</span> \
<span class="enscript-string">&quot;Usage: $modename [OPTION]... --mode=clean RM [RM-OPTION]... FILE...

Remove files from the build directory.

RM is the name of the program to use to delete files associated with each FILE
(typically \`/bin/rm').  RM-OPTIONS are options (such as \`-f') to be passed
to RM.

If FILE is a libtool library, object or program, all the files associated
with it are deleted. Otherwise, only FILE itself is deleted using RM.&quot;</span>
  ;;

compile)
  $<span class="enscript-keyword">echo</span> \
<span class="enscript-string">&quot;Usage: $modename [OPTION]... --mode=compile COMPILE-COMMAND... SOURCEFILE

Compile a source file into a libtool library object.

This mode accepts the following additional options:

  -o OUTPUT-FILE    set the output file name to OUTPUT-FILE
  -prefer-pic       try to building PIC objects only
  -prefer-non-pic   try to building non-PIC objects only
  -static           always build a \`.o' file suitable for static linking

COMPILE-COMMAND is a command to be used in creating a \`standard' object file
from the given SOURCEFILE.

The output file name is determined by removing the directory component from
SOURCEFILE, then substituting the C source code suffix \`.c' with the
library object suffix, \`.lo'.&quot;</span>
  ;;

execute)
  $<span class="enscript-keyword">echo</span> \
<span class="enscript-string">&quot;Usage: $modename [OPTION]... --mode=execute COMMAND [ARGS]...

Automatically set library path, then run a program.

This mode accepts the following additional options:

  -dlopen FILE      add the directory containing FILE to the library path

This mode sets the library path environment variable according to \`-dlopen'
flags.

If any of the ARGS are libtool executable wrappers, then they are translated
into their corresponding uninstalled binary, and any of their required library
directories are added to the library path.

Then, COMMAND is executed, with ARGS as arguments.&quot;</span>
  ;;

finish)
  $<span class="enscript-keyword">echo</span> \
<span class="enscript-string">&quot;Usage: $modename [OPTION]... --mode=finish [LIBDIR]...

Complete the installation of libtool libraries.

Each LIBDIR is a directory that contains libtool libraries.

The commands that this mode executes may require superuser privileges.  Use
the \`--dry-run' option if you just want to see what would be executed.&quot;</span>
  ;;

install)
  $<span class="enscript-keyword">echo</span> \
<span class="enscript-string">&quot;Usage: $modename [OPTION]... --mode=install INSTALL-COMMAND...

Install executables or libraries.

INSTALL-COMMAND is the installation command.  The first component should be
either the \`install' or \`cp' program.

The rest of the components are interpreted as arguments to that command (only
BSD-compatible install options are recognized).&quot;</span>
  ;;

link)
  $<span class="enscript-keyword">echo</span> \
<span class="enscript-string">&quot;Usage: $modename [OPTION]... --mode=link LINK-COMMAND...

Link object files or libraries together to form another library, or to
create an executable program.

LINK-COMMAND is a command using the C compiler that you would use to create
a program from several object files.

The following components of LINK-COMMAND are treated specially:

  -all-static       do not do any dynamic linking at all
  -avoid-version    do not add a version suffix if possible
  -dlopen FILE      \`-dlpreopen' FILE if it cannot be dlopened at runtime
  -dlpreopen FILE   link in FILE and add its symbols to lt_preloaded_symbols
  -export-dynamic   allow symbols from OUTPUT-FILE to be resolved with dlsym(3)
  -export-symbols SYMFILE
		    try to export only the symbols listed in SYMFILE
  -export-symbols-regex REGEX
		    try to export only the symbols matching REGEX
  -LLIBDIR          search LIBDIR for required installed libraries
  -lNAME            OUTPUT-FILE requires the installed library libNAME
  -module           build a library that can dlopened
  -no-fast-install  disable the fast-install mode
  -no-install       link a not-installable executable
  -no-undefined     declare that a library does not refer to external symbols
  -o OUTPUT-FILE    create OUTPUT-FILE from the specified objects
  -objectlist FILE  Use a list of object files found in FILE to specify objects
  -precious-files-regex REGEX
                    don't remove output files matching REGEX
  -release RELEASE  specify package release information
  -rpath LIBDIR     the created library will eventually be installed in LIBDIR
  -R[ ]LIBDIR       add LIBDIR to the runtime path of programs and libraries
  -static           do not do any dynamic linking of libtool libraries
  -version-info CURRENT[:REVISION[:AGE]]
		    specify library version info [each variable defaults to 0]

All other options (arguments beginning with \`-') are ignored.

Every other argument is treated as a filename.  Files ending in \`.la' are
treated as uninstalled libtool libraries, other files are standard or library
object files.

If the OUTPUT-FILE ends in \`.la', then a libtool library is created,
only library objects (\`.lo' files) may be specified, and \`-rpath' is
required, except when creating a convenience library.

If OUTPUT-FILE ends in \`.a' or \`.lib', then a standard library is created
using \`ar' and \`ranlib', or on Windows using \`lib'.

If OUTPUT-FILE ends in \`.lo' or \`.${objext}', then a reloadable object file
is created, otherwise an executable program is created.&quot;</span>
  ;;

uninstall)
  $<span class="enscript-keyword">echo</span> \
<span class="enscript-string">&quot;Usage: $modename [OPTION]... --mode=uninstall RM [RM-OPTION]... FILE...

Remove libraries from an installation directory.

RM is the name of the program to use to delete files associated with each FILE
(typically \`/bin/rm').  RM-OPTIONS are options (such as \`-f') to be passed
to RM.

If FILE is a libtool library, all the files associated with it are deleted.
Otherwise, only FILE itself is deleted using RM.&quot;</span>
  ;;

*)
  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$modename: invalid operation mode \`$mode'&quot;</span> 1&gt;&amp;2
  $<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;$help&quot;</span> 1&gt;&amp;2
  <span class="enscript-keyword">exit</span> $EXIT_FAILURE
  ;;
<span class="enscript-keyword">esac</span>

$<span class="enscript-keyword">echo</span>
$<span class="enscript-keyword">echo</span> <span class="enscript-string">&quot;Try \`$modename --help' for more information about other modes.&quot;</span>

<span class="enscript-keyword">exit</span> $?

<span class="enscript-comment"># The TAGs below are defined such that we never get into a situation
</span><span class="enscript-comment"># in which we disable both kinds of libraries.  Given conflicting
</span><span class="enscript-comment"># choices, we go for a static library, that is the most portable,
</span><span class="enscript-comment"># since we can't tell whether shared libraries were disabled because
</span><span class="enscript-comment"># the user asked for that or because the platform doesn't support
</span><span class="enscript-comment"># them.  This is particularly important on AIX, because we don't
</span><span class="enscript-comment"># support having both static and shared libraries enabled at the same
</span><span class="enscript-comment"># time on that platform, so we default to a shared-only configuration.
</span><span class="enscript-comment"># If a disable-shared tag is given, we'll fallback to a static-only
</span><span class="enscript-comment"># configuration.  But we'll never go from static-only to shared-only.
</span>
<span class="enscript-comment"># ### BEGIN LIBTOOL TAG CONFIG: disable-shared
</span>disable_libs=shared
<span class="enscript-comment"># ### END LIBTOOL TAG CONFIG: disable-shared
</span>
<span class="enscript-comment"># ### BEGIN LIBTOOL TAG CONFIG: disable-static
</span>disable_libs=static
<span class="enscript-comment"># ### END LIBTOOL TAG CONFIG: disable-static
</span>
<span class="enscript-comment"># Local Variables:
</span><span class="enscript-comment"># mode:shell-script
</span><span class="enscript-comment"># sh-indentation:2
</span><span class="enscript-comment"># End:
</span></pre>
<hr />
</body></html>