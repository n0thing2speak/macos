<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>tcvn.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">tcvn.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="?txt">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">/*
 * Copyright (C) 1999-2002, 2004 Free Software Foundation, Inc.
 * This file is part of the GNU LIBICONV Library.
 *
 * The GNU LIBICONV Library is free software; you can redistribute it
 * and/or modify it under the terms of the GNU Library General Public
 * License as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * The GNU LIBICONV Library is distributed in the hope that it will be
 * useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Library General Public License for more details.
 *
 * You should have received a copy of the GNU Library General Public
 * License along with the GNU LIBICONV Library; see the file COPYING.LIB.
 * If not, write to the Free Software Foundation, Inc., 51 Franklin Street,
 * Fifth Floor, Boston, MA 02110-1301, USA.
 */</span>

<span class="enscript-comment">/*
 * TCVN-5712
 */</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;flushwc.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;vietcomb.h&quot;</span>

<span class="enscript-type">static</span> <span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> tcvn_comb_table[] = {
  0xb0, 0xb3, 0xb2, 0xb1, 0xb4,
};

<span class="enscript-comment">/* The possible bases in viet_comp_table_data:
   0x0041..0x0045, 0x0047..0x0049, 0x004B..0x0050, 0x0052..0x0057,
   0x0059..0x005A, 0x0061..0x0065, 0x0067..0x0069, 0x006B..0x0070,
   0x0072..0x0077, 0x0079..0x007A, 0x00A5, 0x00C2, 0x00CA, 0x00D3..0x00D6,
   0x00DA, 0x00E2, 0x00EA, 0x00F3..0x00F6, 0x00FA, 0x0102..0x0103,
   0x0168..0x0169, 0x01A0..0x01A1, 0x01AF..0x01B0. */</span>
<span class="enscript-type">static</span> <span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> tcvn_comp_bases[] = {
  0x06fdfbbe, 0x06fdfbbe, 0x00000000, 0x00000020, 0x04780404, 0x04780404,
  0x0000000c, 0x00000000, 0x00000000, 0x00000300, 0x00000000, 0x00018003
};

<span class="enscript-type">static</span> <span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> tcvn_2uni_1[24] = {
  <span class="enscript-comment">/* 0x00 */</span>
  0x0000, 0x00da, 0x1ee4, 0x0003, 0x1eea, 0x1eec, 0x1eee, 0x0007,
  0x0008, 0x0009, 0x000a, 0x000b, 0x000c, 0x000d, 0x000e, 0x000f,
  <span class="enscript-comment">/* 0x10 */</span>
  0x0010, 0x1ee8, 0x1ef0, 0x1ef2, 0x1ef6, 0x1ef8, 0x00dd, 0x1ef4,
};
<span class="enscript-type">static</span> <span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> tcvn_2uni_2[128] = {
  <span class="enscript-comment">/* 0x80 */</span>
  0x00c0, 0x1ea2, 0x00c3, 0x00c1, 0x1ea0, 0x1eb6, 0x1eac, 0x00c8,
  0x1eba, 0x1ebc, 0x00c9, 0x1eb8, 0x1ec6, 0x00cc, 0x1ec8, 0x0128,
  <span class="enscript-comment">/* 0x90 */</span>
  0x00cd, 0x1eca, 0x00d2, 0x1ece, 0x00d5, 0x00d3, 0x1ecc, 0x1ed8,
  0x1edc, 0x1ede, 0x1ee0, 0x1eda, 0x1ee2, 0x00d9, 0x1ee6, 0x0168,
  <span class="enscript-comment">/* 0xa0 */</span>
  0x00a0, 0x0102, 0x00c2, 0x00ca, 0x00d4, 0x01a0, 0x01af, 0x0110,
  0x0103, 0x00e2, 0x00ea, 0x00f4, 0x01a1, 0x01b0, 0x0111, 0x1eb0,
  <span class="enscript-comment">/* 0xb0 */</span>
  0x0300, 0x0309, 0x0303, 0x0301, 0x0323, 0x00e0, 0x1ea3, 0x00e3,
  0x00e1, 0x1ea1, 0x1eb2, 0x1eb1, 0x1eb3, 0x1eb5, 0x1eaf, 0x1eb4,
  <span class="enscript-comment">/* 0xc0 */</span>
  0x1eae, 0x1ea6, 0x1ea8, 0x1eaa, 0x1ea4, 0x1ec0, 0x1eb7, 0x1ea7,
  0x1ea9, 0x1eab, 0x1ea5, 0x1ead, 0x00e8, 0x1ec2, 0x1ebb, 0x1ebd,
  <span class="enscript-comment">/* 0xd0 */</span>
  0x00e9, 0x1eb9, 0x1ec1, 0x1ec3, 0x1ec5, 0x1ebf, 0x1ec7, 0x00ec,
  0x1ec9, 0x1ec4, 0x1ebe, 0x1ed2, 0x0129, 0x00ed, 0x1ecb, 0x00f2,
  <span class="enscript-comment">/* 0xe0 */</span>
  0x1ed4, 0x1ecf, 0x00f5, 0x00f3, 0x1ecd, 0x1ed3, 0x1ed5, 0x1ed7,
  0x1ed1, 0x1ed9, 0x1edd, 0x1edf, 0x1ee1, 0x1edb, 0x1ee3, 0x00f9,
  <span class="enscript-comment">/* 0xf0 */</span>
  0x1ed6, 0x1ee7, 0x0169, 0x00fa, 0x1ee5, 0x1eeb, 0x1eed, 0x1eef,
  0x1ee9, 0x1ef1, 0x1ef3, 0x1ef7, 0x1ef9, 0x00fd, 0x1ef5, 0x1ed0,
};

<span class="enscript-comment">/* In the TCVN to Unicode direction, the state contains a buffered
   character, or 0 if none. */</span>

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
<span class="enscript-function-name">tcvn_mbtowc</span> (conv_t conv, ucs4_t *pwc, <span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *s, size_t n)
{
  <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> c = *s;
  <span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> wc;
  <span class="enscript-type">unsigned</span> <span class="enscript-type">short</span> last_wc;
  <span class="enscript-keyword">if</span> (c &lt; 0x18)
    wc = tcvn_2uni_1[c];
  <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (c &lt; 0x80)
    wc = c;
  <span class="enscript-keyword">else</span>
    wc = tcvn_2uni_2[c-0x80];
  last_wc = conv-&gt;istate;
  <span class="enscript-keyword">if</span> (last_wc) {
    <span class="enscript-keyword">if</span> (wc &gt;= 0x0300 &amp;&amp; wc &lt; 0x0340) {
      <span class="enscript-comment">/* See whether last_wc and wc can be combined. */</span>
      <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> k;
      <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> i1, i2;
      <span class="enscript-keyword">switch</span> (wc) {
        <span class="enscript-keyword">case</span> <span class="enscript-reference">0x0300</span>: k = 0; <span class="enscript-keyword">break</span>;
        <span class="enscript-keyword">case</span> <span class="enscript-reference">0x0301</span>: k = 1; <span class="enscript-keyword">break</span>;
        <span class="enscript-keyword">case</span> <span class="enscript-reference">0x0303</span>: k = 2; <span class="enscript-keyword">break</span>;
        <span class="enscript-keyword">case</span> <span class="enscript-reference">0x0309</span>: k = 3; <span class="enscript-keyword">break</span>;
        <span class="enscript-keyword">case</span> <span class="enscript-reference">0x0323</span>: k = 4; <span class="enscript-keyword">break</span>;
        <span class="enscript-reference">default</span>: abort();
      }
      i1 = viet_comp_table[k].idx;
      i2 = i1 + viet_comp_table[k].len-1;
      <span class="enscript-keyword">if</span> (last_wc &gt;= viet_comp_table_data[i1].base
          &amp;&amp; last_wc &lt;= viet_comp_table_data[i2].base) {
        <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> i;
        <span class="enscript-keyword">for</span> (;;) {
          i = (i1+i2)&gt;&gt;1;
          <span class="enscript-keyword">if</span> (last_wc == viet_comp_table_data[i].base)
            <span class="enscript-keyword">break</span>;
          <span class="enscript-keyword">if</span> (last_wc &lt; viet_comp_table_data[i].base) {
            <span class="enscript-keyword">if</span> (i1 == i)
              <span class="enscript-keyword">goto</span> <span class="enscript-reference">not_combining</span>;
            i2 = i;
          } <span class="enscript-keyword">else</span> {
            <span class="enscript-keyword">if</span> (i1 != i)
              i1 = i;
            <span class="enscript-keyword">else</span> {
              i = i2;
              <span class="enscript-keyword">if</span> (last_wc == viet_comp_table_data[i].base)
                <span class="enscript-keyword">break</span>;
              <span class="enscript-keyword">goto</span> <span class="enscript-reference">not_combining</span>;
            }
          }
        }
        last_wc = viet_comp_table_data[i].composed;
        <span class="enscript-comment">/* Output the combined character. */</span>
        conv-&gt;istate = 0;
        *pwc = (ucs4_t) last_wc;
        <span class="enscript-keyword">return</span> 1;
      }
    }
  <span class="enscript-reference">not_combining</span>:
    <span class="enscript-comment">/* Output the buffered character. */</span>
    conv-&gt;istate = 0;
    *pwc = (ucs4_t) last_wc;
    <span class="enscript-keyword">return</span> 0; <span class="enscript-comment">/* Don't advance the input pointer. */</span>
  }
  <span class="enscript-keyword">if</span> (wc &gt;= 0x0041 &amp;&amp; wc &lt;= 0x01b0
      &amp;&amp; ((tcvn_comp_bases[(wc - 0x0040) &gt;&gt; 5] &gt;&gt; (wc &amp; 0x1f)) &amp; 1)) {
    <span class="enscript-comment">/* wc is a possible match in viet_comp_table_data. Buffer it. */</span>
    conv-&gt;istate = wc;
    <span class="enscript-keyword">return</span> RET_TOOFEW(1);
  } <span class="enscript-keyword">else</span> {
    <span class="enscript-comment">/* Output wc immediately. */</span>
    *pwc = (ucs4_t) wc;
    <span class="enscript-keyword">return</span> 1;
  }
}

#<span class="enscript-reference">define</span> <span class="enscript-variable-name">tcvn_flushwc</span> normal_flushwc

<span class="enscript-type">static</span> <span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> tcvn_page00[96+184] = {
  0xa0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0xa0-0xa7 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0xa8-0xaf */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0xb0-0xb7 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0xb8-0xbf */</span>
  0x80, 0x83, 0xa2, 0x82, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0xc0-0xc7 */</span>
  0x87, 0x8a, 0xa3, 0x00, 0x8d, 0x90, 0x00, 0x00, <span class="enscript-comment">/* 0xc8-0xcf */</span>
  0x00, 0x00, 0x92, 0x95, 0xa4, 0x94, 0x00, 0x00, <span class="enscript-comment">/* 0xd0-0xd7 */</span>
  0x00, 0x9d, 0x01, 0x00, 0x00, 0x16, 0x00, 0x00, <span class="enscript-comment">/* 0xd8-0xdf */</span>
  0xb5, 0xb8, 0xa9, 0xb7, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0xe0-0xe7 */</span>
  0xcc, 0xd0, 0xaa, 0x00, 0xd7, 0xdd, 0x00, 0x00, <span class="enscript-comment">/* 0xe8-0xef */</span>
  0x00, 0x00, 0xdf, 0xe3, 0xab, 0xe2, 0x00, 0x00, <span class="enscript-comment">/* 0xf0-0xf7 */</span>
  0x00, 0xef, 0xf3, 0x00, 0x00, 0xfd, 0x00, 0x00, <span class="enscript-comment">/* 0xf8-0xff */</span>
  <span class="enscript-comment">/* 0x0100 */</span>
  0x00, 0x00, 0xa1, 0xa8, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x00-0x07 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x08-0x0f */</span>
  0xa7, 0xae, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x10-0x17 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x18-0x1f */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x20-0x27 */</span>
  0x8f, 0xdc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x28-0x2f */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x30-0x37 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x38-0x3f */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x40-0x47 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x48-0x4f */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x50-0x57 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x58-0x5f */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x60-0x67 */</span>
  0x9f, 0xf2, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x68-0x6f */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x70-0x77 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x78-0x7f */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x80-0x87 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x88-0x8f */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x90-0x97 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x98-0x9f */</span>
  0xa5, 0xac, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0xa0-0xa7 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa6, <span class="enscript-comment">/* 0xa8-0xaf */</span>
  0xad, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0xb0-0xb7 */</span>
};
<span class="enscript-type">static</span> <span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> tcvn_page03[40] = {
  0xb0, 0xb3, 0x00, 0xb2, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x00-0x07 */</span>
  0x00, 0xb1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x08-0x0f */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x10-0x17 */</span>
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x18-0x1f */</span>
  0x00, 0x00, 0x00, 0xb4, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0x20-0x27 */</span>
};
<span class="enscript-type">static</span> <span class="enscript-type">const</span> <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> tcvn_page1e[96] = {
  0x84, 0xb9, 0x81, 0xb6, 0xc4, 0xca, 0xc1, 0xc7, <span class="enscript-comment">/* 0xa0-0xa7 */</span>
  0xc2, 0xc8, 0xc3, 0xc9, 0x86, 0xcb, 0xc0, 0xbe, <span class="enscript-comment">/* 0xa8-0xaf */</span>
  0xaf, 0xbb, 0xba, 0xbc, 0xbf, 0xbd, 0x85, 0xc6, <span class="enscript-comment">/* 0xb0-0xb7 */</span>
  0x8b, 0xd1, 0x88, 0xce, 0x89, 0xcf, 0xda, 0xd5, <span class="enscript-comment">/* 0xb8-0xbf */</span>
  0xc5, 0xd2, 0xcd, 0xd3, 0xd9, 0xd4, 0x8c, 0xd6, <span class="enscript-comment">/* 0xc0-0xc7 */</span>
  0x8e, 0xd8, 0x91, 0xde, 0x96, 0xe4, 0x93, 0xe1, <span class="enscript-comment">/* 0xc8-0xcf */</span>
  0xff, 0xe8, 0xdb, 0xe5, 0xe0, 0xe6, 0xf0, 0xe7, <span class="enscript-comment">/* 0xd0-0xd7 */</span>
  0x97, 0xe9, 0x9b, 0xed, 0x98, 0xea, 0x99, 0xeb, <span class="enscript-comment">/* 0xd8-0xdf */</span>
  0x9a, 0xec, 0x9c, 0xee, 0x02, 0xf4, 0x9e, 0xf1, <span class="enscript-comment">/* 0xe0-0xe7 */</span>
  0x11, 0xf8, 0x04, 0xf5, 0x05, 0xf6, 0x06, 0xf7, <span class="enscript-comment">/* 0xe8-0xef */</span>
  0x12, 0xf9, 0x13, 0xfa, 0x17, 0xfe, 0x14, 0xfb, <span class="enscript-comment">/* 0xf0-0xf7 */</span>
  0x15, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, <span class="enscript-comment">/* 0xf8-0xff */</span>
};

<span class="enscript-type">static</span> <span class="enscript-type">int</span>
<span class="enscript-function-name">tcvn_wctomb</span> (conv_t conv, <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> *r, ucs4_t wc, size_t n)
{
  <span class="enscript-type">unsigned</span> <span class="enscript-type">char</span> c = 0;
  <span class="enscript-keyword">if</span> (wc &lt; 0x0080 &amp;&amp; (wc &gt;= 0x0020 || (0x00fe0076 &amp; (1 &lt;&lt; wc)) == 0)) {
    *r = wc;
    <span class="enscript-keyword">return</span> 1;
  }
  <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (wc &gt;= 0x00a0 &amp;&amp; wc &lt; 0x01b8)
    c = tcvn_page00[wc-0x00a0];
  <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (wc &gt;= 0x0300 &amp;&amp; wc &lt; 0x0328)
    c = tcvn_page03[wc-0x0300];
  <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (wc &gt;= 0x0340 &amp;&amp; wc &lt; 0x0342) <span class="enscript-comment">/* deprecated Vietnamese tone marks */</span>
    c = tcvn_page03[wc-0x0340];
  <span class="enscript-keyword">else</span> <span class="enscript-keyword">if</span> (wc &gt;= 0x1ea0 &amp;&amp; wc &lt; 0x1f00)
    c = tcvn_page1e[wc-0x1ea0];
  <span class="enscript-keyword">if</span> (c != 0) {
    *r = c;
    <span class="enscript-keyword">return</span> 1;
  }
  <span class="enscript-comment">/* Try compatibility or canonical decomposition. */</span>
  {
    <span class="enscript-comment">/* Binary search through viet_decomp_table. */</span>
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> i1 = 0;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> i2 = <span class="enscript-keyword">sizeof</span>(viet_decomp_table)/<span class="enscript-keyword">sizeof</span>(viet_decomp_table[0])-1;
    <span class="enscript-keyword">if</span> (wc &gt;= viet_decomp_table[i1].composed
        &amp;&amp; wc &lt;= viet_decomp_table[i2].composed) {
      <span class="enscript-type">unsigned</span> <span class="enscript-type">int</span> i;
      <span class="enscript-keyword">for</span> (;;) {
        <span class="enscript-comment">/* Here i2 - i1 &gt; 0. */</span>
        i = (i1+i2)&gt;&gt;1;
        <span class="enscript-keyword">if</span> (wc == viet_decomp_table[i].composed)
          <span class="enscript-keyword">break</span>;
        <span class="enscript-keyword">if</span> (wc &lt; viet_decomp_table[i].composed) {
          <span class="enscript-keyword">if</span> (i1 == i)
            <span class="enscript-keyword">return</span> RET_ILUNI;
          <span class="enscript-comment">/* Here i1 &lt; i &lt; i2. */</span>
          i2 = i;
        } <span class="enscript-keyword">else</span> {
          <span class="enscript-comment">/* Here i1 &lt;= i &lt; i2. */</span>
          <span class="enscript-keyword">if</span> (i1 != i)
            i1 = i;
          <span class="enscript-keyword">else</span> {
            <span class="enscript-comment">/* Here i2 - i1 = 1. */</span>
            i = i2;
            <span class="enscript-keyword">if</span> (wc == viet_decomp_table[i].composed)
              <span class="enscript-keyword">break</span>;
            <span class="enscript-keyword">else</span>
              <span class="enscript-keyword">return</span> RET_ILUNI;
          }
        }
      }
      <span class="enscript-comment">/* Found a compatibility or canonical decomposition. */</span>
      wc = viet_decomp_table[i].base;
      <span class="enscript-comment">/* wc is one of 0x0020, 0x0041..0x005a, 0x0061..0x007a, 0x00a5, 0x00a8,
         0x00c2, 0x00c5..0x00c7, 0x00ca, 0x00cf, 0x00d3, 0x00d4, 0x00d6,
         0x00d8, 0x00da, 0x00dc, 0x00e2, 0x00e5..0x00e7, 0x00ea, 0x00ef,
         0x00f3, 0x00f4, 0x00f6, 0x00f8, 0x00fc, 0x0102, 0x0103, 0x01a0,
         0x01a1, 0x01af, 0x01b0. */</span>
      <span class="enscript-keyword">if</span> (wc &lt; 0x0080)
        c = wc;
      <span class="enscript-keyword">else</span> {
        c = tcvn_page00[wc-0x00a0];
        <span class="enscript-keyword">if</span> (c == 0)
          <span class="enscript-keyword">return</span> RET_ILUNI;
      }
      <span class="enscript-keyword">if</span> (n &lt; 2)
        <span class="enscript-keyword">return</span> RET_TOOSMALL;
      r[0] = c;
      r[1] = tcvn_comb_table[viet_decomp_table[i].comb1];
      <span class="enscript-keyword">return</span> 2;
    }
  }
  <span class="enscript-keyword">return</span> RET_ILUNI;
}
</pre>
<hr />
</body></html>